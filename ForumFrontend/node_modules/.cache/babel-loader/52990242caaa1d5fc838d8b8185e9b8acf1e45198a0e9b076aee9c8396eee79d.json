{"ast":null,"code":"import _slicedToArray from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _regeneratorRuntime from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _typeof from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/typeof.js\";\nimport _objectWithoutProperties from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";\nimport _asyncToGenerator from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _objectSpread from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nvar _excluded = [\"code\", \"status\", \"msg\"];\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.array.is-array.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.unshift.js\";\nimport \"core-js/modules/es.date.to-iso-string.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.parse-int.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.timers.js\";\nimport { getPostDetail, likePost, favoritePost, pinPost, featurePost, deletePost, updatePost, getLikeStatus, getFavoriteStatus } from '@/api/post';\nimport { getPostComments, createComment, replyComment, deleteComment } from '@/api/comment';\nimport { formatDateTime } from '@/utils/index';\nimport { mapGetters } from 'vuex';\nimport RichTextEditor from '@/components/RichTextEditor.vue';\n\n// 是否启用调试日志\nvar DEBUG = false;\n\n// 自定义日志函数，可以通过DEBUG开关控制\nvar log = function log() {\n  if (DEBUG) {\n    var _console;\n    (_console = console).log.apply(_console, arguments);\n  }\n};\n\n// 格式化日期函数\nvar formatDate = function formatDate(date) {\n  return formatDateTime(date);\n};\nexport default {\n  name: 'PostDetail',\n  components: {\n    RichTextEditor: RichTextEditor\n  },\n  data: function data() {\n    return {\n      loading: false,\n      commentsLoading: false,\n      post: {},\n      isLiked: false,\n      isFavorited: false,\n      comments: [],\n      commentsTotal: 0,\n      commentsQuery: {\n        page: 1,\n        limit: 10\n      },\n      commentContent: '',\n      replyingTo: null,\n      replyContent: '',\n      forceRefresh: false,\n      // 用于强制刷新评论列表的内部标志\n\n      // 编辑帖子相关\n      isEditing: false,\n      // 是否处于编辑状态\n      editPostSubmitting: false,\n      editPostForm: {\n        title: '',\n        content: ''\n      },\n      postRules: {\n        title: [{\n          required: true,\n          message: '请输入帖子标题',\n          trigger: 'blur'\n        }, {\n          min: 2,\n          max: 100,\n          message: '标题长度在2到100个字符之间',\n          trigger: 'blur'\n        }],\n        content: [{\n          required: true,\n          message: '请输入帖子内容',\n          trigger: 'blur'\n        }, {\n          min: 5,\n          message: '内容至少5个字符',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  computed: _objectSpread(_objectSpread({}, mapGetters(['isAuthenticated', 'isAdmin', 'userId'])), {}, {\n    isLogin: function isLogin() {\n      return this.$store.getters.isLoggedIn;\n    },\n    isPostAuthor: function isPostAuthor() {\n      return this.isLogin && this.post.user && this.post.user.id === this.userId;\n    },\n    canManagePost: function canManagePost() {\n      return this.isLogin && (this.isAdmin || this.isPostAuthor);\n    }\n  }),\n  created: function created() {\n    log('PostDetail组件created，登录状态:', this.isLogin, '认证状态:', this.$store.getters.isLoggedIn);\n    var postId = this.$route.params.id;\n    if (postId) {\n      log('准备获取帖子详情和评论，ID:', postId);\n      this.fetchPostDetail(postId);\n      this.fetchComments(postId);\n    } else {\n      log('没有帖子ID，跳转到帖子列表');\n      this.$router.push({\n        name: 'PostList'\n      });\n    }\n  },\n  methods: {\n    formatDate: formatDate,\n    // 获取帖子详情\n    fetchPostDetail: function fetchPostDetail(id) {\n      var _this = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var response, code, status, msg, postData;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _this.loading = true;\n              _context.prev = 1;\n              log('组件开始获取帖子详情, ID:', id);\n              _context.next = 5;\n              return getPostDetail(id);\n            case 5:\n              response = _context.sent;\n              log('组件收到帖子详情响应:', response);\n\n              // 检查响应是否有效\n              if (response) {\n                _context.next = 11;\n                break;\n              }\n              log('帖子详情响应为空');\n              _this.post = {};\n              return _context.abrupt(\"return\");\n            case 11:\n              // 检查响应中的数据\n              if (response.data) {\n                log('使用响应中的data字段:', response.data);\n                _this.post = response.data;\n              } else if (response.code === 0 || response.status === 0) {\n                log('响应成功但没有data字段，尝试使用响应本身');\n                // 移除code、status、msg等字段，只保留实际数据\n                code = response.code, status = response.status, msg = response.msg, postData = _objectWithoutProperties(response, _excluded);\n                if (Object.keys(postData).length > 0) {\n                  _this.post = postData;\n                } else {\n                  log('响应中没有有效的帖子数据');\n                  _this.$message.error('获取帖子详情失败，请稍后再试');\n                  _this.post = {};\n                }\n              } else if (_typeof(response) === 'object') {\n                log('直接使用响应对象');\n                _this.post = response;\n              } else {\n                log('无法从响应中提取帖子数据');\n                _this.$message.error('获取帖子详情失败，请稍后再试');\n                _this.post = {};\n              }\n\n              // 确保post对象包含必要的字段\n              _this.ensurePostFields();\n\n              // 检查是否已点赞和收藏\n              _this.checkLikeAndFavorite();\n              _context.next = 22;\n              break;\n            case 16:\n              _context.prev = 16;\n              _context.t0 = _context[\"catch\"](1);\n              log('获取帖子详情失败:', _context.t0);\n              _this.$message.error('获取帖子详情失败，请稍后再试');\n              _this.post = {};\n              // 确保post对象包含必要的字段\n              _this.ensurePostFields();\n            case 22:\n              _context.prev = 22;\n              _this.loading = false;\n              return _context.finish(22);\n            case 25:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[1, 16, 22, 25]]);\n      }))();\n    },\n    // 确保帖子对象包含所有必要的字段\n    ensurePostFields: function ensurePostFields() {\n      // 确保post是一个对象\n      if (!this.post || _typeof(this.post) !== 'object') {\n        this.post = {};\n      }\n\n      // 确保必要的字段存在\n      this.post.title = this.post.title || '帖子标题';\n      this.post.content = this.post.content || '帖子内容';\n      this.post.created_at = this.post.created_at || new Date().toISOString();\n      this.post.views = this.post.views || 0;\n      this.post.likes_count = this.post.likes_count || 0;\n      this.post.comments_count = this.post.comments_count || 0;\n      this.post.is_pinned = this.post.is_pinned || false;\n      this.post.is_featured = this.post.is_featured || false;\n\n      // 确保board字段存在\n      if (!this.post.board || _typeof(this.post.board) !== 'object') {\n        this.post.board = {\n          id: 1,\n          name: '默认板块'\n        };\n      } else if (typeof this.post.board === 'number') {\n        // 如果board只是一个ID，转换为对象\n        this.post.board = {\n          id: this.post.board,\n          name: '板块' + this.post.board\n        };\n      }\n\n      // 确保board.name字段存在\n      if (!this.post.board.name) {\n        this.post.board.name = '板块' + this.post.board.id;\n      }\n\n      // 确保user字段存在\n      if (!this.post.user || _typeof(this.post.user) !== 'object') {\n        this.post.user = {\n          id: 1,\n          username: 'user',\n          nickname: '用户',\n          avatar_url: ''\n        };\n      }\n\n      // 确保user.nickname字段存在\n      if (!this.post.user.nickname) {\n        this.post.user.nickname = this.post.user.username || '用户';\n      }\n    },\n    // 检查是否已点赞和收藏\n    checkLikeAndFavorite: function checkLikeAndFavorite() {\n      var _this2 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var _likeResponse$data, _favoriteResponse$dat, _yield$Promise$all, _yield$Promise$all2, likeResponse, favoriteResponse;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (_this2.isLogin) {\n                _context2.next = 5;\n                break;\n              }\n              log('未登录用户，设置为未点赞和未收藏状态');\n              _this2.isLiked = false;\n              _this2.isFavorited = false;\n              return _context2.abrupt(\"return\");\n            case 5:\n              _context2.prev = 5;\n              _context2.next = 8;\n              return Promise.all([getLikeStatus(_this2.post.id), getFavoriteStatus(_this2.post.id)]);\n            case 8:\n              _yield$Promise$all = _context2.sent;\n              _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 2);\n              likeResponse = _yield$Promise$all2[0];\n              favoriteResponse = _yield$Promise$all2[1];\n              // 更新点赞状态\n              _this2.isLiked = ((_likeResponse$data = likeResponse.data) === null || _likeResponse$data === void 0 ? void 0 : _likeResponse$data.is_liked) || false;\n              // 更新收藏状态\n              _this2.isFavorited = ((_favoriteResponse$dat = favoriteResponse.data) === null || _favoriteResponse$dat === void 0 ? void 0 : _favoriteResponse$dat.is_favorited) || false;\n              log('获取状态成功:', {\n                isLiked: _this2.isLiked,\n                isFavorited: _this2.isFavorited\n              });\n              _context2.next = 22;\n              break;\n            case 17:\n              _context2.prev = 17;\n              _context2.t0 = _context2[\"catch\"](5);\n              log('获取点赞/收藏状态失败:', _context2.t0);\n              // 状态获取失败时，默认为未点赞和未收藏\n              _this2.isLiked = false;\n              _this2.isFavorited = false;\n            case 22:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[5, 17]]);\n      }))();\n    },\n    // 获取评论列表\n    fetchComments: function fetchComments(postId) {\n      var _this3 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!(_this3.commentsLoading && !_this3.forceRefresh)) {\n                _context3.next = 2;\n                break;\n              }\n              return _context3.abrupt(\"return\", Promise.resolve());\n            case 2:\n              _this3.commentsLoading = true;\n              log('开始获取评论列表，ID:', postId, '强制刷新:', _this3.forceRefresh);\n              _context3.prev = 4;\n              _context3.next = 7;\n              return getPostComments(postId, _this3.forceRefresh);\n            case 7:\n              response = _context3.sent;\n              log('评论列表响应:', response);\n\n              // 处理响应\n              _this3.processCommentsResponse(response);\n              _context3.next = 18;\n              break;\n            case 12:\n              _context3.prev = 12;\n              _context3.t0 = _context3[\"catch\"](4);\n              log('获取评论列表失败:', _context3.t0);\n              // 设置空评论列表\n              _this3.comments = [];\n              _this3.commentsTotal = 0;\n\n              // 未登录用户不显示错误提示\n              if (!(_context3.t0.response && _context3.t0.response.status === 401)) {\n                _this3.$message.error('获取评论列表失败，请刷新页面重试');\n              }\n            case 18:\n              _context3.prev = 18;\n              _this3.commentsLoading = false;\n              _this3.forceRefresh = false; // 重置强制刷新标志\n              log('评论列表获取完成，重置强制刷新标志');\n              return _context3.finish(18);\n            case 23:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, null, [[4, 12, 18, 23]]);\n      }))();\n    },\n    // 处理评论列表响应\n    processCommentsResponse: function processCommentsResponse(response) {\n      // 如果响应为空，设置空评论列表\n      if (!response) {\n        log('评论列表响应为空，设置空评论列表');\n        this.comments = [];\n        this.commentsTotal = 0;\n        return;\n      }\n\n      // 提取评论数据和总数\n      var comments = [];\n      var total = 0;\n      if (response.data && response.data.results) {\n        // 标准格式：{data: {results: [...], count: 10}}\n        comments = response.data.results;\n        total = response.data.count || 0;\n      } else if (response.results) {\n        // 直接结果格式：{results: [...], count: 10}\n        comments = response.results;\n        total = response.count || 0;\n      } else if (Array.isArray(response)) {\n        // 数组格式：[...]\n        comments = response;\n        total = response.length;\n      } else if (response.data && Array.isArray(response.data)) {\n        // 数组包装格式：{data: [...]}\n        comments = response.data;\n        total = response.data.length;\n      } else {\n        // 其他情况，设置空评论列表\n        log('无法从响应中提取评论数据，设置空评论列表');\n        this.comments = [];\n        this.commentsTotal = 0;\n        return;\n      }\n\n      // 确保评论数据有效\n      comments = comments.filter(function (comment) {\n        return comment && _typeof(comment) === 'object';\n      });\n\n      // 处理评论数据\n      this.comments = comments.map(function (comment) {\n        // 确保replies字段存在\n        var replies = Array.isArray(comment.replies) ? comment.replies : [];\n\n        // 确保user字段存在\n        var user = comment.user || {\n          id: 0,\n          username: 'unknown',\n          nickname: '未知用户',\n          avatar_url: ''\n        };\n\n        // 返回处理后的评论对象\n        return _objectSpread(_objectSpread({}, comment), {}, {\n          replies: replies,\n          user: user\n        });\n      });\n      this.commentsTotal = total;\n\n      // 更新帖子评论数\n      if (this.post) {\n        this.post.comments_count = total;\n      }\n    },\n    // 评论分页变化\n    handleCommentsPageChange: function handleCommentsPageChange(page) {\n      this.commentsQuery.page = page;\n      this.fetchComments(this.post.id);\n    },\n    // 前往板块页面\n    goToBoard: function goToBoard() {\n      if (this.post.board && this.post.board.id) {\n        this.$router.push({\n          name: 'BoardDetail',\n          params: {\n            id: this.post.board.id\n          }\n        });\n      }\n    },\n    // 跳转到用户主页\n    goToUserProfile: function goToUserProfile(userId) {\n      if (userId) {\n        this.$router.push({\n          name: 'UserProfile',\n          params: {\n            id: userId\n          }\n        });\n      } else {\n        this.$message.warning('无法获取用户信息');\n      }\n    },\n    // 收藏帖子\n    handleFavorite: function handleFavorite() {\n      var _this4 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var previousState, response;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              if (_this4.isLogin) {\n                _context4.next = 4;\n                break;\n              }\n              _this4.$message.warning('请先登录');\n              _this4.$router.push({\n                name: 'Login',\n                query: {\n                  redirect: _this4.$route.fullPath\n                }\n              });\n              return _context4.abrupt(\"return\");\n            case 4:\n              _context4.prev = 4;\n              // 先乐观更新UI状态\n              previousState = _this4.isFavorited;\n              _this4.isFavorited = !_this4.isFavorited;\n              _context4.next = 9;\n              return favoritePost(_this4.post.id);\n            case 9:\n              response = _context4.sent;\n              // 使用 Notification 替代 Message\n              _this4.$notify({\n                title: _this4.isFavorited ? '收藏成功' : '已取消收藏',\n                message: _this4.isFavorited ? '帖子已添加到您的收藏列表' : '帖子已从您的收藏列表中移除',\n                type: _this4.isFavorited ? 'success' : 'info',\n                position: 'top-right',\n                duration: 2000,\n                showClose: false,\n                customClass: _this4.isFavorited ? 'favorite-notification success' : 'favorite-notification info'\n              });\n              _context4.next = 19;\n              break;\n            case 13:\n              _context4.prev = 13;\n              _context4.t0 = _context4[\"catch\"](4);\n              log('收藏操作失败:', _context4.t0);\n              // 恢复之前的状态\n              _this4.isFavorited = !_this4.isFavorited;\n              _this4.$notify.error({\n                title: '收藏操作失败',\n                message: _context4.t0.message || '请稍后重试',\n                position: 'top-right',\n                duration: 3000\n              });\n\n              // 如果是未登录错误，跳转到登录页\n              if (_context4.t0.response && _context4.t0.response.status === 401) {\n                _this4.$router.push({\n                  name: 'Login',\n                  query: {\n                    redirect: _this4.$route.fullPath\n                  }\n                });\n              }\n            case 19:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, null, [[4, 13]]);\n      }))();\n    },\n    // 点赞帖子\n    handleLike: function handleLike() {\n      var _this5 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              if (_this5.isLogin) {\n                _context5.next = 4;\n                break;\n              }\n              _this5.$message.warning('请先登录');\n              _this5.$router.push({\n                name: 'Login',\n                query: {\n                  redirect: _this5.$route.fullPath\n                }\n              });\n              return _context5.abrupt(\"return\");\n            case 4:\n              _context5.prev = 4;\n              _context5.next = 7;\n              return likePost(_this5.post.id);\n            case 7:\n              response = _context5.sent;\n              // 更新点赞状态\n              _this5.isLiked = !_this5.isLiked;\n              // 更新点赞数\n              _this5.post.likes_count = _this5.isLiked ? _this5.post.likes_count + 1 : _this5.post.likes_count - 1;\n              // 使用 Notification 替代 Message\n              _this5.$notify({\n                title: _this5.isLiked ? '点赞成功' : '已取消点赞',\n                message: _this5.isLiked ? '感谢您的支持！' : '您已取消点赞',\n                type: _this5.isLiked ? 'success' : 'info',\n                position: 'top-right',\n                duration: 2000,\n                showClose: false,\n                customClass: _this5.isLiked ? 'like-notification success' : 'like-notification info'\n              });\n              _context5.next = 20;\n              break;\n            case 13:\n              _context5.prev = 13;\n              _context5.t0 = _context5[\"catch\"](4);\n              log('点赞操作失败:', _context5.t0);\n              _this5.$notify.error({\n                title: '操作失败',\n                message: _context5.t0.message || '请稍后重试',\n                position: 'top-right',\n                duration: 3000\n              });\n              // 如果是未登录错误，跳转到登录页\n              if (_context5.t0.response && _context5.t0.response.status === 401) {\n                _this5.$router.push({\n                  name: 'Login',\n                  query: {\n                    redirect: _this5.$route.fullPath\n                  }\n                });\n              }\n              // 操作失败时恢复原状态\n              _context5.next = 20;\n              return _this5.checkLikeAndFavorite();\n            case 20:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, null, [[4, 13]]);\n      }))();\n    },\n    // 帖子管理操作\n    handleCommand: function handleCommand(command) {\n      var _this6 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.t0 = command;\n              _context6.next = _context6.t0 === 'pin' ? 3 : _context6.t0 === 'feature' ? 5 : 7;\n              break;\n            case 3:\n              _this6.handlePinPost();\n              return _context6.abrupt(\"break\", 7);\n            case 5:\n              _this6.handleFeaturePost();\n              return _context6.abrupt(\"break\", 7);\n            case 7:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6);\n      }))();\n    },\n    // 编辑帖子\n    handleEditPost: function handleEditPost() {\n      log('开始编辑帖子，原始内容:', {\n        title: this.post.title,\n        content: this.post.content\n      });\n\n      // 初始化编辑表单数据\n      this.editPostForm = {\n        title: this.post.title,\n        content: this.post.content\n      };\n\n      // 切换到编辑状态\n      this.isEditing = true;\n    },\n    // 取消编辑\n    cancelEdit: function cancelEdit() {\n      // 退出编辑状态\n      this.isEditing = false;\n      // 重置表单数据\n      this.editPostForm.title = this.post.title;\n      this.editPostForm.content = this.post.content;\n    },\n    // 提交编辑\n    submitEdit: function submitEdit() {\n      var _this7 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n        var postData, response;\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              if (_this7.editPostForm.title.trim()) {\n                _context7.next = 3;\n                break;\n              }\n              _this7.$message.warning('标题不能为空');\n              return _context7.abrupt(\"return\");\n            case 3:\n              if (_this7.editPostForm.content.trim()) {\n                _context7.next = 6;\n                break;\n              }\n              _this7.$message.warning('内容不能为空');\n              return _context7.abrupt(\"return\");\n            case 6:\n              _this7.editPostSubmitting = true;\n              _context7.prev = 7;\n              // 确保发送正确的数据格式\n              postData = {\n                title: _this7.editPostForm.title.trim(),\n                content: _this7.editPostForm.content.trim(),\n                board: _this7.post.board.id // 需要包含板块ID\n              };\n              log('提交更新帖子数据:', postData);\n              _context7.next = 12;\n              return updatePost(_this7.post.id, postData);\n            case 12:\n              response = _context7.sent;\n              if (response && response.code === 0) {\n                // 更新成功\n                // this.$message.success('帖子更新成功') // 注释掉这行，避免重复显示成功消息\n\n                // 更新当前页面的帖子数据\n                _this7.post.title = _this7.editPostForm.title;\n                _this7.post.content = _this7.editPostForm.content;\n                // 更新帖子的更新时间\n                if (response.data && response.data.updated_at) {\n                  _this7.post.updated_at = response.data.updated_at;\n                }\n\n                // 强制退出编辑状态\n                log('强制退出编辑状态');\n                // 使用直接赋值和延时双重保险确保状态更新\n                _this7.isEditing = false;\n\n                // 如果直接赋值不起作用，使用延时函数再次尝试\n                setTimeout(function () {\n                  if (_this7.isEditing) {\n                    log('使用setTimeout再次尝试退出编辑状态');\n                    _this7.isEditing = false;\n                  }\n                  log('编辑状态最终设置为:', _this7.isEditing);\n                }, 100);\n              } else {\n                _this7.$message.error((response === null || response === void 0 ? void 0 : response.msg) || '更新失败，请稍后重试');\n                // 失败时也退出编辑状态\n                _this7.isEditing = false;\n                setTimeout(function () {\n                  if (_this7.isEditing) {\n                    _this7.isEditing = false;\n                  }\n                }, 100);\n              }\n              _context7.next = 22;\n              break;\n            case 16:\n              _context7.prev = 16;\n              _context7.t0 = _context7[\"catch\"](7);\n              log('更新帖子失败:', _context7.t0);\n              _this7.$message.error('更新帖子失败，请检查网络连接');\n\n              // 出错时也退出编辑状态\n              _this7.isEditing = false;\n              setTimeout(function () {\n                if (_this7.isEditing) {\n                  _this7.isEditing = false;\n                }\n              }, 100);\n            case 22:\n              _context7.prev = 22;\n              _this7.editPostSubmitting = false;\n              return _context7.finish(22);\n            case 25:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee7, null, [[7, 16, 22, 25]]);\n      }))();\n    },\n    // 删除帖子\n    handleDeletePost: function handleDeletePost() {\n      var _this8 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {\n        var loading, response;\n        return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              _context8.prev = 0;\n              _context8.next = 3;\n              return _this8.$confirm('确定要删除这篇帖子吗？删除后将无法恢复，帖子下的所有评论也将被删除。', '删除确认', {\n                confirmButtonText: '确定删除',\n                cancelButtonText: '取消',\n                type: 'warning',\n                distinguishCancelAndClose: true,\n                closeOnClickModal: false\n              });\n            case 3:\n              // 显示加载状态\n              loading = _this8.$loading({\n                lock: true,\n                text: '正在删除帖子...',\n                spinner: 'el-icon-loading',\n                background: 'rgba(0, 0, 0, 0.7)'\n              });\n              _context8.prev = 4;\n              _context8.next = 7;\n              return deletePost(_this8.post.id);\n            case 7:\n              response = _context8.sent;\n              loading.close(); // 关闭加载状态\n\n              if (response.code === 0) {\n                // 不显示任何提示弹窗，直接返回上一级路由\n                log('帖子删除成功，正在返回上一级路由...');\n                // 返回上一级路由\n                _this8.$router.go(-1);\n              } else {\n                _this8.$message.error(response.msg || '删除失败，请稍后重试');\n              }\n              _context8.next = 17;\n              break;\n            case 12:\n              _context8.prev = 12;\n              _context8.t0 = _context8[\"catch\"](4);\n              loading.close(); // 确保加载状态被关闭\n              log('删除帖子请求失败:', _context8.t0);\n              _this8.$message.error('删除帖子失败，请检查网络连接');\n            case 17:\n              _context8.next = 22;\n              break;\n            case 19:\n              _context8.prev = 19;\n              _context8.t1 = _context8[\"catch\"](0);\n              // 用户取消删除，不做任何处理\n              if (_context8.t1 !== 'cancel') {\n                log('删除帖子操作异常:', _context8.t1);\n                _this8.$message.error('操作异常，请刷新页面后重试');\n              }\n            case 22:\n            case \"end\":\n              return _context8.stop();\n          }\n        }, _callee8, null, [[0, 19], [4, 12]]);\n      }))();\n    },\n    // 置顶/取消置顶帖子\n    handlePinPost: function handlePinPost() {\n      var _this9 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n          while (1) switch (_context9.prev = _context9.next) {\n            case 0:\n              _context9.prev = 0;\n              _context9.next = 3;\n              return pinPost(_this9.post.id);\n            case 3:\n              response = _context9.sent;\n              if (response.code === 0) {\n                _this9.post.is_pinned = !_this9.post.is_pinned;\n                // this.$message.success(response.msg || (this.post.is_pinned ? '置顶成功' : '取消置顶成功')) // 注释掉这行，避免重复显示成功消息\n              } else {\n                _this9.$message.error(response.msg || '操作失败');\n              }\n              _context9.next = 11;\n              break;\n            case 7:\n              _context9.prev = 7;\n              _context9.t0 = _context9[\"catch\"](0);\n              log('置顶操作失败:', _context9.t0);\n              _this9.$message.error('置顶操作失败');\n            case 11:\n            case \"end\":\n              return _context9.stop();\n          }\n        }, _callee9, null, [[0, 7]]);\n      }))();\n    },\n    // 加精/取消加精帖子\n    handleFeaturePost: function handleFeaturePost() {\n      var _this0 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee0() {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee0$(_context0) {\n          while (1) switch (_context0.prev = _context0.next) {\n            case 0:\n              _context0.prev = 0;\n              _context0.next = 3;\n              return featurePost(_this0.post.id);\n            case 3:\n              response = _context0.sent;\n              if (response.code === 0) {\n                _this0.post.is_featured = !_this0.post.is_featured;\n                // this.$message.success(response.msg || (this.post.is_featured ? '加精成功' : '取消加精成功')) // 注释掉这行，避免重复显示成功消息\n              } else {\n                _this0.$message.error(response.msg || '操作失败');\n              }\n              _context0.next = 11;\n              break;\n            case 7:\n              _context0.prev = 7;\n              _context0.t0 = _context0[\"catch\"](0);\n              log('加精操作失败:', _context0.t0);\n              _this0.$message.error('加精操作失败');\n            case 11:\n            case \"end\":\n              return _context0.stop();\n          }\n        }, _callee0, null, [[0, 7]]);\n      }))();\n    },\n    // 提交评论\n    submitComment: function submitComment() {\n      var _this1 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee1() {\n        var token, response, userInfo, newComment, existingComment;\n        return _regeneratorRuntime().wrap(function _callee1$(_context1) {\n          while (1) switch (_context1.prev = _context1.next) {\n            case 0:\n              log('评论提交 - 登录状态检查:', {\n                isLogin: _this1.isLogin,\n                storeIsLoggedIn: _this1.$store.getters.isLoggedIn,\n                token: _this1.$store.state.token,\n                userInfo: _this1.$store.state.user,\n                localStorageToken: localStorage.getItem('token'),\n                localStorageUserInfo: localStorage.getItem('userInfo')\n              });\n\n              // 如果localStorage有token但store中认证状态为false，尝试强制刷新认证状态\n              if (!(!_this1.isLogin && localStorage.getItem('token'))) {\n                _context1.next = 6;\n                break;\n              }\n              log('检测到localStorage有token但store认证状态为false，尝试强制刷新认证状态');\n              _context1.next = 5;\n              return _this1.$store.dispatch('getUserInfo');\n            case 5:\n              // 重新检查登录状态\n              log('刷新后的登录状态:', {\n                isLogin: _this1.$store.getters.isLoggedIn,\n                token: _this1.$store.state.token,\n                userInfo: _this1.$store.state.user\n              });\n            case 6:\n              if (_this1.isLogin) {\n                _context1.next = 11;\n                break;\n              }\n              log('未登录状态，无法提交评论');\n              _this1.$message.warning('请先登录');\n              _this1.$router.push({\n                name: 'Login',\n                query: {\n                  redirect: _this1.$route.fullPath\n                }\n              });\n              return _context1.abrupt(\"return\");\n            case 11:\n              if (_this1.commentContent.trim()) {\n                _context1.next = 14;\n                break;\n              }\n              _this1.$message.warning('评论内容不能为空');\n              return _context1.abrupt(\"return\");\n            case 14:\n              _context1.prev = 14;\n              log('提交评论数据:', {\n                post: _this1.post.id,\n                content: _this1.commentContent,\n                token: _this1.$store.state.token\n              });\n\n              // 确保API请求中包含有效的token\n              token = _this1.$store.state.token || localStorage.getItem('token');\n              if (token) {\n                _context1.next = 22;\n                break;\n              }\n              log('提交评论时没有有效的token');\n              _this1.$message.error('登录状态异常，请重新登录');\n              _this1.$router.push({\n                name: 'Login',\n                query: {\n                  redirect: _this1.$route.fullPath\n                }\n              });\n              return _context1.abrupt(\"return\");\n            case 22:\n              _context1.next = 24;\n              return createComment({\n                post: _this1.post.id,\n                content: _this1.commentContent\n              });\n            case 24:\n              response = _context1.sent;\n              log('评论提交响应:', response);\n              if (!(response && (response.code === 0 || response.status === 0))) {\n                _context1.next = 36;\n                break;\n              }\n              // 不显示成功消息\n              log('评论发表成功，不显示成功消息');\n\n              // 清空评论内容\n              _this1.commentContent = '';\n\n              // 无论如何，强制刷新评论列表以确保同步\n              log('强制刷新评论列表以确保与数据库同步');\n              _this1.forceRefresh = true;\n              _context1.next = 33;\n              return _this1.fetchComments(_this1.post.id);\n            case 33:\n              // 只有在确认获取到评论数据时，才尝试本地添加\n              if (response.data && response.data.id) {\n                log('获取到新评论数据，ID:', response.data.id);\n\n                // 获取当前用户信息\n                userInfo = _this1.$store.getters.userInfo; // 构建评论对象\n                newComment = _objectSpread(_objectSpread({}, response.data), {}, {\n                  id: response.data.id,\n                  user: userInfo,\n                  replies: [],\n                  created_at: response.data.created_at || new Date().toISOString()\n                }); // 将新评论添加到评论列表的开头（如果不在列表中）\n                existingComment = _this1.comments.find(function (c) {\n                  return c.id === newComment.id;\n                });\n                if (!existingComment) {\n                  _this1.comments.unshift(newComment);\n                  log('新评论已添加到列表');\n                }\n              }\n              _context1.next = 38;\n              break;\n            case 36:\n              log('评论发表失败，响应:', response);\n              _this1.$message.error((response === null || response === void 0 ? void 0 : response.msg) || '评论发表失败');\n            case 38:\n              _context1.next = 46;\n              break;\n            case 40:\n              _context1.prev = 40;\n              _context1.t0 = _context1[\"catch\"](14);\n              log('评论发表失败:', _context1.t0);\n              _this1.$message.error('评论发表失败，请检查网络连接');\n\n              // 发生错误时也刷新评论列表\n              _this1.forceRefresh = true;\n              _this1.fetchComments(_this1.post.id);\n            case 46:\n            case \"end\":\n              return _context1.stop();\n          }\n        }, _callee1, null, [[14, 40]]);\n      }))();\n    },\n    // 回复评论\n    handleReply: function handleReply(comment) {\n      var reply = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      if (!this.isLogin) {\n        this.$message.warning('请先登录');\n        this.$router.push({\n          name: 'Login',\n          query: {\n            redirect: this.$route.fullPath\n          }\n        });\n        return;\n      }\n      this.replyingTo = comment.id;\n      this.replyContent = reply ? \"@\".concat(reply.user.nickname || reply.user.username, \" \") : '';\n    },\n    // 取消回复\n    cancelReply: function cancelReply() {\n      this.replyingTo = null;\n      this.replyContent = '';\n    },\n    // 提交回复\n    submitReply: function submitReply(comment) {\n      var _this10 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10() {\n        var response, userInfo, newReply, existingReply;\n        return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n          while (1) switch (_context10.prev = _context10.next) {\n            case 0:\n              if (_this10.isLogin) {\n                _context10.next = 4;\n                break;\n              }\n              _this10.$message.warning('请先登录');\n              _this10.$router.push({\n                name: 'Login',\n                query: {\n                  redirect: _this10.$route.fullPath\n                }\n              });\n              return _context10.abrupt(\"return\");\n            case 4:\n              if (_this10.replyContent.trim()) {\n                _context10.next = 7;\n                break;\n              }\n              _this10.$message.warning('回复内容不能为空');\n              return _context10.abrupt(\"return\");\n            case 7:\n              _context10.prev = 7;\n              log('提交回复数据:', {\n                post: _this10.post.id,\n                parent: comment.id,\n                content: _this10.replyContent\n              });\n              _context10.next = 11;\n              return replyComment(_this10.post.id, comment.id, _this10.replyContent);\n            case 11:\n              response = _context10.sent;\n              log('回复提交响应:', response);\n              if (!(response && (response.code === 0 || response.status === 0))) {\n                _context10.next = 23;\n                break;\n              }\n              // 清空回复状态\n              _this10.replyingTo = null;\n              _this10.replyContent = '';\n\n              // 无论如何，强制刷新评论列表以确保同步\n              log('强制刷新评论列表以确保与数据库同步');\n              _this10.forceRefresh = true;\n              _context10.next = 20;\n              return _this10.fetchComments(_this10.post.id);\n            case 20:\n              // 只有在确认获取到回复数据时，才尝试本地添加\n              if (response.data && response.data.id) {\n                log('获取到新回复数据，ID:', response.data.id);\n\n                // 获取当前用户信息\n                userInfo = _this10.$store.getters.userInfo; // 构建回复对象\n                newReply = _objectSpread(_objectSpread({}, response.data), {}, {\n                  id: response.data.id,\n                  user: userInfo,\n                  created_at: response.data.created_at || new Date().toISOString()\n                }); // 将新回复添加到对应评论的回复列表（如果不在列表中）\n                if (!comment.replies) {\n                  comment.replies = [];\n                }\n                existingReply = comment.replies.find(function (r) {\n                  return r.id === newReply.id;\n                });\n                if (!existingReply) {\n                  comment.replies.push(newReply);\n                  log('新回复已添加到列表');\n                }\n              }\n              _context10.next = 25;\n              break;\n            case 23:\n              log('回复发表失败，响应:', response);\n              _this10.$message.error((response === null || response === void 0 ? void 0 : response.msg) || '回复发表失败');\n            case 25:\n              _context10.next = 33;\n              break;\n            case 27:\n              _context10.prev = 27;\n              _context10.t0 = _context10[\"catch\"](7);\n              log('回复发表失败:', _context10.t0);\n              _this10.$message.error('回复发表失败，请检查网络连接');\n\n              // 发生错误时也刷新评论列表\n              _this10.forceRefresh = true;\n              _this10.fetchComments(_this10.post.id);\n            case 33:\n            case \"end\":\n              return _context10.stop();\n          }\n        }, _callee10, null, [[7, 27]]);\n      }))();\n    },\n    // 判断是否可以管理评论\n    canManageComment: function canManageComment(comment) {\n      return this.isLogin && (this.isAdmin || comment.user && comment.user.id === this.userId);\n    },\n    // 删除评论\n    handleDeleteComment: function handleDeleteComment(comment) {\n      var _this11 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee11() {\n        var _error$response$data;\n        var commentId, hasReplies, confirmMessage, loading, response;\n        return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n          while (1) switch (_context11.prev = _context11.next) {\n            case 0:\n              _context11.prev = 0;\n              // 打印评论对象，用于调试\n              log('要删除的评论对象:', comment);\n\n              // 确保评论对象和ID存在\n              if (comment) {\n                _context11.next = 5;\n                break;\n              }\n              _this11.$message.error('评论数据无效，无法删除');\n              return _context11.abrupt(\"return\");\n            case 5:\n              // 获取评论ID，支持字符串和数字类型\n              commentId = comment.id ? parseInt(comment.id) : null;\n              if (commentId) {\n                _context11.next = 9;\n                break;\n              }\n              _this11.$message.error('评论ID无效，无法删除');\n              return _context11.abrupt(\"return\");\n            case 9:\n              // 判断是否有回复，提供更详细的确认信息\n              hasReplies = comment.replies && comment.replies.length > 0;\n              confirmMessage = hasReplies ? \"\\u786E\\u5B9A\\u8981\\u5220\\u9664\\u8FD9\\u6761\\u8BC4\\u8BBA\\u5417\\uFF1F\\u5220\\u9664\\u540E\\u5C06\\u540C\\u65F6\\u5220\\u9664\\u8BE5\\u8BC4\\u8BBA\\u4E0B\\u7684 \".concat(comment.replies.length, \" \\u6761\\u56DE\\u590D\\uFF0C\\u4E14\\u65E0\\u6CD5\\u6062\\u590D\\u3002\") : '确定要删除这条评论吗？删除后将无法恢复。';\n              _context11.next = 13;\n              return _this11.$confirm(confirmMessage, '删除确认', {\n                confirmButtonText: '确定删除',\n                cancelButtonText: '取消',\n                type: 'warning',\n                distinguishCancelAndClose: true,\n                closeOnClickModal: false\n              });\n            case 13:\n              // 显示加载状态\n              loading = _this11.$loading({\n                lock: true,\n                text: '正在删除评论...',\n                spinner: 'el-icon-loading',\n                background: 'rgba(0, 0, 0, 0.7)'\n              });\n              _context11.prev = 14;\n              log('发送删除评论请求，ID:', commentId);\n              _context11.next = 18;\n              return deleteComment(commentId);\n            case 18:\n              response = _context11.sent;\n              loading.close(); // 关闭加载状态\n\n              // 修改判断条件，同时支持code: 0和status: 0作为成功状态\n              if (!(response.code === 0 || response.status === 0)) {\n                _context11.next = 28;\n                break;\n              }\n              log('评论删除成功，响应:', response);\n\n              // 无论如何，强制刷新评论列表以确保同步\n              log('强制刷新评论列表以确保与数据库同步');\n              _this11.forceRefresh = true;\n              _context11.next = 26;\n              return _this11.fetchComments(_this11.post.id);\n            case 26:\n              _context11.next = 33;\n              break;\n            case 28:\n              log('评论删除失败，响应:', response);\n              _this11.$message.error(response.msg || '删除失败，请稍后重试');\n\n              // 如果删除失败，也刷新评论列表恢复原状\n              _this11.forceRefresh = true;\n              _context11.next = 33;\n              return _this11.fetchComments(_this11.post.id);\n            case 33:\n              _context11.next = 54;\n              break;\n            case 35:\n              _context11.prev = 35;\n              _context11.t0 = _context11[\"catch\"](14);\n              loading.close();\n              log('删除评论失败:', _context11.t0);\n\n              // 如果删除失败，刷新评论列表恢复原状\n              _this11.forceRefresh = true;\n              _context11.next = 42;\n              return _this11.fetchComments(_this11.post.id);\n            case 42:\n              if (!_context11.t0.response) {\n                _context11.next = 53;\n                break;\n              }\n              _context11.t1 = _context11.t0.response.status;\n              _context11.next = _context11.t1 === 403 ? 46 : _context11.t1 === 404 ? 48 : 50;\n              break;\n            case 46:\n              _this11.$message.error('您没有权限删除此评论');\n              return _context11.abrupt(\"break\", 51);\n            case 48:\n              _this11.$message.error('评论不存在或已被删除');\n              return _context11.abrupt(\"break\", 51);\n            case 50:\n              _this11.$message.error(((_error$response$data = _context11.t0.response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.msg) || '删除失败，请稍后重试');\n            case 51:\n              _context11.next = 54;\n              break;\n            case 53:\n              if (_context11.t0.request) {\n                _this11.$message.error('网络连接失败，请检查网络后重试');\n              } else {\n                _this11.$message.error('删除失败，请稍后重试');\n              }\n            case 54:\n              _context11.next = 62;\n              break;\n            case 56:\n              _context11.prev = 56;\n              _context11.t2 = _context11[\"catch\"](0);\n              if (!(_context11.t2 === 'cancel')) {\n                _context11.next = 60;\n                break;\n              }\n              return _context11.abrupt(\"return\");\n            case 60:\n              log('删除评论操作失败:', _context11.t2);\n              _this11.$message.error('操作失败，请稍后重试');\n            case 62:\n            case \"end\":\n              return _context11.stop();\n          }\n        }, _callee11, null, [[0, 56], [14, 35]]);\n      }))();\n    },\n    handleContentChange: function handleContentChange(value) {\n      this.post.content = value;\n    }\n  }\n};","map":{"version":3,"names":["getPostDetail","likePost","favoritePost","pinPost","featurePost","deletePost","updatePost","getLikeStatus","getFavoriteStatus","getPostComments","createComment","replyComment","deleteComment","formatDateTime","mapGetters","RichTextEditor","DEBUG","log","_console","console","apply","arguments","formatDate","date","name","components","data","loading","commentsLoading","post","isLiked","isFavorited","comments","commentsTotal","commentsQuery","page","limit","commentContent","replyingTo","replyContent","forceRefresh","isEditing","editPostSubmitting","editPostForm","title","content","postRules","required","message","trigger","min","max","computed","_objectSpread","isLogin","$store","getters","isLoggedIn","isPostAuthor","user","id","userId","canManagePost","isAdmin","created","postId","$route","params","fetchPostDetail","fetchComments","$router","push","methods","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","code","status","msg","postData","wrap","_callee$","_context","prev","next","sent","abrupt","_objectWithoutProperties","_excluded","Object","keys","length","$message","error","_typeof","ensurePostFields","checkLikeAndFavorite","t0","finish","stop","created_at","Date","toISOString","views","likes_count","comments_count","is_pinned","is_featured","board","username","nickname","avatar_url","_this2","_callee2","_likeResponse$data","_favoriteResponse$dat","_yield$Promise$all","_yield$Promise$all2","likeResponse","favoriteResponse","_callee2$","_context2","Promise","all","_slicedToArray","is_liked","is_favorited","_this3","_callee3","_callee3$","_context3","resolve","processCommentsResponse","total","results","count","Array","isArray","filter","comment","map","replies","handleCommentsPageChange","goToBoard","goToUserProfile","warning","handleFavorite","_this4","_callee4","previousState","_callee4$","_context4","query","redirect","fullPath","$notify","type","position","duration","showClose","customClass","handleLike","_this5","_callee5","_callee5$","_context5","handleCommand","command","_this6","_callee6","_callee6$","_context6","handlePinPost","handleFeaturePost","handleEditPost","cancelEdit","submitEdit","_this7","_callee7","_callee7$","_context7","trim","updated_at","setTimeout","handleDeletePost","_this8","_callee8","_callee8$","_context8","$confirm","confirmButtonText","cancelButtonText","distinguishCancelAndClose","closeOnClickModal","$loading","lock","text","spinner","background","close","go","t1","_this9","_callee9","_callee9$","_context9","_this0","_callee0","_callee0$","_context0","submitComment","_this1","_callee1","token","userInfo","newComment","existingComment","_callee1$","_context1","storeIsLoggedIn","state","localStorageToken","localStorage","getItem","localStorageUserInfo","dispatch","find","c","unshift","handleReply","reply","undefined","concat","cancelReply","submitReply","_this10","_callee10","newReply","existingReply","_callee10$","_context10","parent","r","canManageComment","handleDeleteComment","_this11","_callee11","_error$response$data","commentId","hasReplies","confirmMessage","_callee11$","_context11","parseInt","request","t2","handleContentChange","value"],"sources":["H:\\ForumServers\\ForumFrontend\\src\\views\\post\\PostDetail.vue"],"sourcesContent":["<template>\n  <div class=\"post-detail-container\">\n    <!-- 帖子详情卡片 -->\n    <el-card class=\"post-detail-card\">\n      <div v-if=\"loading\" class=\"loading-container\">\n        <el-skeleton :rows=\"10\" animated />\n      </div>\n      <div v-else>\n        <div class=\"post-header\">\n          <!-- 非编辑状态下的标题 -->\n          <h1 v-if=\"!isEditing\" class=\"post-title\">\n            <el-tag v-if=\"post.is_pinned\" size=\"medium\" type=\"danger\">置顶</el-tag>\n            <el-tag v-if=\"post.is_featured\" size=\"medium\" type=\"success\">精华</el-tag>\n            {{ post.title }}\n          </h1>\n          <!-- 编辑状态下的标题输入框 -->\n          <div v-else class=\"post-title-edit\">\n            <el-input v-model=\"editPostForm.title\" placeholder=\"请输入帖子标题\"></el-input>\n          </div>\n\n          <div class=\"post-meta\">\n            <div class=\"post-author\" @click=\"goToUserProfile(post.user?.id)\" style=\"cursor: pointer;\">\n              <el-avatar :size=\"40\" :src=\"post.user?.avatar_url || ''\">\n                {{ post.user?.nickname?.charAt(0) || post.user?.username?.charAt(0) || 'U' }}\n              </el-avatar>\n              <div class=\"author-info\">\n                <div class=\"author-name\">{{ post.user?.nickname || post.user?.username }}</div>\n                <div class=\"post-time\">发布于 {{ formatDate(post.created_at) }}</div>\n              </div>\n            </div>\n            <div class=\"post-board\" @click=\"goToBoard\">\n              <i class=\"el-icon-s-grid\"></i>\n              <span>{{ post.board?.name }}</span>\n            </div>\n          </div>\n        </div>\n\n        <!-- 非编辑状态下的内容 -->\n        <div v-if=\"!isEditing\" class=\"post-content\" v-html=\"post.content\"></div>\n\n        <!-- 编辑状态下的内容输入框 -->\n        <div v-else class=\"post-content-edit\">\n          <el-input\n            v-model=\"editPostForm.title\"\n            placeholder=\"请输入帖子标题\"\n          ></el-input>\n          <rich-text-editor\n            v-model=\"editPostForm.content\"\n            :disabled=\"false\"\n            @change=\"handleContentChange\"\n          />\n          <!-- 编辑状态下的操作按钮 -->\n          <div class=\"edit-actions\">\n            <el-button @click=\"cancelEdit\">取消</el-button>\n            <el-button type=\"primary\" @click=\"submitEdit\" :loading=\"editPostSubmitting\">提交</el-button>\n          </div>\n        </div>\n\n        <div class=\"post-footer\">\n          <div class=\"post-stats\">\n            <span>\n              <el-icon><View /></el-icon>\n              {{ post.views }}\n            </span>\n            <span>\n              <el-icon><Star /></el-icon>\n              {{ post.likes_count }}\n            </span>\n            <span>\n              <el-icon><ChatDotRound /></el-icon>\n              {{ post.comments_count }}\n            </span>\n          </div>\n          <div class=\"post-actions\">\n            <!-- 帖子作者可见的操作按钮 -->\n            <template v-if=\"isPostAuthor\">\n              <el-button\n                type=\"primary\"\n                size=\"small\"\n                @click=\"handleEditPost\"\n              >\n                <el-icon><Edit /></el-icon>\n                编辑\n              </el-button>\n              <el-button\n                type=\"danger\"\n                size=\"small\"\n                @click=\"handleDeletePost\"\n              >\n                <el-icon><Delete /></el-icon>\n                删除\n              </el-button>\n            </template>\n\n            <!-- 非作者可见的操作按钮 -->\n            <template v-else>\n              <el-button\n                :type=\"isLiked ? 'primary' : 'default'\"\n                size=\"small\"\n                @click=\"handleLike\"\n              >\n                <el-icon><Star /></el-icon>\n                {{ isLiked ? '已点赞' : '点赞' }}\n              </el-button>\n              <el-button\n                :type=\"isFavorited ? 'warning' : 'default'\"\n                size=\"small\"\n                @click=\"handleFavorite\"\n              >\n                <el-icon><Collection /></el-icon>\n                {{ isFavorited ? '已收藏' : '收藏' }}\n              </el-button>\n            </template>\n\n            <!-- 管理员操作下拉菜单 -->\n            <el-dropdown v-if=\"isAdmin\" trigger=\"click\" @command=\"handleCommand\">\n              <el-button size=\"small\">\n                <el-icon><Setting /></el-icon>\n                管理\n              </el-button>\n              <template #dropdown>\n                <el-dropdown-menu>\n                  <el-dropdown-item command=\"pin\">\n                    {{ post.is_pinned ? '取消置顶' : '置顶' }}\n                  </el-dropdown-item>\n                  <el-dropdown-item command=\"feature\">\n                    {{ post.is_featured ? '取消加精' : '加精' }}\n                  </el-dropdown-item>\n                </el-dropdown-menu>\n              </template>\n            </el-dropdown>\n          </div>\n        </div>\n      </div>\n    </el-card>\n\n    <!-- 评论区 -->\n    <el-card class=\"comments-card\">\n      <div slot=\"header\" class=\"clearfix\">\n        <span>评论区 ({{ post.comments_count || 0 }})</span>\n      </div>\n\n      <!-- 发表评论 -->\n      <div class=\"comment-form\">\n        <el-input\n          v-model=\"commentContent\"\n          type=\"textarea\"\n          :rows=\"3\"\n          placeholder=\"发表你的评论...\"\n          :disabled=\"!isLogin\"\n        ></el-input>\n        <div class=\"comment-form-footer\">\n          <el-button\n            type=\"primary\"\n            :disabled=\"!isLogin || !commentContent.trim()\"\n            @click=\"submitComment\"\n          >\n            发表评论\n          </el-button>\n          <div v-if=\"!isLogin\" class=\"login-tip\">\n            请先 <router-link :to=\"{ name: 'Login', query: { redirect: $route.fullPath } }\">登录</router-link> 后发表评论\n          </div>\n        </div>\n      </div>\n\n      <!-- 评论列表 -->\n      <div v-if=\"commentsLoading\" class=\"loading-container\">\n        <el-skeleton :rows=\"5\" animated />\n      </div>\n      <div v-else-if=\"comments.length === 0\" class=\"empty-comments\">\n        <i class=\"el-icon-chat-dot-round\"></i>\n        <p v-if=\"isLogin\">暂无评论，快来发表第一条评论吧！</p>\n        <p v-else>暂无评论，登录后可以发表评论</p>\n      </div>\n      <div v-else class=\"comments-list\">\n        <div v-for=\"comment in comments\" :key=\"comment.id\" class=\"comment-item\">\n          <div class=\"comment-header\">\n            <div class=\"comment-user\" @click=\"goToUserProfile(comment.user?.id)\" style=\"cursor: pointer;\">\n              <el-avatar :size=\"40\" :src=\"comment.user?.avatar_url || ''\">\n                {{ comment.user?.nickname?.charAt(0) || comment.user?.username?.charAt(0) || 'U' }}\n              </el-avatar>\n              <div class=\"comment-user-info\">\n                <div class=\"comment-username\">{{ comment.user.nickname || comment.user.username }}</div>\n                <div class=\"comment-time\">{{ formatDate(comment.created_at) }}</div>\n              </div>\n            </div>\n            <div class=\"comment-actions\" v-if=\"canManageComment(comment)\">\n              <el-button type=\"link\" size=\"small\" @click=\"handleDeleteComment(comment)\">删除</el-button>\n            </div>\n          </div>\n          <div class=\"comment-content\">{{ comment.content }}</div>\n          <div class=\"comment-footer\">\n            <el-button v-if=\"isLogin\" type=\"link\" size=\"small\" @click=\"handleReply(comment)\">回复</el-button>\n          </div>\n\n          <!-- 回复表单 -->\n          <div v-if=\"replyingTo === comment.id\" class=\"reply-form\">\n            <el-input\n              v-model=\"replyContent\"\n              type=\"textarea\"\n              :rows=\"2\"\n              placeholder=\"回复评论...\"\n            ></el-input>\n            <div class=\"reply-form-footer\">\n              <el-button type=\"primary\" size=\"small\" @click=\"submitReply(comment)\" :disabled=\"!replyContent.trim()\">提交回复</el-button>\n              <el-button size=\"small\" @click=\"cancelReply\">取消</el-button>\n            </div>\n          </div>\n\n          <!-- 回复列表 -->\n          <div v-if=\"comment.replies && comment.replies.length > 0\" class=\"replies-list\">\n            <div v-for=\"reply in comment.replies\" :key=\"reply.id\" class=\"reply-item\">\n              <div class=\"reply-header\">\n                <div class=\"reply-user\" @click=\"goToUserProfile(reply.user?.id)\" style=\"cursor: pointer;\">\n                  <el-avatar :size=\"30\" :src=\"reply.user?.avatar_url || ''\">\n                    {{ reply.user?.nickname?.charAt(0) || reply.user?.username?.charAt(0) || 'U' }}\n                  </el-avatar>\n                  <div class=\"reply-user-info\">\n                    <div class=\"reply-username\">{{ reply.user.nickname || reply.user.username }}</div>\n                    <div class=\"reply-time\">{{ formatDate(reply.created_at) }}</div>\n                  </div>\n                </div>\n                <div class=\"reply-actions\" v-if=\"canManageComment(reply)\">\n                  <el-button type=\"link\" size=\"small\" @click=\"handleDeleteComment(reply)\">删除</el-button>\n                </div>\n              </div>\n              <div class=\"reply-content\">{{ reply.content }}</div>\n              <div class=\"reply-footer\">\n                <el-button v-if=\"isLogin\" type=\"link\" size=\"small\" @click=\"handleReply(comment, reply)\">回复</el-button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div v-if=\"comments.length > 0\" class=\"pagination-container\">\n        <el-pagination\n          background\n          layout=\"prev, pager, next\"\n          :total=\"commentsTotal\"\n          :page-size=\"commentsQuery.limit\"\n          :current-page=\"commentsQuery.page\"\n          @update:current-page=\"val => commentsQuery.page = val\"\n          @current-change=\"handleCommentsPageChange\"\n        >\n        </el-pagination>\n      </div>\n    </el-card>\n\n  </div>\n</template>\n\n<script>\nimport { getPostDetail, likePost, favoritePost, pinPost, featurePost, deletePost, updatePost, getLikeStatus, getFavoriteStatus } from '@/api/post'\nimport { getPostComments, createComment, replyComment, deleteComment } from '@/api/comment'\nimport { formatDateTime } from '@/utils/index'\nimport { mapGetters } from 'vuex'\nimport RichTextEditor from '@/components/RichTextEditor.vue'\n\n// 是否启用调试日志\nconst DEBUG = false;\n\n// 自定义日志函数，可以通过DEBUG开关控制\nconst log = (...args) => {\n  if (DEBUG) {\n    console.log(...args);\n  }\n};\n\n// 格式化日期函数\nconst formatDate = (date) => {\n  return formatDateTime(date)\n}\n\nexport default {\n  name: 'PostDetail',\n  components: {\n    RichTextEditor\n  },\n  data() {\n    return {\n      loading: false,\n      commentsLoading: false,\n      post: {},\n      isLiked: false,\n      isFavorited: false,\n      comments: [],\n      commentsTotal: 0,\n      commentsQuery: {\n        page: 1,\n        limit: 10\n      },\n      commentContent: '',\n      replyingTo: null,\n      replyContent: '',\n\n      forceRefresh: false, // 用于强制刷新评论列表的内部标志\n\n      // 编辑帖子相关\n      isEditing: false, // 是否处于编辑状态\n      editPostSubmitting: false,\n      editPostForm: {\n        title: '',\n        content: ''\n      },\n      postRules: {\n        title: [\n          { required: true, message: '请输入帖子标题', trigger: 'blur' },\n          { min: 2, max: 100, message: '标题长度在2到100个字符之间', trigger: 'blur' }\n        ],\n        content: [\n          { required: true, message: '请输入帖子内容', trigger: 'blur' },\n          { min: 5, message: '内容至少5个字符', trigger: 'blur' }\n        ]\n      }\n    }\n  },\n  computed: {\n    ...mapGetters([\n      'isAuthenticated',\n      'isAdmin',\n      'userId'\n    ]),\n    isLogin() {\n      return this.$store.getters.isLoggedIn\n    },\n    isPostAuthor() {\n      return this.isLogin && this.post.user && this.post.user.id === this.userId\n    },\n    canManagePost() {\n      return this.isLogin && (\n        this.isAdmin ||\n        this.isPostAuthor\n      )\n    }\n  },\n  created() {\n    log('PostDetail组件created，登录状态:', this.isLogin, '认证状态:', this.$store.getters.isLoggedIn)\n    const postId = this.$route.params.id\n    if (postId) {\n      log('准备获取帖子详情和评论，ID:', postId)\n      this.fetchPostDetail(postId)\n      this.fetchComments(postId)\n    } else {\n      log('没有帖子ID，跳转到帖子列表')\n      this.$router.push({ name: 'PostList' })\n    }\n  },\n  methods: {\n    formatDate,\n\n    // 获取帖子详情\n    async fetchPostDetail(id) {\n      this.loading = true\n      try {\n        log('组件开始获取帖子详情, ID:', id)\n        const response = await getPostDetail(id)\n        log('组件收到帖子详情响应:', response)\n\n        // 检查响应是否有效\n        if (!response) {\n          log('帖子详情响应为空')\n          this.post = {}\n          return\n        }\n\n        // 检查响应中的数据\n        if (response.data) {\n          log('使用响应中的data字段:', response.data)\n          this.post = response.data\n        } else if (response.code === 0 || response.status === 0) {\n          log('响应成功但没有data字段，尝试使用响应本身')\n          // 移除code、status、msg等字段，只保留实际数据\n          const { code, status, msg, ...postData } = response\n          if (Object.keys(postData).length > 0) {\n            this.post = postData\n          } else {\n            log('响应中没有有效的帖子数据')\n            this.$message.error('获取帖子详情失败，请稍后再试')\n            this.post = {}\n          }\n        } else if (typeof response === 'object') {\n          log('直接使用响应对象')\n          this.post = response\n        } else {\n          log('无法从响应中提取帖子数据')\n          this.$message.error('获取帖子详情失败，请稍后再试')\n          this.post = {}\n        }\n        \n        // 确保post对象包含必要的字段\n        this.ensurePostFields()\n        \n        // 检查是否已点赞和收藏\n        this.checkLikeAndFavorite()\n      } catch (error) {\n        log('获取帖子详情失败:', error)\n        this.$message.error('获取帖子详情失败，请稍后再试')\n        this.post = {}\n        // 确保post对象包含必要的字段\n        this.ensurePostFields()\n      } finally {\n        this.loading = false\n      }\n    },\n\n    // 确保帖子对象包含所有必要的字段\n    ensurePostFields() {\n      // 确保post是一个对象\n      if (!this.post || typeof this.post !== 'object') {\n        this.post = {}\n      }\n      \n      // 确保必要的字段存在\n      this.post.title = this.post.title || '帖子标题'\n      this.post.content = this.post.content || '帖子内容'\n      this.post.created_at = this.post.created_at || new Date().toISOString()\n      this.post.views = this.post.views || 0\n      this.post.likes_count = this.post.likes_count || 0\n      this.post.comments_count = this.post.comments_count || 0\n      this.post.is_pinned = this.post.is_pinned || false\n      this.post.is_featured = this.post.is_featured || false\n      \n      // 确保board字段存在\n      if (!this.post.board || typeof this.post.board !== 'object') {\n        this.post.board = { id: 1, name: '默认板块' }\n      } else if (typeof this.post.board === 'number') {\n        // 如果board只是一个ID，转换为对象\n        this.post.board = { id: this.post.board, name: '板块' + this.post.board }\n      }\n      \n      // 确保board.name字段存在\n      if (!this.post.board.name) {\n        this.post.board.name = '板块' + this.post.board.id\n      }\n      \n      // 确保user字段存在\n      if (!this.post.user || typeof this.post.user !== 'object') {\n        this.post.user = {\n          id: 1,\n          username: 'user',\n          nickname: '用户',\n          avatar_url: ''\n        }\n      }\n      \n      // 确保user.nickname字段存在\n      if (!this.post.user.nickname) {\n        this.post.user.nickname = this.post.user.username || '用户'\n      }\n    },\n\n    // 检查是否已点赞和收藏\n    async checkLikeAndFavorite() {\n      if (!this.isLogin) {\n        log('未登录用户，设置为未点赞和未收藏状态')\n        this.isLiked = false\n        this.isFavorited = false\n        return\n      }\n\n      try {\n        // 并行请求点赞和收藏状态\n        const [likeResponse, favoriteResponse] = await Promise.all([\n          getLikeStatus(this.post.id),\n          getFavoriteStatus(this.post.id)\n        ]);\n\n        // 更新点赞状态\n        this.isLiked = likeResponse.data?.is_liked || false;\n        // 更新收藏状态\n        this.isFavorited = favoriteResponse.data?.is_favorited || false;\n\n        log('获取状态成功:', {\n          isLiked: this.isLiked,\n          isFavorited: this.isFavorited\n        });\n      } catch (error) {\n        log('获取点赞/收藏状态失败:', error);\n        // 状态获取失败时，默认为未点赞和未收藏\n        this.isLiked = false;\n        this.isFavorited = false;\n      }\n    },\n\n    // 获取评论列表\n    async fetchComments(postId) {\n      // 如果已经在加载中，则不重复加载\n      if (this.commentsLoading && !this.forceRefresh) {\n        return Promise.resolve()\n      }\n\n      this.commentsLoading = true\n      log('开始获取评论列表，ID:', postId, '强制刷新:', this.forceRefresh)\n\n      try {\n        // 使用API函数的forceRefresh参数\n        const response = await getPostComments(postId, this.forceRefresh)\n        log('评论列表响应:', response)\n        \n        // 处理响应\n        this.processCommentsResponse(response)\n      } catch (error) {\n        log('获取评论列表失败:', error)\n        // 设置空评论列表\n        this.comments = []\n        this.commentsTotal = 0\n        \n        // 未登录用户不显示错误提示\n        if (!(error.response && error.response.status === 401)) {\n          this.$message.error('获取评论列表失败，请刷新页面重试')\n        }\n      } finally {\n        this.commentsLoading = false\n        this.forceRefresh = false // 重置强制刷新标志\n        log('评论列表获取完成，重置强制刷新标志')\n      }\n    },\n    \n    // 处理评论列表响应\n    processCommentsResponse(response) {\n      // 如果响应为空，设置空评论列表\n      if (!response) {\n        log('评论列表响应为空，设置空评论列表')\n        this.comments = []\n        this.commentsTotal = 0\n        return\n      }\n      \n      // 提取评论数据和总数\n      let comments = []\n      let total = 0\n      \n      if (response.data && response.data.results) {\n        // 标准格式：{data: {results: [...], count: 10}}\n        comments = response.data.results\n        total = response.data.count || 0\n      } else if (response.results) {\n        // 直接结果格式：{results: [...], count: 10}\n        comments = response.results\n        total = response.count || 0\n      } else if (Array.isArray(response)) {\n        // 数组格式：[...]\n        comments = response\n        total = response.length\n      } else if (response.data && Array.isArray(response.data)) {\n        // 数组包装格式：{data: [...]}\n        comments = response.data\n        total = response.data.length\n      } else {\n        // 其他情况，设置空评论列表\n        log('无法从响应中提取评论数据，设置空评论列表')\n        this.comments = []\n        this.commentsTotal = 0\n        return\n      }\n      \n      // 确保评论数据有效\n      comments = comments.filter(comment => comment && typeof comment === 'object')\n      \n      // 处理评论数据\n      this.comments = comments.map(comment => {\n        // 确保replies字段存在\n        const replies = Array.isArray(comment.replies) ? comment.replies : []\n        \n        // 确保user字段存在\n        const user = comment.user || {\n          id: 0,\n          username: 'unknown',\n          nickname: '未知用户',\n          avatar_url: ''\n        }\n        \n        // 返回处理后的评论对象\n        return {\n          ...comment,\n          replies,\n          user\n        }\n      })\n      \n      this.commentsTotal = total\n      \n      // 更新帖子评论数\n      if (this.post) {\n        this.post.comments_count = total\n      }\n    },\n\n    // 评论分页变化\n    handleCommentsPageChange(page) {\n      this.commentsQuery.page = page\n      this.fetchComments(this.post.id)\n    },\n\n    // 前往板块页面\n    goToBoard() {\n      if (this.post.board && this.post.board.id) {\n        this.$router.push({ name: 'BoardDetail', params: { id: this.post.board.id } })\n      }\n    },\n\n    // 跳转到用户主页\n    goToUserProfile(userId) {\n      if (userId) {\n        this.$router.push({ name: 'UserProfile', params: { id: userId } });\n      } else {\n        this.$message.warning('无法获取用户信息');\n      }\n    },\n\n    // 收藏帖子\n    async handleFavorite() {\n      if (!this.isLogin) {\n        this.$message.warning('请先登录')\n        this.$router.push({ name: 'Login', query: { redirect: this.$route.fullPath } })\n        return\n      }\n\n      try {\n        // 先乐观更新UI状态\n        const previousState = this.isFavorited\n        this.isFavorited = !this.isFavorited\n        \n        const response = await favoritePost(this.post.id)\n        \n        // 使用 Notification 替代 Message\n        this.$notify({\n          title: this.isFavorited ? '收藏成功' : '已取消收藏',\n          message: this.isFavorited ? '帖子已添加到您的收藏列表' : '帖子已从您的收藏列表中移除',\n          type: this.isFavorited ? 'success' : 'info',\n          position: 'top-right',\n          duration: 2000,\n          showClose: false,\n          customClass: this.isFavorited ? 'favorite-notification success' : 'favorite-notification info'\n        })\n      } catch (error) {\n        log('收藏操作失败:', error)\n        // 恢复之前的状态\n        this.isFavorited = !this.isFavorited\n        \n        this.$notify.error({\n          title: '收藏操作失败',\n          message: error.message || '请稍后重试',\n          position: 'top-right',\n          duration: 3000\n        })\n        \n        // 如果是未登录错误，跳转到登录页\n        if (error.response && error.response.status === 401) {\n          this.$router.push({ name: 'Login', query: { redirect: this.$route.fullPath } })\n        }\n      }\n    },\n\n    // 点赞帖子\n    async handleLike() {\n      if (!this.isLogin) {\n        this.$message.warning('请先登录')\n        this.$router.push({ name: 'Login', query: { redirect: this.$route.fullPath } })\n        return\n      }\n\n      try {\n        const response = await likePost(this.post.id)\n        // 更新点赞状态\n        this.isLiked = !this.isLiked\n        // 更新点赞数\n        this.post.likes_count = this.isLiked ? this.post.likes_count + 1 : this.post.likes_count - 1\n        // 使用 Notification 替代 Message\n        this.$notify({\n          title: this.isLiked ? '点赞成功' : '已取消点赞',\n          message: this.isLiked ? '感谢您的支持！' : '您已取消点赞',\n          type: this.isLiked ? 'success' : 'info',\n          position: 'top-right',\n          duration: 2000,\n          showClose: false,\n          customClass: this.isLiked ? 'like-notification success' : 'like-notification info'\n        })\n      } catch (error) {\n        log('点赞操作失败:', error)\n        this.$notify.error({\n          title: '操作失败',\n          message: error.message || '请稍后重试',\n          position: 'top-right',\n          duration: 3000\n        })\n        // 如果是未登录错误，跳转到登录页\n        if (error.response && error.response.status === 401) {\n          this.$router.push({ name: 'Login', query: { redirect: this.$route.fullPath } })\n        }\n        // 操作失败时恢复原状态\n        await this.checkLikeAndFavorite()\n      }\n    },\n\n    // 帖子管理操作\n    async handleCommand(command) {\n      switch (command) {\n        case 'pin':\n          this.handlePinPost()\n          break\n        case 'feature':\n          this.handleFeaturePost()\n          break\n      }\n    }, \n    // 编辑帖子\n    handleEditPost() {\n      log('开始编辑帖子，原始内容:', {\n        title: this.post.title,\n        content: this.post.content\n      });\n      \n      // 初始化编辑表单数据\n      this.editPostForm = {\n        title: this.post.title,\n        content: this.post.content\n      };\n      \n      // 切换到编辑状态\n      this.isEditing = true;\n    },\n\n    // 取消编辑\n    cancelEdit() {\n      // 退出编辑状态\n      this.isEditing = false\n      // 重置表单数据\n      this.editPostForm.title = this.post.title\n      this.editPostForm.content = this.post.content\n    },\n\n    // 提交编辑\n    async submitEdit() {\n      // 表单验证\n      if (!this.editPostForm.title.trim()) {\n        this.$message.warning('标题不能为空')\n        return\n      }\n\n      if (!this.editPostForm.content.trim()) {\n        this.$message.warning('内容不能为空')\n        return\n      }\n\n      this.editPostSubmitting = true\n      try {\n        // 确保发送正确的数据格式\n        const postData = {\n          title: this.editPostForm.title.trim(),\n          content: this.editPostForm.content.trim(),\n          board: this.post.board.id // 需要包含板块ID\n        }\n\n        log('提交更新帖子数据:', postData)\n\n        const response = await updatePost(this.post.id, postData)\n\n        if (response && response.code === 0) {\n          // 更新成功\n          // this.$message.success('帖子更新成功') // 注释掉这行，避免重复显示成功消息\n\n          // 更新当前页面的帖子数据\n          this.post.title = this.editPostForm.title\n          this.post.content = this.editPostForm.content\n          // 更新帖子的更新时间\n          if (response.data && response.data.updated_at) {\n            this.post.updated_at = response.data.updated_at\n          }\n\n          // 强制退出编辑状态\n          log('强制退出编辑状态')\n          // 使用直接赋值和延时双重保险确保状态更新\n          this.isEditing = false\n\n          // 如果直接赋值不起作用，使用延时函数再次尝试\n          setTimeout(() => {\n            if (this.isEditing) {\n              log('使用setTimeout再次尝试退出编辑状态')\n              this.isEditing = false\n            }\n            log('编辑状态最终设置为:', this.isEditing)\n          }, 100)\n        } else {\n          this.$message.error(response?.msg || '更新失败，请稍后重试')\n          // 失败时也退出编辑状态\n          this.isEditing = false\n          setTimeout(() => {\n            if (this.isEditing) {\n              this.isEditing = false\n            }\n          }, 100)\n        }\n      } catch (error) {\n        log('更新帖子失败:', error)\n        this.$message.error('更新帖子失败，请检查网络连接')\n\n        // 出错时也退出编辑状态\n        this.isEditing = false\n        setTimeout(() => {\n          if (this.isEditing) {\n            this.isEditing = false\n          }\n        }, 100)\n      } finally {\n        this.editPostSubmitting = false\n      }\n    },\n\n    // 删除帖子\n    async handleDeletePost() {\n      try {\n        // 更详细的确认提示\n        await this.$confirm(\n          '确定要删除这篇帖子吗？删除后将无法恢复，帖子下的所有评论也将被删除。',\n          '删除确认',\n          {\n            confirmButtonText: '确定删除',\n            cancelButtonText: '取消',\n            type: 'warning',\n            distinguishCancelAndClose: true,\n            closeOnClickModal: false\n          }\n        )\n\n        // 显示加载状态\n        const loading = this.$loading({\n          lock: true,\n          text: '正在删除帖子...',\n          spinner: 'el-icon-loading',\n          background: 'rgba(0, 0, 0, 0.7)'\n        })\n\n        try {\n          const response = await deletePost(this.post.id)\n          loading.close() // 关闭加载状态\n\n          if (response.code === 0) {\n            // 不显示任何提示弹窗，直接返回上一级路由\n            log('帖子删除成功，正在返回上一级路由...')\n            // 返回上一级路由\n            this.$router.go(-1)\n          } else {\n            this.$message.error(response.msg || '删除失败，请稍后重试')\n          }\n        } catch (err) {\n          loading.close() // 确保加载状态被关闭\n          log('删除帖子请求失败:', err)\n          this.$message.error('删除帖子失败，请检查网络连接')\n        }\n      } catch (error) {\n        // 用户取消删除，不做任何处理\n        if (error !== 'cancel') {\n          log('删除帖子操作异常:', error)\n          this.$message.error('操作异常，请刷新页面后重试')\n        }\n      }\n    },\n\n    // 置顶/取消置顶帖子\n    async handlePinPost() {\n      try {\n        const response = await pinPost(this.post.id)\n        if (response.code === 0) {\n          this.post.is_pinned = !this.post.is_pinned\n          // this.$message.success(response.msg || (this.post.is_pinned ? '置顶成功' : '取消置顶成功')) // 注释掉这行，避免重复显示成功消息\n        } else {\n          this.$message.error(response.msg || '操作失败')\n        }\n      } catch (error) {\n        log('置顶操作失败:', error)\n        this.$message.error('置顶操作失败')\n      }\n    },\n\n    // 加精/取消加精帖子\n    async handleFeaturePost() {\n      try {\n        const response = await featurePost(this.post.id)\n        if (response.code === 0) {\n          this.post.is_featured = !this.post.is_featured\n          // this.$message.success(response.msg || (this.post.is_featured ? '加精成功' : '取消加精成功')) // 注释掉这行，避免重复显示成功消息\n        } else {\n          this.$message.error(response.msg || '操作失败')\n        }\n      } catch (error) {\n        log('加精操作失败:', error)\n        this.$message.error('加精操作失败')\n      }\n    },\n\n    // 提交评论\n    async submitComment() {\n      log('评论提交 - 登录状态检查:', {\n        isLogin: this.isLogin,\n        storeIsLoggedIn: this.$store.getters.isLoggedIn,\n        token: this.$store.state.token,\n        userInfo: this.$store.state.user,\n        localStorageToken: localStorage.getItem('token'),\n        localStorageUserInfo: localStorage.getItem('userInfo')\n      })\n\n      // 如果localStorage有token但store中认证状态为false，尝试强制刷新认证状态\n      if (!this.isLogin && localStorage.getItem('token')) {\n        log('检测到localStorage有token但store认证状态为false，尝试强制刷新认证状态');\n        await this.$store.dispatch('getUserInfo');\n        // 重新检查登录状态\n        log('刷新后的登录状态:', {\n          isLogin: this.$store.getters.isLoggedIn,\n          token: this.$store.state.token,\n          userInfo: this.$store.state.user\n        });\n      }\n      \n      if (!this.isLogin) {\n        log('未登录状态，无法提交评论')\n        this.$message.warning('请先登录')\n        this.$router.push({ name: 'Login', query: { redirect: this.$route.fullPath } })\n        return\n      }\n\n      if (!this.commentContent.trim()) {\n        this.$message.warning('评论内容不能为空')\n        return\n      }\n\n      try {\n        log('提交评论数据:', {\n          post: this.post.id,\n          content: this.commentContent,\n          token: this.$store.state.token\n        })\n\n        // 确保API请求中包含有效的token\n        const token = this.$store.state.token || localStorage.getItem('token');\n        if (!token) {\n          log('提交评论时没有有效的token');\n          this.$message.error('登录状态异常，请重新登录');\n          this.$router.push({ name: 'Login', query: { redirect: this.$route.fullPath } });\n          return;\n        }\n\n        const response = await createComment({\n          post: this.post.id,\n          content: this.commentContent\n        })\n\n        log('评论提交响应:', response)\n\n        if (response && (response.code === 0 || response.status === 0)) {\n          // 不显示成功消息\n          log('评论发表成功，不显示成功消息')\n\n          // 清空评论内容\n          this.commentContent = ''\n\n          // 无论如何，强制刷新评论列表以确保同步\n          log('强制刷新评论列表以确保与数据库同步')\n          this.forceRefresh = true\n          await this.fetchComments(this.post.id)\n\n          // 只有在确认获取到评论数据时，才尝试本地添加\n          if (response.data && response.data.id) {\n            log('获取到新评论数据，ID:', response.data.id)\n            \n            // 获取当前用户信息\n            const userInfo = this.$store.getters.userInfo\n            \n            // 构建评论对象\n            const newComment = {\n              ...response.data,\n              id: response.data.id,\n              user: userInfo,\n              replies: [],\n              created_at: response.data.created_at || new Date().toISOString()\n            };\n\n            // 将新评论添加到评论列表的开头（如果不在列表中）\n            const existingComment = this.comments.find(c => c.id === newComment.id)\n            if (!existingComment) {\n              this.comments.unshift(newComment);\n              log('新评论已添加到列表')\n            }\n          }\n        } else {\n          log('评论发表失败，响应:', response)\n          this.$message.error(response?.msg || '评论发表失败')\n        }\n      } catch (error) {\n        log('评论发表失败:', error)\n        this.$message.error('评论发表失败，请检查网络连接')\n        \n        // 发生错误时也刷新评论列表\n        this.forceRefresh = true\n        this.fetchComments(this.post.id)\n      }\n    },\n\n    // 回复评论\n    handleReply(comment, reply = null) {\n      if (!this.isLogin) {\n        this.$message.warning('请先登录')\n        this.$router.push({ name: 'Login', query: { redirect: this.$route.fullPath } })\n        return\n      }\n\n      this.replyingTo = comment.id\n      this.replyContent = reply ? `@${reply.user.nickname || reply.user.username} ` : ''\n    },\n\n    // 取消回复\n    cancelReply() {\n      this.replyingTo = null\n      this.replyContent = ''\n    },\n\n    // 提交回复\n    async submitReply(comment) {\n      if (!this.isLogin) {\n        this.$message.warning('请先登录')\n        this.$router.push({ name: 'Login', query: { redirect: this.$route.fullPath } })\n        return\n      }\n\n      if (!this.replyContent.trim()) {\n        this.$message.warning('回复内容不能为空')\n        return\n      }\n\n      try {\n        log('提交回复数据:', {\n          post: this.post.id,\n          parent: comment.id,\n          content: this.replyContent\n        })\n\n        const response = await replyComment(\n          this.post.id,\n          comment.id,\n          this.replyContent\n        )\n\n        log('回复提交响应:', response)\n\n        if (response && (response.code === 0 || response.status === 0)) {\n          // 清空回复状态\n          this.replyingTo = null\n          this.replyContent = ''\n\n          // 无论如何，强制刷新评论列表以确保同步\n          log('强制刷新评论列表以确保与数据库同步')\n          this.forceRefresh = true\n          await this.fetchComments(this.post.id)\n\n          // 只有在确认获取到回复数据时，才尝试本地添加\n          if (response.data && response.data.id) {\n            log('获取到新回复数据，ID:', response.data.id)\n            \n            // 获取当前用户信息\n            const userInfo = this.$store.getters.userInfo\n            \n            // 构建回复对象\n            const newReply = {\n              ...response.data,\n              id: response.data.id,\n              user: userInfo,\n              created_at: response.data.created_at || new Date().toISOString()\n            };\n\n            // 将新回复添加到对应评论的回复列表（如果不在列表中）\n            if (!comment.replies) {\n              comment.replies = [];\n            }\n            \n            const existingReply = comment.replies.find(r => r.id === newReply.id)\n            if (!existingReply) {\n              comment.replies.push(newReply);\n              log('新回复已添加到列表')\n            }\n          }\n        } else {\n          log('回复发表失败，响应:', response)\n          this.$message.error(response?.msg || '回复发表失败')\n        }\n      } catch (error) {\n        log('回复发表失败:', error)\n        this.$message.error('回复发表失败，请检查网络连接')\n        \n        // 发生错误时也刷新评论列表\n        this.forceRefresh = true\n        this.fetchComments(this.post.id)\n      }\n    },\n\n    // 判断是否可以管理评论\n    canManageComment(comment) {\n      return this.isLogin && (\n        this.isAdmin ||\n        (comment.user && comment.user.id === this.userId)\n      )\n    },\n\n    // 删除评论\n    async handleDeleteComment(comment) {\n      try {\n        // 打印评论对象，用于调试\n        log('要删除的评论对象:', comment)\n\n        // 确保评论对象和ID存在\n        if (!comment) {\n          this.$message.error('评论数据无效，无法删除')\n          return\n        }\n\n        // 获取评论ID，支持字符串和数字类型\n        const commentId = comment.id ? parseInt(comment.id) : null\n        if (!commentId) {\n          this.$message.error('评论ID无效，无法删除')\n          return\n        }\n\n        // 判断是否有回复，提供更详细的确认信息\n        const hasReplies = comment.replies && comment.replies.length > 0\n        const confirmMessage = hasReplies\n          ? `确定要删除这条评论吗？删除后将同时删除该评论下的 ${comment.replies.length} 条回复，且无法恢复。`\n          : '确定要删除这条评论吗？删除后将无法恢复。'\n\n        await this.$confirm(confirmMessage, '删除确认', {\n          confirmButtonText: '确定删除',\n          cancelButtonText: '取消',\n          type: 'warning',\n          distinguishCancelAndClose: true,\n          closeOnClickModal: false\n        })\n\n        // 显示加载状态\n        const loading = this.$loading({\n          lock: true,\n          text: '正在删除评论...',\n          spinner: 'el-icon-loading',\n          background: 'rgba(0, 0, 0, 0.7)'\n        })\n\n        try {\n          log('发送删除评论请求，ID:', commentId)\n          const response = await deleteComment(commentId)\n          loading.close() // 关闭加载状态\n\n          // 修改判断条件，同时支持code: 0和status: 0作为成功状态\n          if (response.code === 0 || response.status === 0) {\n            log('评论删除成功，响应:', response)\n            \n            // 无论如何，强制刷新评论列表以确保同步\n            log('强制刷新评论列表以确保与数据库同步')\n            this.forceRefresh = true\n            await this.fetchComments(this.post.id)\n          } else {\n            log('评论删除失败，响应:', response)\n            this.$message.error(response.msg || '删除失败，请稍后重试')\n            \n            // 如果删除失败，也刷新评论列表恢复原状\n            this.forceRefresh = true\n            await this.fetchComments(this.post.id)\n          }\n        } catch (error) {\n          loading.close()\n          log('删除评论失败:', error)\n          \n          // 如果删除失败，刷新评论列表恢复原状\n          this.forceRefresh = true\n          await this.fetchComments(this.post.id)\n          \n          // 根据错误类型显示不同的错误信息\n          if (error.response) {\n            switch (error.response.status) {\n              case 403:\n                this.$message.error('您没有权限删除此评论')\n                break\n              case 404:\n                this.$message.error('评论不存在或已被删除')\n                break\n              default:\n                this.$message.error(error.response.data?.msg || '删除失败，请稍后重试')\n            }\n          } else if (error.request) {\n            this.$message.error('网络连接失败，请检查网络后重试')\n          } else {\n            this.$message.error('删除失败，请稍后重试')\n          }\n        }\n      } catch (error) {\n        // 用户取消删除操作\n        if (error === 'cancel') {\n          return\n        }\n        log('删除评论操作失败:', error)\n        this.$message.error('操作失败，请稍后重试')\n      }\n    },\n\n    handleContentChange(value) {\n      this.post.content = value;\n    }\n  }\n}\n</script>\n\n<style scoped>\n.post-detail-container {\n  padding: 20px;\n}\n\n.post-detail-card,\n.comments-card {\n  margin-bottom: 20px;\n}\n\n.loading-container {\n  padding: 20px 0;\n}\n\n.post-header {\n  margin-bottom: 20px;\n}\n\n.post-title {\n  font-size: 24px;\n  margin-bottom: 15px;\n  display: flex;\n  align-items: center;\n}\n\n.post-title .el-tag {\n  margin-right: 10px;\n}\n\n.post-meta {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.post-author {\n  display: flex;\n  align-items: center;\n}\n\n.author-info {\n  margin-left: 10px;\n}\n\n.author-name {\n  font-weight: bold;\n}\n\n.post-time,\n.comment-time,\n.reply-time {\n  font-size: 12px;\n  color: #909399;\n}\n\n.post-board {\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  color: #409EFF;\n}\n\n.post-board i {\n  margin-right: 5px;\n}\n\n.post-content {\n  margin-top: 20px;\n  line-height: 1.6;\n  word-break: break-word;\n}\n\n.post-content :deep(img) {\n  max-width: 100%;\n  height: auto;\n  margin: 10px 0;\n}\n\n.post-content :deep(p) {\n  margin: 10px 0;\n}\n\n.post-content :deep(table) {\n  border-collapse: collapse;\n  width: 100%;\n  margin: 10px 0;\n}\n\n.post-content :deep(th),\n.post-content :deep(td) {\n  border: 1px solid #ddd;\n  padding: 8px;\n}\n\n.post-content :deep(th) {\n  background-color: #f5f5f5;\n}\n\n.post-content :deep(blockquote) {\n  margin: 10px 0;\n  padding: 10px 20px;\n  border-left: 4px solid #ddd;\n  background-color: #f9f9f9;\n}\n\n.post-content :deep(pre) {\n  background-color: #f5f5f5;\n  padding: 10px;\n  border-radius: 4px;\n  overflow-x: auto;\n}\n\n.post-content :deep(code) {\n  font-family: Consolas, Monaco, 'Andale Mono', monospace;\n  background-color: #f5f5f5;\n  padding: 2px 4px;\n  border-radius: 3px;\n}\n\n.post-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-top: 15px;\n  border-top: 1px solid #EBEEF5;\n}\n\n.post-stats {\n  display: flex;\n  color: #909399;\n}\n\n.post-stats span {\n  margin-right: 15px;\n  display: flex;\n  align-items: center;\n}\n\n.post-stats span i {\n  margin-right: 5px;\n}\n\n.post-actions {\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  gap: 10px;\n}\n\n.post-actions .el-button {\n  margin-left: 0;\n}\n\n.comment-form {\n  margin-bottom: 20px;\n}\n\n.comment-form-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-top: 10px;\n}\n\n.login-tip {\n  margin-top: 10px;\n  color: #909399;\n  font-size: 14px;\n}\n\n.login-tip a {\n  color: #409EFF;\n  text-decoration: none;\n  font-weight: bold;\n}\n\n.login-tip a:hover {\n  text-decoration: underline;\n}\n\n.empty-comments {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 40px 0;\n  color: #909399;\n}\n\n.empty-comments i {\n  font-size: 48px;\n  margin-bottom: 10px;\n}\n\n.comments-list {\n  margin-bottom: 20px;\n}\n\n.comment-item {\n  padding: 15px 0;\n  border-bottom: 1px solid #EBEEF5;\n}\n\n.comment-item:last-child {\n  border-bottom: none;\n}\n\n.comment-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 10px;\n}\n\n.comment-user {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.comment-actions {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.comment-content {\n  line-height: 1.6;\n  margin-bottom: 10px;\n  white-space: pre-wrap;\n}\n\n.reply-form {\n  margin: 10px 0 10px 40px;\n}\n\n.reply-form-footer {\n  display: flex;\n  justify-content: flex-end;\n  margin-top: 10px;\n}\n\n.replies-list {\n  margin-left: 40px;\n  margin-top: 10px;\n  padding: 10px;\n  background-color: #F5F7FA;\n  border-radius: 4px;\n}\n\n.reply-item {\n  padding: 10px 0;\n  border-bottom: 1px solid #EBEEF5;\n}\n\n.reply-item:last-child {\n  border-bottom: none;\n}\n\n.reply-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n\n.reply-user {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.reply-actions {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.reply-content {\n  line-height: 1.6;\n  white-space: pre-wrap;\n}\n\n.pagination-container {\n  text-align: center;\n  margin-top: 20px;\n}\n\n/* 编辑相关样式 */\n.post-title-edit {\n  margin-bottom: 15px;\n}\n\n.post-content-edit {\n  margin-bottom: 20px;\n}\n\n.edit-actions {\n  display: flex;\n  justify-content: flex-end;\n  margin-top: 15px;\n  gap: 10px;\n}\n</style>\n\n<style>\n/* 收藏消息提示样式 */\n.favorite-message {\n  min-width: 120px;\n  padding: 10px 20px;\n  border-radius: 4px;\n}\n\n.favorite-message.el-message--success {\n  background-color: #f0f9eb;\n  border-color: #e1f3d8;\n}\n\n.favorite-message.el-message--warning {\n  background-color: #fdf6ec;\n  border-color: #faecd8;\n}\n\n.favorite-message .el-message__icon {\n  font-size: 16px;\n  margin-right: 8px;\n}\n\n.favorite-message .el-message__content {\n  font-size: 14px;\n  color: #606266;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}