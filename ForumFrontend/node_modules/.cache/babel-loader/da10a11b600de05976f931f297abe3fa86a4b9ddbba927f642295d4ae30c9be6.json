{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.index-of.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport { computed, onMounted, watch, ref } from 'vue';\nimport { useStore } from 'vuex';\nimport { useRouter, useRoute } from 'vue-router';\nimport NotificationBell from '@/components/NotificationBell.vue';\nimport ChatWindow from '@/components/ChatWindow.vue';\nimport wsManager from '@/utils/websocket';\nexport default {\n  name: 'App',\n  components: {\n    NotificationBell: NotificationBell,\n    ChatWindow: ChatWindow\n  },\n  setup: function setup() {\n    var store = useStore();\n    var router = useRouter();\n    var route = useRoute();\n\n    // 活跃聊天用户列表\n    var activeChatUsers = ref([]);\n\n    // 登录状态\n    var isLoggedIn = computed(function () {\n      return store.getters.isLoggedIn;\n    });\n    var isAdmin = computed(function () {\n      return store.getters.isAdmin;\n    });\n    var user = computed(function () {\n      return store.state.user;\n    });\n    var username = computed(function () {\n      return store.getters.username;\n    });\n    var userAvatar = computed(function () {\n      return store.getters.userAvatar;\n    });\n\n    // 当前激活的路由\n    var activeRoute = computed(function () {\n      return route.path;\n    });\n\n    // 路由导航\n    var goToLogin = function goToLogin() {\n      return router.push('/login');\n    };\n    var goToRegister = function goToRegister() {\n      return router.push('/register');\n    };\n\n    // 处理下拉菜单命令\n    var handleCommand = function handleCommand(command) {\n      switch (command) {\n        case 'profile':\n          router.push(\"/user/\".concat(user.value.id));\n          break;\n        case 'messages':\n          router.push('/messages');\n          break;\n        case 'admin':\n          router.push('/admin');\n          break;\n        case 'logout':\n          logout();\n          break;\n      }\n    };\n\n    // 登出\n    var logout = function logout() {\n      // 关闭所有WebSocket连接\n      wsManager.closeAll();\n\n      // 登出并重定向到首页\n      store.dispatch('logout');\n      router.push('/');\n    };\n\n    // 打开聊天窗口\n    var openChatWindow = function openChatWindow(userId) {\n      if (!activeChatUsers.value.includes(userId)) {\n        activeChatUsers.value.push(userId);\n      }\n    };\n\n    // 关闭聊天窗口\n    var closeChatWindow = function closeChatWindow(userId) {\n      var index = activeChatUsers.value.indexOf(userId);\n      if (index !== -1) {\n        activeChatUsers.value.splice(index, 1);\n      }\n    };\n\n    // 初始化WebSocket连接\n    var initWebSockets = function initWebSockets() {\n      if (isLoggedIn.value) {\n        wsManager.init(store.state.token);\n      }\n    };\n\n    // 监听登录状态变化\n    watch(isLoggedIn, function (newValue) {\n      if (newValue) {\n        // 用户登录后初始化WebSocket\n        initWebSockets();\n      } else {\n        // 用户登出后关闭WebSocket\n        wsManager.closeAll();\n      }\n    });\n    onMounted(function () {\n      // 页面加载时初始化WebSocket\n      initWebSockets();\n    });\n    return {\n      isLoggedIn: isLoggedIn,\n      isAdmin: isAdmin,\n      user: user,\n      username: username,\n      userAvatar: userAvatar,\n      activeRoute: activeRoute,\n      activeChatUsers: activeChatUsers,\n      goToLogin: goToLogin,\n      goToRegister: goToRegister,\n      handleCommand: handleCommand,\n      openChatWindow: openChatWindow,\n      closeChatWindow: closeChatWindow\n    };\n  }\n};","map":{"version":3,"names":["computed","onMounted","watch","ref","useStore","useRouter","useRoute","NotificationBell","ChatWindow","wsManager","name","components","setup","store","router","route","activeChatUsers","isLoggedIn","getters","isAdmin","user","state","username","userAvatar","activeRoute","path","goToLogin","push","goToRegister","handleCommand","command","concat","value","id","logout","closeAll","dispatch","openChatWindow","userId","includes","closeChatWindow","index","indexOf","splice","initWebSockets","init","token","newValue"],"sources":["H:\\ForumServers\\ForumFrontend\\src\\App.vue"],"sourcesContent":["<template>\n  <div id=\"app\">\n    <el-container>\n      <el-header>\n        <div class=\"header-content\">\n          <div class=\"logo\">\n            <router-link to=\"/\">论坛系统</router-link>\n          </div>\n          <div class=\"nav\">\n            <el-menu mode=\"horizontal\" :router=\"true\" :default-active=\"activeRoute\">\n              <el-menu-item index=\"/\">首页</el-menu-item>\n              <el-menu-item index=\"/boards\">板块</el-menu-item>\n              <el-menu-item index=\"/posts\">帖子</el-menu-item>\n              <el-menu-item index=\"/ranking\">排行榜</el-menu-item>\n              <el-menu-item index=\"/complaints\">投诉中心</el-menu-item>\n            </el-menu>\n          </div>\n          <div class=\"user-actions\">\n            <template v-if=\"isLoggedIn\">\n              <!-- 通知铃铛 -->\n              <NotificationBell />\n              \n              <!-- 用户头像和下拉菜单 -->\n              <el-dropdown trigger=\"click\" @command=\"handleCommand\">\n                <div class=\"user-avatar\">\n                  <el-avatar :size=\"32\" :src=\"userAvatar\">\n                    {{ username.substring(0, 1).toUpperCase() }}\n                  </el-avatar>\n                  <span class=\"username\">{{ user.nickname || user.username }}</span>\n                </div>\n                <template #dropdown>\n                  <el-dropdown-menu>\n                    <el-dropdown-item command=\"profile\">个人中心</el-dropdown-item>\n                    <el-dropdown-item command=\"messages\">我的私信</el-dropdown-item>\n                    <el-dropdown-item v-if=\"isAdmin\" command=\"admin\">管理后台</el-dropdown-item>\n                    <el-dropdown-item divided command=\"logout\">退出登录</el-dropdown-item>\n                  </el-dropdown-menu>\n                </template>\n              </el-dropdown>\n            </template>\n            <template v-else>\n              <el-button type=\"primary\" @click=\"goToLogin\">登录</el-button>\n              <el-button @click=\"goToRegister\">注册</el-button>\n            </template>\n          </div>\n        </div>\n      </el-header>\n      \n      <el-main>\n        <router-view />\n      </el-main>\n      \n      <el-footer>\n        <div class=\"footer-content\">\n          <p>© {{ new Date().getFullYear() }} 论坛系统 - 基于Vue + Django的现代化论坛</p>\n        </div>\n      </el-footer>\n    </el-container>\n    \n    <!-- 聊天窗口 -->\n    <div v-if=\"activeChatUsers.length > 0\" class=\"chat-windows-container\">\n      <ChatWindow \n        v-for=\"userId in activeChatUsers\"\n        :key=\"userId\"\n        :userId=\"userId\" \n        @close=\"closeChatWindow\" \n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { computed, onMounted, watch, ref } from 'vue'\nimport { useStore } from 'vuex'\nimport { useRouter, useRoute } from 'vue-router'\nimport NotificationBell from '@/components/NotificationBell.vue'\nimport ChatWindow from '@/components/ChatWindow.vue'\nimport wsManager from '@/utils/websocket'\n\nexport default {\n  name: 'App',\n  components: {\n    NotificationBell,\n    ChatWindow\n  },\n  setup() {\n    const store = useStore()\n    const router = useRouter()\n    const route = useRoute()\n    \n    // 活跃聊天用户列表\n    const activeChatUsers = ref([])\n    \n    // 登录状态\n    const isLoggedIn = computed(() => store.getters.isLoggedIn)\n    const isAdmin = computed(() => store.getters.isAdmin)\n    const user = computed(() => store.state.user)\n    const username = computed(() => store.getters.username)\n    const userAvatar = computed(() => store.getters.userAvatar)\n    \n    // 当前激活的路由\n    const activeRoute = computed(() => route.path)\n    \n    // 路由导航\n    const goToLogin = () => router.push('/login')\n    const goToRegister = () => router.push('/register')\n    \n    // 处理下拉菜单命令\n    const handleCommand = (command) => {\n      switch (command) {\n        case 'profile':\n          router.push(`/user/${user.value.id}`)\n          break\n        case 'messages':\n          router.push('/messages')\n          break\n        case 'admin':\n          router.push('/admin')\n          break\n        case 'logout':\n          logout()\n          break\n      }\n    }\n    \n    // 登出\n    const logout = () => {\n      // 关闭所有WebSocket连接\n      wsManager.closeAll()\n      \n      // 登出并重定向到首页\n      store.dispatch('logout')\n      router.push('/')\n    }\n    \n    // 打开聊天窗口\n    const openChatWindow = (userId) => {\n      if (!activeChatUsers.value.includes(userId)) {\n        activeChatUsers.value.push(userId)\n      }\n    }\n    \n    // 关闭聊天窗口\n    const closeChatWindow = (userId) => {\n      const index = activeChatUsers.value.indexOf(userId)\n      if (index !== -1) {\n        activeChatUsers.value.splice(index, 1)\n      }\n    }\n    \n    // 初始化WebSocket连接\n    const initWebSockets = () => {\n      if (isLoggedIn.value) {\n        wsManager.init(store.state.token)\n      }\n    }\n    \n    // 监听登录状态变化\n    watch(isLoggedIn, (newValue) => {\n      if (newValue) {\n        // 用户登录后初始化WebSocket\n        initWebSockets()\n      } else {\n        // 用户登出后关闭WebSocket\n        wsManager.closeAll()\n      }\n    })\n    \n    onMounted(() => {\n      // 页面加载时初始化WebSocket\n      initWebSockets()\n    })\n    \n    return {\n      isLoggedIn,\n      isAdmin,\n      user,\n      username,\n      userAvatar,\n      activeRoute,\n      activeChatUsers,\n      goToLogin,\n      goToRegister,\n      handleCommand,\n      openChatWindow,\n      closeChatWindow\n    }\n  }\n}\n</script>\n\n<style>\n#app {\n  font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  color: #2c3e50;\n  min-height: 100vh;\n}\n\n.el-container {\n  min-height: 100vh;\n}\n\n.el-header {\n  padding: 0;\n  background-color: #fff;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n  position: fixed;\n  width: 100%;\n  z-index: 1000;\n}\n\n.header-content {\n  max-width: 1400px;\n  margin: 0 auto;\n  height: 60px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 20px;\n}\n\n.logo {\n  font-size: 20px;\n  font-weight: bold;\n}\n\n.logo a {\n  color: #409EFF;\n  text-decoration: none;\n}\n\n.nav {\n  flex: 1;\n  margin: 0 20px;\n}\n\n.nav .el-menu {\n  border: none;\n  background: transparent;\n}\n\n.user-actions {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n\n.user-avatar {\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n}\n\n.username {\n  margin-left: 8px;\n  font-size: 14px;\n}\n\n.el-main {\n  padding-top: 80px;\n  max-width: 1400px;\n  margin: 0 auto;\n  min-height: calc(100vh - 120px);\n  padding: 0 20px;\n}\n\n.el-footer {\n  height: 60px !important;\n  background-color: #f5f7fa;\n}\n\n.footer-content {\n  max-width: 1400px;\n  margin: 0 auto;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #909399;\n}\n\n.chat-windows-container {\n  position: fixed;\n  bottom: 0;\n  right: 20px;\n  display: flex;\n  gap: 16px;\n  z-index: 1000;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}