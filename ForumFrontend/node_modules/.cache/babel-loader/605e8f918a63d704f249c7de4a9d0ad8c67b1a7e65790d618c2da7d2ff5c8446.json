{"ast":null,"code":"'use strict';\n\nvar _objectSpread = require(\"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/objectSpread2.js\")[\"default\"];\nrequire(\"core-js/modules/es.date.now.js\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar index = require('../../statistic/index.js');\nvar countdown = require('./countdown.js');\nvar utils = require('./utils.js');\nvar pluginVue_exportHelper = require('../../../_virtual/plugin-vue_export-helper.js');\nvar raf = require('../../../utils/raf.js');\nvar event = require('../../../constants/event.js');\nvar __default__ = vue.defineComponent({\n  name: \"ElCountdown\"\n});\nvar _sfc_main = /* @__PURE__ */vue.defineComponent(_objectSpread(_objectSpread({}, __default__), {}, {\n  props: countdown.countdownProps,\n  emits: countdown.countdownEmits,\n  setup: function setup(__props, _ref) {\n    var expose = _ref.expose,\n      emit = _ref.emit;\n    var props = __props;\n    var timer;\n    var rawValue = vue.ref(0);\n    var displayValue = vue.computed(function () {\n      return utils.formatTime(rawValue.value, props.format);\n    });\n    var formatter = function formatter(val) {\n      return utils.formatTime(val, props.format);\n    };\n    var stopTimer = function stopTimer() {\n      if (timer) {\n        raf.cAF(timer);\n        timer = void 0;\n      }\n    };\n    var startTimer = function startTimer() {\n      var timestamp = utils.getTime(props.value);\n      var _frameFunc = function frameFunc() {\n        var diff = timestamp - Date.now();\n        emit(event.CHANGE_EVENT, diff);\n        if (diff <= 0) {\n          diff = 0;\n          stopTimer();\n          emit(\"finish\");\n        } else {\n          timer = raf.rAF(_frameFunc);\n        }\n        rawValue.value = diff;\n      };\n      timer = raf.rAF(_frameFunc);\n    };\n    vue.onMounted(function () {\n      rawValue.value = utils.getTime(props.value) - Date.now();\n      vue.watch(function () {\n        return [props.value, props.format];\n      }, function () {\n        stopTimer();\n        startTimer();\n      }, {\n        immediate: true\n      });\n    });\n    vue.onBeforeUnmount(function () {\n      stopTimer();\n    });\n    expose({\n      displayValue: displayValue\n    });\n    return function (_ctx, _cache) {\n      return vue.openBlock(), vue.createBlock(vue.unref(index.ElStatistic), {\n        value: rawValue.value,\n        title: _ctx.title,\n        prefix: _ctx.prefix,\n        suffix: _ctx.suffix,\n        \"value-style\": _ctx.valueStyle,\n        formatter: formatter\n      }, vue.createSlots({\n        _: 2\n      }, [vue.renderList(_ctx.$slots, function (_, name) {\n        return {\n          name: name,\n          fn: vue.withCtx(function () {\n            return [vue.renderSlot(_ctx.$slots, name)];\n          })\n        };\n      })]), 1032, [\"value\", \"title\", \"prefix\", \"suffix\", \"value-style\"]);\n    };\n  }\n}));\nvar Countdown = /* @__PURE__ */pluginVue_exportHelper[\"default\"](_sfc_main, [[\"__file\", \"countdown.vue\"]]);\nexports[\"default\"] = Countdown;","map":{"version":3,"names":["name","timer","rawValue","vue","ref","displayValue","computed","utils","formatTime","value","props","format","formatter","val","stopTimer","raf","cAF","startTimer","timestamp","getTime","frameFunc","diff","Date","now","emit","event","CHANGE_EVENT","rAF","onMounted","watch","immediate","onBeforeUnmount","expose","_ctx","_cache","openBlock","createBlock","unref","index","ElStatistic","title","prefix","suffix","valueStyle"],"sources":["../../../../../../packages/components/countdown/src/countdown.vue"],"sourcesContent":["<template>\n  <el-statistic\n    :value=\"rawValue\"\n    :title=\"title\"\n    :prefix=\"prefix\"\n    :suffix=\"suffix\"\n    :value-style=\"valueStyle\"\n    :formatter=\"formatter\"\n  >\n    <template v-for=\"(_, name) in $slots\" #[name]>\n      <slot :name=\"name\" />\n    </template>\n  </el-statistic>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, onBeforeUnmount, onMounted, ref, watch } from 'vue'\nimport { ElStatistic } from '@element-plus/components/statistic'\nimport { cAF, rAF } from '@element-plus/utils'\nimport { CHANGE_EVENT } from '@element-plus/constants'\nimport { countdownEmits, countdownProps } from './countdown'\nimport { formatTime, getTime } from './utils'\n\ndefineOptions({\n  name: 'ElCountdown',\n})\n\nconst props = defineProps(countdownProps)\nconst emit = defineEmits(countdownEmits)\n\nlet timer: ReturnType<typeof rAF> | undefined\nconst rawValue = ref<number>(0)\nconst displayValue = computed(() => formatTime(rawValue.value, props.format))\n\nconst formatter = (val: number) => formatTime(val, props.format)\n\nconst stopTimer = () => {\n  if (timer) {\n    cAF(timer)\n    timer = undefined\n  }\n}\n\nconst startTimer = () => {\n  const timestamp = getTime(props.value)\n  const frameFunc = () => {\n    let diff = timestamp - Date.now()\n    emit(CHANGE_EVENT, diff)\n    if (diff <= 0) {\n      diff = 0\n      stopTimer()\n      emit('finish')\n    } else {\n      timer = rAF(frameFunc)\n    }\n    rawValue.value = diff\n  }\n  timer = rAF(frameFunc)\n}\n\nonMounted(() => {\n  rawValue.value = getTime(props.value) - Date.now()\n\n  watch(\n    () => [props.value, props.format],\n    () => {\n      stopTimer()\n      startTimer()\n    },\n    {\n      immediate: true,\n    }\n  )\n})\n\nonBeforeUnmount(() => {\n  stopTimer()\n})\n\ndefineExpose({\n  /**\n   * @description current display value\n   */\n  displayValue,\n})\n</script>\n"],"mappings":";;;;;;;;;;;;;;;qCAuBc;EACZA,IAAM;AACR;;;;;;;;IAKI,IAAAC,KAAA;IACE,IAAAC,QAAA,GAAWC,GAAA,CAAAC,GAAA,CAAY,CAAC;IACxB,IAAAC,YAAA,GAAeF,GAAA,CAAAG,QAAA,CAAS;MAAA,OAAMC,KAAA,CAAAC,UAAA,CAAWN,QAAA,CAASO,KAAO,EAAAC,KAAA,CAAMC,MAAM,CAAC;IAAA;IAE5E,IAAMC,SAAA,GAAY,SAAZA,UAAaC,GAAA;MAAA,OAAgBN,KAAA,CAAAC,UAAW,CAAAK,GAAA,EAAKH,KAAA,CAAMC,MAAM;IAAA;IAE/D,IAAMG,SAAA,GAAY,SAAZA,UAAA,EAAkB;MACtB,IAAIb,KAAO;QACTc,GAAA,CAAAC,GAAA,CAAIf,KAAK;QACDA,KAAA;MAAA;IACV,CACF;IAEA,IAAMgB,UAAA,GAAa,SAAbA,WAAA,EAAmB;MACjB,IAAAC,SAAA,GAAYX,KAAA,CAAAY,OAAQ,CAAAT,KAAA,CAAMD,KAAK;MACrC,IAAMW,UAAA,GAAY,SAAZA,UAAA,EAAkB;QAClB,IAAAC,IAAA,GAAOH,SAAY,GAAAI,IAAA,CAAKC,GAAI;QAChCC,IAAA,CAAKC,KAAA,CAAAC,YAAA,EAAcL,IAAI;QACvB,IAAIA,IAAA,IAAQ,CAAG;UACNA,IAAA;UACGP,SAAA;UACVU,IAAA,CAAK,QAAQ;QAAA,CACR;UACLvB,KAAA,GAAQc,GAAA,CAAAY,GAAA,CAAIP,UAAS;QAAA;QAEvBlB,QAAA,CAASO,KAAQ,GAAAY,IAAA;MAAA,CACnB;MACApB,KAAA,GAAQc,GAAA,CAAAY,GAAA,CAAIP,UAAS;IAAA,CACvB;IAEAjB,GAAA,CAAAyB,SAAA,CAAU,YAAM;MACd1B,QAAA,CAASO,KAAA,GAAQF,KAAA,CAAAY,OAAQ,CAAAT,KAAA,CAAMD,KAAK,IAAIa,IAAA,CAAKC,GAAI;MAEjDpB,GAAA,CAAA0B,KAAA;QAAA,QAAAnB,KAAA,CAAAD,KAAA,EAAAC,KAAA,CAAAC,MAAA;MAAA;QACEG,SAAa;QACbG,UAAM;MACJ,CAAU;QACCa,SAAA;MAAA,CACb;IAAA,CACA;IAAA3B,GAAA,CAAA4B,eACa;MACbjB,SAAA;IAAA,CACF;IACFkB,MAAC;MAED3B,YAAA,EAAAA;IACE,CAAU;IACZ,OAAC,UAAA4B,IAAA,EAAAC,MAAA;MAEY,OAAA/B,GAAA,CAAAgC,SAAA,IAAAhC,GAAA,CAAAiC,WAAA,CAAAjC,GAAA,CAAAkC,KAAA,CAAAC,KAAA,CAAAC,WAAA;QAAA9B,KAAA,EAAAP,QAAA,CAAAO,KAAA;QAAA+B,KAAA,EAAAP,IAAA,CAAAO,KAAA;QAAAC,MAAA,EAAAR,IAAA,CAAAQ,MAAA;QAIXC,MAAA,EAAAT,IAAA,CAAAS,MAAA;QACD,eAAAT,IAAA,CAAAU,UAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}