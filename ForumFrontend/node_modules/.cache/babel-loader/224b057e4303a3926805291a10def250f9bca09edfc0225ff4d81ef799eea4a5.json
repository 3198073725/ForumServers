{"ast":null,"code":"'use strict';\n\nvar _defineProperty = require(\"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/defineProperty.js\")[\"default\"];\nrequire(\"core-js/modules/es.array.find-index.js\");\nrequire(\"core-js/modules/es.array.push.js\");\nrequire(\"core-js/modules/es.array.some.js\");\nrequire(\"core-js/modules/es.array.splice.js\");\nrequire(\"core-js/modules/es.iterator.constructor.js\");\nrequire(\"core-js/modules/es.iterator.some.js\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar useProps = require('./useProps.js');\nfunction useAllowCreate(props, states) {\n  var _useProps$useProps = useProps.useProps(props),\n    aliasProps = _useProps$useProps.aliasProps,\n    getLabel = _useProps$useProps.getLabel,\n    getValue = _useProps$useProps.getValue;\n  var createOptionCount = vue.ref(0);\n  var cachedSelectedOption = vue.ref();\n  var enableAllowCreateMode = vue.computed(function () {\n    return props.allowCreate && props.filterable;\n  });\n  function hasExistingOption(query) {\n    var hasOption = function hasOption(option) {\n      return getLabel(option) === query;\n    };\n    return props.options && props.options.some(hasOption) || states.createdOptions.some(hasOption);\n  }\n  function selectNewOption(option) {\n    if (!enableAllowCreateMode.value) {\n      return;\n    }\n    if (props.multiple && option.created) {\n      createOptionCount.value++;\n    } else {\n      cachedSelectedOption.value = option;\n    }\n  }\n  function createNewOption(query) {\n    if (enableAllowCreateMode.value) {\n      if (query && query.length > 0) {\n        if (hasExistingOption(query)) {\n          return;\n        }\n        var newOption = _defineProperty(_defineProperty(_defineProperty(_defineProperty({}, aliasProps.value.value, query), aliasProps.value.label, query), \"created\", true), aliasProps.value.disabled, false);\n        if (states.createdOptions.length >= createOptionCount.value) {\n          states.createdOptions[createOptionCount.value] = newOption;\n        } else {\n          states.createdOptions.push(newOption);\n        }\n      } else {\n        if (props.multiple) {\n          states.createdOptions.length = createOptionCount.value;\n        } else {\n          var selectedOption = cachedSelectedOption.value;\n          states.createdOptions.length = 0;\n          if (selectedOption && selectedOption.created) {\n            states.createdOptions.push(selectedOption);\n          }\n        }\n      }\n    }\n  }\n  function removeNewOption(option) {\n    if (!enableAllowCreateMode.value || !option || !option.created || option.created && props.reserveKeyword && states.inputValue === getLabel(option)) {\n      return;\n    }\n    var idx = states.createdOptions.findIndex(function (it) {\n      return getValue(it) === getValue(option);\n    });\n    if (~idx) {\n      states.createdOptions.splice(idx, 1);\n      createOptionCount.value--;\n    }\n  }\n  function clearAllNewOption() {\n    if (enableAllowCreateMode.value) {\n      states.createdOptions.length = 0;\n      createOptionCount.value = 0;\n    }\n  }\n  return {\n    createNewOption: createNewOption,\n    removeNewOption: removeNewOption,\n    selectNewOption: selectNewOption,\n    clearAllNewOption: clearAllNewOption\n  };\n}\nexports.useAllowCreate = useAllowCreate;","map":{"version":3,"names":["useAllowCreate","props","states","_useProps$useProps","useProps","aliasProps","getLabel","getValue","createOptionCount","vue","ref","cachedSelectedOption","enableAllowCreateMode","computed","allowCreate","filterable","hasExistingOption","query","hasOption","option","options","some","createdOptions","selectNewOption","value","multiple","created","createNewOption","length","newOption","_defineProperty","label","disabled","push","selectedOption","removeNewOption","reserveKeyword","inputValue","idx","findIndex","it","splice","clearAllNewOption"],"sources":["../../../../../../packages/components/select-v2/src/useAllowCreate.ts"],"sourcesContent":["import { computed, ref } from 'vue'\nimport { useProps } from './useProps'\nimport type { ISelectV2Props } from './token'\nimport type { Option, SelectStates } from './select.types'\n\nexport function useAllowCreate(props: ISelectV2Props, states: SelectStates) {\n  const { aliasProps, getLabel, getValue } = useProps(props)\n\n  const createOptionCount = ref(0)\n  const cachedSelectedOption = ref<Option>()\n\n  const enableAllowCreateMode = computed(() => {\n    return props.allowCreate && props.filterable\n  })\n\n  function hasExistingOption(query: string) {\n    const hasOption = (option: Option) => getLabel(option) === query\n    return (\n      (props.options && props.options.some(hasOption)) ||\n      states.createdOptions.some(hasOption)\n    )\n  }\n\n  function selectNewOption(option: Option) {\n    if (!enableAllowCreateMode.value) {\n      return\n    }\n    if (props.multiple && option.created) {\n      createOptionCount.value++\n    } else {\n      cachedSelectedOption.value = option\n    }\n  }\n\n  function createNewOption(query: string) {\n    if (enableAllowCreateMode.value) {\n      if (query && query.length > 0) {\n        if (hasExistingOption(query)) {\n          return\n        }\n        const newOption = {\n          [aliasProps.value.value]: query,\n          [aliasProps.value.label]: query,\n          created: true,\n          [aliasProps.value.disabled]: false,\n        }\n        if (states.createdOptions.length >= createOptionCount.value) {\n          states.createdOptions[createOptionCount.value] = newOption\n        } else {\n          states.createdOptions.push(newOption)\n        }\n      } else {\n        if (props.multiple) {\n          states.createdOptions.length = createOptionCount.value\n        } else {\n          const selectedOption = cachedSelectedOption.value\n          states.createdOptions.length = 0\n          if (selectedOption && selectedOption.created) {\n            states.createdOptions.push(selectedOption)\n          }\n        }\n      }\n    }\n  }\n\n  function removeNewOption(option: Option) {\n    if (\n      !enableAllowCreateMode.value ||\n      !option ||\n      !option.created ||\n      (option.created &&\n        props.reserveKeyword &&\n        states.inputValue === getLabel(option))\n    ) {\n      return\n    }\n    const idx = states.createdOptions.findIndex(\n      (it) => getValue(it) === getValue(option)\n    )\n    if (~idx) {\n      states.createdOptions.splice(idx, 1)\n      createOptionCount.value--\n    }\n  }\n\n  function clearAllNewOption() {\n    if (enableAllowCreateMode.value) {\n      states.createdOptions.length = 0\n      createOptionCount.value = 0\n    }\n  }\n\n  return {\n    createNewOption,\n    removeNewOption,\n    selectNewOption,\n    clearAllNewOption,\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;AAEO,SAASA,cAAcA,CAACC,KAAK,EAAEC,MAAM,EAAE;EAC5C,IAAAC,kBAAA,GAA2CC,QAAA,CAAAA,QAAQ,CAACH,KAAK,CAAC;IAAlDI,UAAU,GAAAF,kBAAA,CAAVE,UAAU;IAAEC,QAAQ,GAAAH,kBAAA,CAARG,QAAQ;IAAEC,QAAQ,GAAAJ,kBAAA,CAARI,QAAQ;EACtC,IAAMC,iBAAiB,GAAGC,GAAA,CAAAC,GAAG,CAAC,CAAC,CAAC;EAChC,IAAMC,oBAAoB,GAAGF,GAAA,CAAAC,GAAG,EAAE;EAClC,IAAME,qBAAqB,GAAGH,GAAA,CAAAI,QAAQ,CAAC,YAAM;IAC3C,OAAOZ,KAAK,CAACa,WAAW,IAAIb,KAAK,CAACc,UAAU;EAChD,CAAG,CAAC;EACF,SAASC,iBAAiBA,CAACC,KAAK,EAAE;IAChC,IAAMC,SAAS,GAAG,SAAZA,SAASA,CAAIC,MAAM;MAAA,OAAKb,QAAQ,CAACa,MAAM,CAAC,KAAKF,KAAK;IAAA;IACxD,OAAOhB,KAAK,CAACmB,OAAO,IAAInB,KAAK,CAACmB,OAAO,CAACC,IAAI,CAACH,SAAS,CAAC,IAAIhB,MAAM,CAACoB,cAAc,CAACD,IAAI,CAACH,SAAS,CAAC;EAClG;EACE,SAASK,eAAeA,CAACJ,MAAM,EAAE;IAC/B,IAAI,CAACP,qBAAqB,CAACY,KAAK,EAAE;MAChC;IACN;IACI,IAAIvB,KAAK,CAACwB,QAAQ,IAAIN,MAAM,CAACO,OAAO,EAAE;MACpClB,iBAAiB,CAACgB,KAAK,EAAE;IAC/B,CAAK,MAAM;MACLb,oBAAoB,CAACa,KAAK,GAAGL,MAAM;IACzC;EACA;EACE,SAASQ,eAAeA,CAACV,KAAK,EAAE;IAC9B,IAAIL,qBAAqB,CAACY,KAAK,EAAE;MAC/B,IAAIP,KAAK,IAAIA,KAAK,CAACW,MAAM,GAAG,CAAC,EAAE;QAC7B,IAAIZ,iBAAiB,CAACC,KAAK,CAAC,EAAE;UAC5B;QACV;QACQ,IAAMY,SAAS,GAAAC,eAAA,CAAAA,eAAA,CAAAA,eAAA,CAAAA,eAAA,KACZzB,UAAU,CAACmB,KAAK,CAACA,KAAK,EAAGP,KAAK,GAC9BZ,UAAU,CAACmB,KAAK,CAACO,KAAK,EAAGd,KAAK,cACtB,IAAI,GACZZ,UAAU,CAACmB,KAAK,CAACQ,QAAQ,EAAG,KAAK,CACnC;QACD,IAAI9B,MAAM,CAACoB,cAAc,CAACM,MAAM,IAAIpB,iBAAiB,CAACgB,KAAK,EAAE;UAC3DtB,MAAM,CAACoB,cAAc,CAACd,iBAAiB,CAACgB,KAAK,CAAC,GAAGK,SAAS;QACpE,CAAS,MAAM;UACL3B,MAAM,CAACoB,cAAc,CAACW,IAAI,CAACJ,SAAS,CAAC;QAC/C;MACA,CAAO,MAAM;QACL,IAAI5B,KAAK,CAACwB,QAAQ,EAAE;UAClBvB,MAAM,CAACoB,cAAc,CAACM,MAAM,GAAGpB,iBAAiB,CAACgB,KAAK;QAChE,CAAS,MAAM;UACL,IAAMU,cAAc,GAAGvB,oBAAoB,CAACa,KAAK;UACjDtB,MAAM,CAACoB,cAAc,CAACM,MAAM,GAAG,CAAC;UAChC,IAAIM,cAAc,IAAIA,cAAc,CAACR,OAAO,EAAE;YAC5CxB,MAAM,CAACoB,cAAc,CAACW,IAAI,CAACC,cAAc,CAAC;UACtD;QACA;MACA;IACA;EACA;EACE,SAASC,eAAeA,CAAChB,MAAM,EAAE;IAC/B,IAAI,CAACP,qBAAqB,CAACY,KAAK,IAAI,CAACL,MAAM,IAAI,CAACA,MAAM,CAACO,OAAO,IAAIP,MAAM,CAACO,OAAO,IAAIzB,KAAK,CAACmC,cAAc,IAAIlC,MAAM,CAACmC,UAAU,KAAK/B,QAAQ,CAACa,MAAM,CAAC,EAAE;MAClJ;IACN;IACI,IAAMmB,GAAG,GAAGpC,MAAM,CAACoB,cAAc,CAACiB,SAAS,CAAC,UAACC,EAAE;MAAA,OAAKjC,QAAQ,CAACiC,EAAE,CAAC,KAAKjC,QAAQ,CAACY,MAAM,CAAC;IAAA,EAAC;IACtF,IAAI,CAACmB,GAAG,EAAE;MACRpC,MAAM,CAACoB,cAAc,CAACmB,MAAM,CAACH,GAAG,EAAE,CAAC,CAAC;MACpC9B,iBAAiB,CAACgB,KAAK,EAAE;IAC/B;EACA;EACE,SAASkB,iBAAiBA,CAAA,EAAG;IAC3B,IAAI9B,qBAAqB,CAACY,KAAK,EAAE;MAC/BtB,MAAM,CAACoB,cAAc,CAACM,MAAM,GAAG,CAAC;MAChCpB,iBAAiB,CAACgB,KAAK,GAAG,CAAC;IACjC;EACA;EACE,OAAO;IACLG,eAAe,EAAfA,eAAe;IACfQ,eAAe,EAAfA,eAAe;IACfZ,eAAe,EAAfA,eAAe;IACfmB,iBAAiB,EAAjBA;EACJ,CAAG;AACH","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}