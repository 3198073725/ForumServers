{"ast":null,"code":"'use strict';\n\nrequire(\"core-js/modules/es.array.index-of.js\");\nrequire(\"core-js/modules/es.array.push.js\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar aria = require('../../utils/dom/aria.js');\nvar aria$1 = require('../../constants/aria.js');\nvar FOCUSABLE_CHILDREN = \"_trap-focus-children\";\nvar TRAP_FOCUS_HANDLER = \"_trap-focus-handler\";\nvar FOCUS_STACK = [];\nvar FOCUS_HANDLER = function FOCUS_HANDLER(e) {\n  var _a;\n  if (FOCUS_STACK.length === 0) return;\n  var focusableElement = FOCUS_STACK[FOCUS_STACK.length - 1][FOCUSABLE_CHILDREN];\n  if (focusableElement.length > 0 && e.code === aria$1.EVENT_CODE.tab) {\n    if (focusableElement.length === 1) {\n      e.preventDefault();\n      if (document.activeElement !== focusableElement[0]) {\n        focusableElement[0].focus();\n      }\n      return;\n    }\n    var goingBackward = e.shiftKey;\n    var isFirst = e.target === focusableElement[0];\n    var isLast = e.target === focusableElement[focusableElement.length - 1];\n    if (isFirst && goingBackward) {\n      e.preventDefault();\n      focusableElement[focusableElement.length - 1].focus();\n    }\n    if (isLast && !goingBackward) {\n      e.preventDefault();\n      focusableElement[0].focus();\n    }\n    if (process.env.NODE_ENV === \"test\") {\n      var index = focusableElement.indexOf(e.target);\n      if (index !== -1) {\n        (_a = focusableElement[goingBackward ? index - 1 : index + 1]) == null ? void 0 : _a.focus();\n      }\n    }\n  }\n};\nvar TrapFocus = {\n  beforeMount: function beforeMount(el) {\n    el[FOCUSABLE_CHILDREN] = aria.obtainAllFocusableElements(el);\n    FOCUS_STACK.push(el);\n    if (FOCUS_STACK.length <= 1) {\n      document.addEventListener(\"keydown\", FOCUS_HANDLER);\n    }\n  },\n  updated: function updated(el) {\n    vue.nextTick(function () {\n      el[FOCUSABLE_CHILDREN] = aria.obtainAllFocusableElements(el);\n    });\n  },\n  unmounted: function unmounted() {\n    FOCUS_STACK.shift();\n    if (FOCUS_STACK.length === 0) {\n      document.removeEventListener(\"keydown\", FOCUS_HANDLER);\n    }\n  }\n};\nexports.FOCUSABLE_CHILDREN = FOCUSABLE_CHILDREN;\nexports.TRAP_FOCUS_HANDLER = TRAP_FOCUS_HANDLER;\nexports[\"default\"] = TrapFocus;","map":{"version":3,"names":["FOCUSABLE_CHILDREN","TRAP_FOCUS_HANDLER","FOCUS_STACK","FOCUS_HANDLER","e","_a","length","focusableElement","code","aria$1","EVENT_CODE","tab","preventDefault","document","activeElement","focus","goingBackward","shiftKey","isFirst","target","isLast","process","env","NODE_ENV","index","indexOf","TrapFocus","beforeMount","el","aria","obtainAllFocusableElements","push","addEventListener","updated","vue","nextTick","unmounted","shift","removeEventListener"],"sources":["../../../../../packages/directives/trap-focus/index.ts"],"sourcesContent":["import { nextTick } from 'vue'\nimport { obtainAllFocusableElements } from '@element-plus/utils'\nimport { EVENT_CODE } from '@element-plus/constants'\nimport type { ObjectDirective } from 'vue'\n\nexport const FOCUSABLE_CHILDREN = '_trap-focus-children'\nexport const TRAP_FOCUS_HANDLER = '_trap-focus-handler'\n\nexport interface TrapFocusElement extends HTMLElement {\n  [FOCUSABLE_CHILDREN]: HTMLElement[]\n  [TRAP_FOCUS_HANDLER]: (e: KeyboardEvent) => void\n}\n\nconst FOCUS_STACK: TrapFocusElement[] = []\n\nconst FOCUS_HANDLER = (e: KeyboardEvent) => {\n  // Getting the top layer.\n  if (FOCUS_STACK.length === 0) return\n  const focusableElement =\n    FOCUS_STACK[FOCUS_STACK.length - 1][FOCUSABLE_CHILDREN]\n  if (focusableElement.length > 0 && e.code === EVENT_CODE.tab) {\n    if (focusableElement.length === 1) {\n      e.preventDefault()\n      if (document.activeElement !== focusableElement[0]) {\n        focusableElement[0].focus()\n      }\n      return\n    }\n    const goingBackward = e.shiftKey\n    const isFirst = e.target === focusableElement[0]\n    const isLast = e.target === focusableElement[focusableElement.length - 1]\n    if (isFirst && goingBackward) {\n      e.preventDefault()\n      focusableElement[focusableElement.length - 1].focus()\n    }\n    if (isLast && !goingBackward) {\n      e.preventDefault()\n      focusableElement[0].focus()\n    }\n\n    // the is critical since jsdom did not implement user actions, you can only mock it\n    // DELETE ME: when testing env switches to puppeteer\n    if (process.env.NODE_ENV === 'test') {\n      const index = focusableElement.indexOf(e.target as HTMLElement)\n      if (index !== -1) {\n        focusableElement[goingBackward ? index - 1 : index + 1]?.focus()\n      }\n    }\n  }\n}\n\nconst TrapFocus: ObjectDirective = {\n  beforeMount(el: TrapFocusElement) {\n    el[FOCUSABLE_CHILDREN] = obtainAllFocusableElements(el)\n    FOCUS_STACK.push(el)\n    if (FOCUS_STACK.length <= 1) {\n      document.addEventListener('keydown', FOCUS_HANDLER)\n    }\n  },\n  updated(el: TrapFocusElement) {\n    nextTick(() => {\n      el[FOCUSABLE_CHILDREN] = obtainAllFocusableElements(el)\n    })\n  },\n  unmounted() {\n    FOCUS_STACK.shift()\n    if (FOCUS_STACK.length === 0) {\n      document.removeEventListener('keydown', FOCUS_HANDLER)\n    }\n  },\n}\n\nexport default TrapFocus\n"],"mappings":";;;;;;;;;;;AAGY,IAACA,kBAAkB,GAAG;AACtB,IAACC,kBAAkB,GAAG;AAClC,IAAMC,WAAW,GAAG,EAAE;AACtB,IAAMC,aAAa,GAAG,SAAhBA,aAAaA,CAAIC,CAAC,EAAK;EAC3B,IAAIC,EAAE;EACN,IAAIH,WAAW,CAACI,MAAM,KAAK,CAAC,EAC1B;EACF,IAAMC,gBAAgB,GAAGL,WAAW,CAACA,WAAW,CAACI,MAAM,GAAG,CAAC,CAAC,CAACN,kBAAkB,CAAC;EAChF,IAAIO,gBAAgB,CAACD,MAAM,GAAG,CAAC,IAAIF,CAAC,CAACI,IAAI,KAAKC,MAAA,CAAAC,UAAU,CAACC,GAAG,EAAE;IAC5D,IAAIJ,gBAAgB,CAACD,MAAM,KAAK,CAAC,EAAE;MACjCF,CAAC,CAACQ,cAAc,EAAE;MAClB,IAAIC,QAAQ,CAACC,aAAa,KAAKP,gBAAgB,CAAC,CAAC,CAAC,EAAE;QAClDA,gBAAgB,CAAC,CAAC,CAAC,CAACQ,KAAK,EAAE;MACnC;MACM;IACN;IACI,IAAMC,aAAa,GAAGZ,CAAC,CAACa,QAAQ;IAChC,IAAMC,OAAO,GAAGd,CAAC,CAACe,MAAM,KAAKZ,gBAAgB,CAAC,CAAC,CAAC;IAChD,IAAMa,MAAM,GAAGhB,CAAC,CAACe,MAAM,KAAKZ,gBAAgB,CAACA,gBAAgB,CAACD,MAAM,GAAG,CAAC,CAAC;IACzE,IAAIY,OAAO,IAAIF,aAAa,EAAE;MAC5BZ,CAAC,CAACQ,cAAc,EAAE;MAClBL,gBAAgB,CAACA,gBAAgB,CAACD,MAAM,GAAG,CAAC,CAAC,CAACS,KAAK,EAAE;IAC3D;IACI,IAAIK,MAAM,IAAI,CAACJ,aAAa,EAAE;MAC5BZ,CAAC,CAACQ,cAAc,EAAE;MAClBL,gBAAgB,CAAC,CAAC,CAAC,CAACQ,KAAK,EAAE;IACjC;IACI,IAAIM,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,MAAM,EAAE;MACnC,IAAMC,KAAK,GAAGjB,gBAAgB,CAACkB,OAAO,CAACrB,CAAC,CAACe,MAAM,CAAC;MAChD,IAAIK,KAAK,KAAK,CAAC,CAAC,EAAE;QAChB,CAACnB,EAAE,GAAGE,gBAAgB,CAACS,aAAa,GAAGQ,KAAK,GAAG,CAAC,GAAGA,KAAK,GAAG,CAAC,CAAC,KAAK,IAAI,GAAG,KAAK,CAAC,GAAGnB,EAAE,CAACU,KAAK,EAAE;MACpG;IACA;EACA;AACA,CAAC;AACI,IAACW,SAAS,GAAG;EAChBC,WAAW,WAAXA,WAAWA,CAACC,EAAE,EAAE;IACdA,EAAE,CAAC5B,kBAAkB,CAAC,GAAG6B,IAAA,CAAAC,0BAA0B,CAACF,EAAE,CAAC;IACvD1B,WAAW,CAAC6B,IAAI,CAACH,EAAE,CAAC;IACpB,IAAI1B,WAAW,CAACI,MAAM,IAAI,CAAC,EAAE;MAC3BO,QAAQ,CAACmB,gBAAgB,CAAC,SAAS,EAAE7B,aAAa,CAAC;IACzD;EACA,CAAG;EACD8B,OAAO,WAAPA,OAAOA,CAACL,EAAE,EAAE;IACVM,GAAA,CAAAC,QAAQ,CAAC,YAAM;MACbP,EAAE,CAAC5B,kBAAkB,CAAC,GAAG6B,IAAA,CAAAC,0BAA0B,CAACF,EAAE,CAAC;IAC7D,CAAK,CAAC;EACN,CAAG;EACDQ,SAAS,WAATA,SAASA,CAAA,EAAG;IACVlC,WAAW,CAACmC,KAAK,EAAE;IACnB,IAAInC,WAAW,CAACI,MAAM,KAAK,CAAC,EAAE;MAC5BO,QAAQ,CAACyB,mBAAmB,CAAC,SAAS,EAAEnC,aAAa,CAAC;IAC5D;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}