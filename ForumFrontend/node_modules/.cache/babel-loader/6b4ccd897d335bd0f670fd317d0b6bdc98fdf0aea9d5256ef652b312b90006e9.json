{"ast":null,"code":"import _regeneratorRuntime from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.date.to-json.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport { createStore } from 'vuex';\nimport axios from '@/utils/request';\nimport notificationsModule from './modules/notifications';\nimport usersModule from './modules/users';\nexport default createStore({\n  state: {\n    token: localStorage.getItem('token') || '',\n    user: JSON.parse(localStorage.getItem('userInfo') || '{}')\n  },\n  getters: {\n    isLoggedIn: function isLoggedIn(state) {\n      return !!state.token;\n    },\n    isAdmin: function isAdmin(state) {\n      return state.user && state.user.role === 'admin';\n    },\n    isModerator: function isModerator(state) {\n      return state.user && (state.user.role === 'moderator' || state.user.role === 'admin');\n    },\n    userId: function userId(state) {\n      return state.user ? state.user.id : null;\n    },\n    username: function username(state) {\n      return state.user ? state.user.username : '';\n    },\n    userAvatar: function userAvatar(state) {\n      return state.user && state.user.avatar_url ? state.user.avatar_url : '';\n    },\n    userRole: function userRole(state) {\n      return state.user ? state.user.role : '';\n    },\n    currentUser: function currentUser(state) {\n      return state.user;\n    }\n  },\n  mutations: {\n    // 用户认证相关\n    setToken: function setToken(state, token) {\n      state.token = token;\n      localStorage.setItem('token', token);\n    },\n    setUser: function setUser(state, user) {\n      state.user = user;\n      localStorage.setItem('userInfo', JSON.stringify(user));\n    },\n    logout: function logout(state) {\n      state.token = '';\n      state.user = {};\n      localStorage.removeItem('token');\n      localStorage.removeItem('userInfo');\n    }\n  },\n  actions: {\n    // 用户认证相关\n    login: function login(_ref, _ref2) {\n      var commit = _ref.commit;\n      var token = _ref2.token,\n        userInfo = _ref2.userInfo;\n      console.log('登录动作被调用，token:', token, '用户信息:', userInfo);\n      commit('setToken', token);\n      commit('setUser', userInfo);\n      return userInfo;\n    },\n    getUserInfo: function getUserInfo(_ref3) {\n      return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var commit, state, response;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              commit = _ref3.commit, state = _ref3.state;\n              _context.prev = 1;\n              if (state.token) {\n                _context.next = 4;\n                break;\n              }\n              return _context.abrupt(\"return\", null);\n            case 4:\n              _context.next = 6;\n              return axios.get('/api/v1/users/me/');\n            case 6:\n              response = _context.sent;\n              if (!(response && response.data)) {\n                _context.next = 10;\n                break;\n              }\n              commit('setUser', response.data);\n              return _context.abrupt(\"return\", response.data);\n            case 10:\n              return _context.abrupt(\"return\", null);\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context[\"catch\"](1);\n              console.error('获取用户信息失败:', _context.t0);\n              return _context.abrupt(\"return\", null);\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[1, 13]]);\n      }))();\n    },\n    logout: function logout(_ref4) {\n      var commit = _ref4.commit;\n      commit('logout');\n    }\n  },\n  modules: {\n    notifications: notificationsModule,\n    users: usersModule\n  }\n});","map":{"version":3,"names":["createStore","axios","notificationsModule","usersModule","state","token","localStorage","getItem","user","JSON","parse","getters","isLoggedIn","isAdmin","role","isModerator","userId","id","username","userAvatar","avatar_url","userRole","currentUser","mutations","setToken","setItem","setUser","stringify","logout","removeItem","actions","login","_ref","_ref2","commit","userInfo","console","log","getUserInfo","_ref3","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","wrap","_callee$","_context","prev","next","abrupt","get","sent","data","t0","error","stop","_ref4","modules","notifications","users"],"sources":["H:/ForumServers/ForumFrontend/src/store/index.js"],"sourcesContent":["import { createStore } from 'vuex'\nimport axios from '@/utils/request'\nimport notificationsModule from './modules/notifications'\n\nimport usersModule from './modules/users'\n\nexport default createStore({\n  state: {\n    token: localStorage.getItem('token') || '',\n    user: JSON.parse(localStorage.getItem('userInfo') || '{}')\n  },\n  getters: {\n    isLoggedIn: state => !!state.token,\n    isAdmin: state => state.user && state.user.role === 'admin',\n    isModerator: state => state.user && (state.user.role === 'moderator' || state.user.role === 'admin'),\n    userId: state => state.user ? state.user.id : null,\n    username: state => state.user ? state.user.username : '',\n    userAvatar: state => state.user && state.user.avatar_url ? state.user.avatar_url : '',\n    userRole: state => state.user ? state.user.role : '',\n    currentUser: state => state.user\n  },\n  mutations: {\n    // 用户认证相关\n    setToken(state, token) {\n      state.token = token;\n      localStorage.setItem('token', token);\n    },\n    setUser(state, user) {\n      state.user = user;\n      localStorage.setItem('userInfo', JSON.stringify(user));\n    },\n    logout(state) {\n      state.token = '';\n      state.user = {};\n      localStorage.removeItem('token');\n      localStorage.removeItem('userInfo');\n    }\n  },\n  actions: {\n    // 用户认证相关\n    login({ commit }, { token, userInfo }) {\n      console.log('登录动作被调用，token:', token, '用户信息:', userInfo);\n      commit('setToken', token);\n      commit('setUser', userInfo);\n      return userInfo;\n    },\n    async getUserInfo({ commit, state }) {\n      try {\n        if (!state.token) return null;\n        const response = await axios.get('/api/v1/users/me/');\n        if (response && response.data) {\n          commit('setUser', response.data);\n          return response.data;\n        }\n        return null;\n      } catch (error) {\n        console.error('获取用户信息失败:', error);\n        return null;\n      }\n    },\n    logout({ commit }) {\n      commit('logout');\n    }\n  },\n  modules: {\n    notifications: notificationsModule,\n    users: usersModule\n  }\n})\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}