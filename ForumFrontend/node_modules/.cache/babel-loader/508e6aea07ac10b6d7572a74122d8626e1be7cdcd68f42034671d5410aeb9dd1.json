{"ast":null,"code":"'use strict';\n\nvar _slicedToArray = require(\"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/slicedToArray.js\")[\"default\"];\nrequire(\"core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar core = require('@vueuse/core');\nvar index = require('../use-prop/index.js');\nvar types = require('../../utils/types.js');\nvar shared = require('@vue/shared');\nfunction useFocusController(target) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n    beforeFocus = _ref.beforeFocus,\n    afterFocus = _ref.afterFocus,\n    beforeBlur = _ref.beforeBlur,\n    afterBlur = _ref.afterBlur;\n  var instance = vue.getCurrentInstance();\n  var emit = instance.emit;\n  var wrapperRef = vue.shallowRef();\n  var disabled = index.useProp(\"disabled\");\n  var isFocused = vue.ref(false);\n  var handleFocus = function handleFocus(event) {\n    var cancelFocus = shared.isFunction(beforeFocus) ? beforeFocus(event) : false;\n    if (cancelFocus || isFocused.value) return;\n    isFocused.value = true;\n    emit(\"focus\", event);\n    afterFocus == null ? void 0 : afterFocus();\n  };\n  var handleBlur = function handleBlur(event) {\n    var _a;\n    var cancelBlur = shared.isFunction(beforeBlur) ? beforeBlur(event) : false;\n    if (cancelBlur || event.relatedTarget && ((_a = wrapperRef.value) == null ? void 0 : _a.contains(event.relatedTarget))) return;\n    isFocused.value = false;\n    emit(\"blur\", event);\n    afterBlur == null ? void 0 : afterBlur();\n  };\n  var handleClick = function handleClick() {\n    var _a, _b;\n    if (((_a = wrapperRef.value) == null ? void 0 : _a.contains(document.activeElement)) && wrapperRef.value !== document.activeElement || disabled.value) return;\n    (_b = target.value) == null ? void 0 : _b.focus();\n  };\n  vue.watch([wrapperRef, disabled], function (_ref2) {\n    var _ref3 = _slicedToArray(_ref2, 2),\n      el = _ref3[0],\n      disabled2 = _ref3[1];\n    if (!el) return;\n    if (disabled2) {\n      el.removeAttribute(\"tabindex\");\n    } else {\n      el.setAttribute(\"tabindex\", \"-1\");\n    }\n  });\n  core.useEventListener(wrapperRef, \"focus\", handleFocus, true);\n  core.useEventListener(wrapperRef, \"blur\", handleBlur, true);\n  core.useEventListener(wrapperRef, \"click\", handleClick, true);\n  if (process.env.NODE_ENV === \"test\") {\n    vue.onMounted(function () {\n      var targetEl = types.isElement(target.value) ? target.value : document.querySelector(\"input,textarea\");\n      if (targetEl) {\n        core.useEventListener(targetEl, \"focus\", handleFocus, true);\n        core.useEventListener(targetEl, \"blur\", handleBlur, true);\n      }\n    });\n  }\n  return {\n    isFocused: isFocused,\n    wrapperRef: wrapperRef,\n    handleFocus: handleFocus,\n    handleBlur: handleBlur\n  };\n}\nexports.useFocusController = useFocusController;","map":{"version":3,"names":["useFocusController","target","_ref","arguments","length","undefined","beforeFocus","afterFocus","beforeBlur","afterBlur","instance","vue","getCurrentInstance","emit","wrapperRef","shallowRef","disabled","index","useProp","isFocused","ref","handleFocus","event","cancelFocus","shared","isFunction","value","handleBlur","_a","cancelBlur","relatedTarget","contains","handleClick","_b","document","activeElement","focus","watch","_ref2","_ref3","_slicedToArray","el","disabled2","removeAttribute","setAttribute","core","useEventListener","process","env","NODE_ENV","onMounted","targetEl","types","isElement","querySelector"],"sources":["../../../../../packages/hooks/use-focus-controller/index.ts"],"sourcesContent":["import { getCurrentInstance, onMounted, ref, shallowRef, watch } from 'vue'\nimport { useEventListener } from '@vueuse/core'\nimport { isElement, isFunction } from '@element-plus/utils'\nimport { useProp } from '../use-prop'\nimport type { ShallowRef } from 'vue'\n\ninterface UseFocusControllerOptions {\n  /**\n   * return true to cancel focus\n   * @param event FocusEvent\n   */\n  beforeFocus?: (event: FocusEvent) => boolean | undefined\n  afterFocus?: () => void\n  /**\n   * return true to cancel blur\n   * @param event FocusEvent\n   */\n  beforeBlur?: (event: FocusEvent) => boolean | undefined\n  afterBlur?: () => void\n}\n\nexport function useFocusController<T extends { focus: () => void }>(\n  target: ShallowRef<T | undefined>,\n  {\n    beforeFocus,\n    afterFocus,\n    beforeBlur,\n    afterBlur,\n  }: UseFocusControllerOptions = {}\n) {\n  const instance = getCurrentInstance()!\n  const { emit } = instance\n  const wrapperRef = shallowRef<HTMLElement>()\n  const disabled = useProp<boolean>('disabled')\n  const isFocused = ref(false)\n\n  const handleFocus = (event: FocusEvent) => {\n    const cancelFocus = isFunction(beforeFocus) ? beforeFocus(event) : false\n    if (cancelFocus || isFocused.value) return\n    isFocused.value = true\n    emit('focus', event)\n    afterFocus?.()\n  }\n\n  const handleBlur = (event: FocusEvent) => {\n    const cancelBlur = isFunction(beforeBlur) ? beforeBlur(event) : false\n    if (\n      cancelBlur ||\n      (event.relatedTarget &&\n        wrapperRef.value?.contains(event.relatedTarget as Node))\n    )\n      return\n\n    isFocused.value = false\n    emit('blur', event)\n    afterBlur?.()\n  }\n\n  const handleClick = () => {\n    if (\n      (wrapperRef.value?.contains(document.activeElement) &&\n        wrapperRef.value !== document.activeElement) ||\n      disabled.value\n    )\n      return\n\n    target.value?.focus()\n  }\n\n  watch([wrapperRef, disabled], ([el, disabled]) => {\n    if (!el) return\n    if (disabled) {\n      el.removeAttribute('tabindex')\n    } else {\n      el.setAttribute('tabindex', '-1')\n    }\n  })\n\n  useEventListener(wrapperRef, 'focus', handleFocus, true)\n  useEventListener(wrapperRef, 'blur', handleBlur, true)\n  useEventListener(wrapperRef, 'click', handleClick, true)\n\n  // only for test\n  if (process.env.NODE_ENV === 'test') {\n    onMounted(() => {\n      const targetEl = isElement(target.value)\n        ? target.value\n        : document.querySelector('input,textarea')\n\n      if (targetEl) {\n        useEventListener(targetEl, 'focus', handleFocus, true)\n        useEventListener(targetEl, 'blur', handleBlur, true)\n      }\n    })\n  }\n\n  return {\n    isFocused,\n    /** Avoid using wrapperRef and handleFocus/handleBlur together */\n    wrapperRef,\n    handleFocus,\n    handleBlur,\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}