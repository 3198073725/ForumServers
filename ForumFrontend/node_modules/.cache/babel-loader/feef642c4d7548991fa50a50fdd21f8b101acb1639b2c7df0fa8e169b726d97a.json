{"ast":null,"code":"'use strict';\n\nvar _objectSpread = require(\"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/objectSpread2.js\")[\"default\"];\nrequire(\"core-js/modules/es.array.for-each.js\");\nrequire(\"core-js/modules/es.array.slice.js\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar lodashUnified = require('lodash-unified');\nvar core = require('@vueuse/core');\nvar constants = require('./constants.js');\nvar trigger = require('./trigger.js');\nvar pluginVue_exportHelper = require('../../../_virtual/plugin-vue_export-helper.js');\nvar index = require('../../../hooks/use-forward-ref/index.js');\nvar aria = require('../../../utils/dom/aria.js');\nvar onlyChild = require('../../slot/src/only-child.js');\nvar types = require('../../../utils/types.js');\nvar __default__ = vue.defineComponent({\n  name: \"ElPopperTrigger\",\n  inheritAttrs: false\n});\nvar _sfc_main = /* @__PURE__ */vue.defineComponent(_objectSpread(_objectSpread({}, __default__), {}, {\n  props: trigger.popperTriggerProps,\n  setup: function setup(__props, _ref) {\n    var expose = _ref.expose;\n    var props = __props;\n    var _vue$inject = vue.inject(constants.POPPER_INJECTION_KEY, void 0),\n      role = _vue$inject.role,\n      triggerRef = _vue$inject.triggerRef;\n    index.useForwardRef(triggerRef);\n    var ariaControls = vue.computed(function () {\n      return ariaHaspopup.value ? props.id : void 0;\n    });\n    var ariaDescribedby = vue.computed(function () {\n      if (role && role.value === \"tooltip\") {\n        return props.open && props.id ? props.id : void 0;\n      }\n      return void 0;\n    });\n    var ariaHaspopup = vue.computed(function () {\n      if (role && role.value !== \"tooltip\") {\n        return role.value;\n      }\n      return void 0;\n    });\n    var ariaExpanded = vue.computed(function () {\n      return ariaHaspopup.value ? \"\".concat(props.open) : void 0;\n    });\n    var virtualTriggerAriaStopWatch = void 0;\n    var TRIGGER_ELE_EVENTS = [\"onMouseenter\", \"onMouseleave\", \"onClick\", \"onKeydown\", \"onFocus\", \"onBlur\", \"onContextmenu\"];\n    vue.onMounted(function () {\n      vue.watch(function () {\n        return props.virtualRef;\n      }, function (virtualEl) {\n        if (virtualEl) {\n          triggerRef.value = core.unrefElement(virtualEl);\n        }\n      }, {\n        immediate: true\n      });\n      vue.watch(triggerRef, function (el, prevEl) {\n        virtualTriggerAriaStopWatch == null ? void 0 : virtualTriggerAriaStopWatch();\n        virtualTriggerAriaStopWatch = void 0;\n        if (types.isElement(el)) {\n          TRIGGER_ELE_EVENTS.forEach(function (eventName) {\n            var _a;\n            var handler = props[eventName];\n            if (handler) {\n              el.addEventListener(eventName.slice(2).toLowerCase(), handler);\n              (_a = prevEl == null ? void 0 : prevEl.removeEventListener) == null ? void 0 : _a.call(prevEl, eventName.slice(2).toLowerCase(), handler);\n            }\n          });\n          if (aria.isFocusable(el)) {\n            virtualTriggerAriaStopWatch = vue.watch([ariaControls, ariaDescribedby, ariaHaspopup, ariaExpanded], function (watches) {\n              [\"aria-controls\", \"aria-describedby\", \"aria-haspopup\", \"aria-expanded\"].forEach(function (key, idx) {\n                lodashUnified.isNil(watches[idx]) ? el.removeAttribute(key) : el.setAttribute(key, watches[idx]);\n              });\n            }, {\n              immediate: true\n            });\n          }\n        }\n        if (types.isElement(prevEl) && aria.isFocusable(prevEl)) {\n          [\"aria-controls\", \"aria-describedby\", \"aria-haspopup\", \"aria-expanded\"].forEach(function (key) {\n            return prevEl.removeAttribute(key);\n          });\n        }\n      }, {\n        immediate: true\n      });\n    });\n    vue.onBeforeUnmount(function () {\n      virtualTriggerAriaStopWatch == null ? void 0 : virtualTriggerAriaStopWatch();\n      virtualTriggerAriaStopWatch = void 0;\n      if (triggerRef.value && types.isElement(triggerRef.value)) {\n        var el = triggerRef.value;\n        TRIGGER_ELE_EVENTS.forEach(function (eventName) {\n          var handler = props[eventName];\n          if (handler) {\n            el.removeEventListener(eventName.slice(2).toLowerCase(), handler);\n          }\n        });\n        triggerRef.value = void 0;\n      }\n    });\n    expose({\n      triggerRef: triggerRef\n    });\n    return function (_ctx, _cache) {\n      return !_ctx.virtualTriggering ? (vue.openBlock(), vue.createBlock(vue.unref(onlyChild.OnlyChild), vue.mergeProps({\n        key: 0\n      }, _ctx.$attrs, {\n        \"aria-controls\": vue.unref(ariaControls),\n        \"aria-describedby\": vue.unref(ariaDescribedby),\n        \"aria-expanded\": vue.unref(ariaExpanded),\n        \"aria-haspopup\": vue.unref(ariaHaspopup)\n      }), {\n        \"default\": vue.withCtx(function () {\n          return [vue.renderSlot(_ctx.$slots, \"default\")];\n        }),\n        _: 3\n      }, 16, [\"aria-controls\", \"aria-describedby\", \"aria-expanded\", \"aria-haspopup\"])) : vue.createCommentVNode(\"v-if\", true);\n    };\n  }\n}));\nvar ElPopperTrigger = /* @__PURE__ */pluginVue_exportHelper[\"default\"](_sfc_main, [[\"__file\", \"trigger.vue\"]]);\nexports[\"default\"] = ElPopperTrigger;","map":{"version":3,"names":["name","inheritAttrs","_vue$inject","vue","inject","constants","POPPER_INJECTION_KEY","role","triggerRef","index","useForwardRef","ariaControls","computed","ariaHaspopup","value","props","id","ariaDescribedby","open","ariaExpanded","concat","virtualTriggerAriaStopWatch","TRIGGER_ELE_EVENTS","onMounted","watch","virtualRef","virtualEl","core","unrefElement","immediate","el","prevEl","types","isElement","forEach","eventName","_a","handler","addEventListener","slice","toLowerCase","removeEventListener","call","aria","isFocusable","watches","key","idx","lodashUnified","isNil","removeAttribute","setAttribute","onBeforeUnmount","expose","_ctx","_cache","virtualTriggering","openBlock","createBlock","unref","onlyChild","OnlyChild","mergeProps","$attrs","withCtx","renderSlot","$slots","_","createCommentVNode","ElPopperTrigger","pluginVue_exportHelper","_sfc_main"],"sources":["../../../../../../packages/components/popper/src/trigger.vue"],"sourcesContent":["<template>\n  <el-only-child\n    v-if=\"!virtualTriggering\"\n    v-bind=\"$attrs\"\n    :aria-controls=\"ariaControls\"\n    :aria-describedby=\"ariaDescribedby\"\n    :aria-expanded=\"ariaExpanded\"\n    :aria-haspopup=\"ariaHaspopup\"\n  >\n    <slot />\n  </el-only-child>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, inject, onBeforeUnmount, onMounted, watch } from 'vue'\nimport { isNil } from 'lodash-unified'\nimport { unrefElement } from '@vueuse/core'\nimport { ElOnlyChild } from '@element-plus/components/slot'\nimport { useForwardRef } from '@element-plus/hooks'\nimport { isElement, isFocusable } from '@element-plus/utils'\nimport { POPPER_INJECTION_KEY } from './constants'\nimport { popperTriggerProps } from './trigger'\n\nimport type { WatchStopHandle } from 'vue'\n\ndefineOptions({\n  name: 'ElPopperTrigger',\n  inheritAttrs: false,\n})\n\nconst props = defineProps(popperTriggerProps)\n\nconst { role, triggerRef } = inject(POPPER_INJECTION_KEY, undefined)!\n\nuseForwardRef(triggerRef)\n\nconst ariaControls = computed<string | undefined>(() => {\n  return ariaHaspopup.value ? props.id : undefined\n})\n\nconst ariaDescribedby = computed<string | undefined>(() => {\n  if (role && role.value === 'tooltip') {\n    return props.open && props.id ? props.id : undefined\n  }\n  return undefined\n})\n\nconst ariaHaspopup = computed<string | undefined>(() => {\n  if (role && role.value !== 'tooltip') {\n    return role.value\n  }\n  return undefined\n})\n\nconst ariaExpanded = computed<string | undefined>(() => {\n  return ariaHaspopup.value ? `${props.open}` : undefined\n})\n\nlet virtualTriggerAriaStopWatch: WatchStopHandle | undefined = undefined\n\nconst TRIGGER_ELE_EVENTS = [\n  'onMouseenter',\n  'onMouseleave',\n  'onClick',\n  'onKeydown',\n  'onFocus',\n  'onBlur',\n  'onContextmenu',\n] as const\n\nonMounted(() => {\n  watch(\n    () => props.virtualRef,\n    (virtualEl) => {\n      if (virtualEl) {\n        triggerRef.value = unrefElement(virtualEl as HTMLElement)\n      }\n    },\n    {\n      immediate: true,\n    }\n  )\n\n  watch(\n    triggerRef,\n    (el, prevEl) => {\n      virtualTriggerAriaStopWatch?.()\n      virtualTriggerAriaStopWatch = undefined\n      if (isElement(el)) {\n        TRIGGER_ELE_EVENTS.forEach((eventName) => {\n          const handler = props[eventName]\n          if (handler) {\n            ;(el as HTMLElement).addEventListener(\n              eventName.slice(2).toLowerCase(),\n              handler\n            )\n            ;(prevEl as HTMLElement)?.removeEventListener?.(\n              eventName.slice(2).toLowerCase(),\n              handler\n            )\n          }\n        })\n        if (isFocusable(el as HTMLElement)) {\n          virtualTriggerAriaStopWatch = watch(\n            [ariaControls, ariaDescribedby, ariaHaspopup, ariaExpanded],\n            (watches) => {\n              ;[\n                'aria-controls',\n                'aria-describedby',\n                'aria-haspopup',\n                'aria-expanded',\n              ].forEach((key, idx) => {\n                isNil(watches[idx])\n                  ? el.removeAttribute(key)\n                  : el.setAttribute(key, watches[idx]!)\n              })\n            },\n            { immediate: true }\n          )\n        }\n      }\n      if (isElement(prevEl) && isFocusable(prevEl as HTMLElement)) {\n        ;[\n          'aria-controls',\n          'aria-describedby',\n          'aria-haspopup',\n          'aria-expanded',\n        ].forEach((key) => prevEl.removeAttribute(key))\n      }\n    },\n    {\n      immediate: true,\n    }\n  )\n})\n\nonBeforeUnmount(() => {\n  virtualTriggerAriaStopWatch?.()\n  virtualTriggerAriaStopWatch = undefined\n  if (triggerRef.value && isElement(triggerRef.value)) {\n    const el = triggerRef.value as HTMLElement\n    TRIGGER_ELE_EVENTS.forEach((eventName) => {\n      const handler = props[eventName]\n      if (handler) {\n        el.removeEventListener(eventName.slice(2).toLowerCase(), handler)\n      }\n    })\n    triggerRef.value = undefined\n  }\n})\n\ndefineExpose({\n  /**\n   * @description trigger element\n   */\n  triggerRef,\n})\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}