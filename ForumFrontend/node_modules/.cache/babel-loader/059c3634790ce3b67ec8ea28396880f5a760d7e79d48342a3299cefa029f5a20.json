{"ast":null,"code":"'use strict';\n\nvar _regeneratorRuntime = require(\"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\")[\"default\"];\nvar _asyncToGenerator = require(\"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/asyncToGenerator.js\")[\"default\"];\nvar _slicedToArray = require(\"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/slicedToArray.js\")[\"default\"];\nvar _typeof = require(\"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/typeof.js\")[\"default\"];\nrequire(\"core-js/modules/es.array.concat.js\");\nrequire(\"core-js/modules/es.array.filter.js\");\nrequire(\"core-js/modules/es.array.find.js\");\nrequire(\"core-js/modules/es.array.includes.js\");\nrequire(\"core-js/modules/es.array.join.js\");\nrequire(\"core-js/modules/es.array.map.js\");\nrequire(\"core-js/modules/es.array.push.js\");\nrequire(\"core-js/modules/es.array.slice.js\");\nrequire(\"core-js/modules/es.array.some.js\");\nrequire(\"core-js/modules/es.iterator.constructor.js\");\nrequire(\"core-js/modules/es.iterator.filter.js\");\nrequire(\"core-js/modules/es.iterator.find.js\");\nrequire(\"core-js/modules/es.iterator.map.js\");\nrequire(\"core-js/modules/es.iterator.some.js\");\nrequire(\"core-js/modules/es.number.constructor.js\");\nrequire(\"core-js/modules/es.number.parse-int.js\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar dayjs = require('dayjs');\nvar lodashUnified = require('lodash-unified');\nvar utils = require('../utils.js');\nvar index = require('../../../../hooks/use-locale/index.js');\nvar arrays = require('../../../../utils/arrays.js');\nvar index$1 = require('../../../../hooks/use-namespace/index.js');\nvar shared = require('@vue/shared');\nfunction _interopDefaultLegacy(e) {\n  return e && _typeof(e) === 'object' && 'default' in e ? e : {\n    'default': e\n  };\n}\nvar dayjs__default = /*#__PURE__*/_interopDefaultLegacy(dayjs);\nvar isNormalDay = function isNormalDay() {\n  var type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n  return [\"normal\", \"today\"].includes(type);\n};\nvar useBasicDateTable = function useBasicDateTable(props, emit) {\n  var _index$useLocale = index.useLocale(),\n    lang = _index$useLocale.lang;\n  var tbodyRef = vue.ref();\n  var currentCellRef = vue.ref();\n  var lastRow = vue.ref();\n  var lastColumn = vue.ref();\n  var tableRows = vue.ref([[], [], [], [], [], []]);\n  var focusWithClick = false;\n  var firstDayOfWeek = props.date.$locale().weekStart || 7;\n  var WEEKS_CONSTANT = props.date.locale(\"en\").localeData().weekdaysShort().map(function (_) {\n    return _.toLowerCase();\n  });\n  var offsetDay = vue.computed(function () {\n    return firstDayOfWeek > 3 ? 7 - firstDayOfWeek : -firstDayOfWeek;\n  });\n  var startDate = vue.computed(function () {\n    var startDayOfMonth = props.date.startOf(\"month\");\n    return startDayOfMonth.subtract(startDayOfMonth.day() || 7, \"day\");\n  });\n  var WEEKS = vue.computed(function () {\n    return WEEKS_CONSTANT.concat(WEEKS_CONSTANT).slice(firstDayOfWeek, firstDayOfWeek + 7);\n  });\n  var hasCurrent = vue.computed(function () {\n    return lodashUnified.flatten(vue.unref(rows)).some(function (row) {\n      return row.isCurrent;\n    });\n  });\n  var days = vue.computed(function () {\n    var startOfMonth = props.date.startOf(\"month\");\n    var startOfMonthDay = startOfMonth.day() || 7;\n    var dateCountOfMonth = startOfMonth.daysInMonth();\n    var dateCountOfLastMonth = startOfMonth.subtract(1, \"month\").daysInMonth();\n    return {\n      startOfMonthDay: startOfMonthDay,\n      dateCountOfMonth: dateCountOfMonth,\n      dateCountOfLastMonth: dateCountOfLastMonth\n    };\n  });\n  var selectedDate = vue.computed(function () {\n    return props.selectionMode === \"dates\" ? arrays.castArray(props.parsedValue) : [];\n  });\n  var setDateText = function setDateText(cell, _ref) {\n    var count = _ref.count,\n      rowIndex = _ref.rowIndex,\n      columnIndex = _ref.columnIndex;\n    var _vue$unref = vue.unref(days),\n      startOfMonthDay = _vue$unref.startOfMonthDay,\n      dateCountOfMonth = _vue$unref.dateCountOfMonth,\n      dateCountOfLastMonth = _vue$unref.dateCountOfLastMonth;\n    var offset = vue.unref(offsetDay);\n    if (rowIndex >= 0 && rowIndex <= 1) {\n      var numberOfDaysFromPreviousMonth = startOfMonthDay + offset < 0 ? 7 + startOfMonthDay + offset : startOfMonthDay + offset;\n      if (columnIndex + rowIndex * 7 >= numberOfDaysFromPreviousMonth) {\n        cell.text = count;\n        return true;\n      } else {\n        cell.text = dateCountOfLastMonth - (numberOfDaysFromPreviousMonth - columnIndex % 7) + 1 + rowIndex * 7;\n        cell.type = \"prev-month\";\n      }\n    } else {\n      if (count <= dateCountOfMonth) {\n        cell.text = count;\n      } else {\n        cell.text = count - dateCountOfMonth;\n        cell.type = \"next-month\";\n      }\n      return true;\n    }\n    return false;\n  };\n  var _setCellMetadata = function setCellMetadata(cell, _ref2, count) {\n    var columnIndex = _ref2.columnIndex,\n      rowIndex = _ref2.rowIndex;\n    var disabledDate = props.disabledDate,\n      cellClassName = props.cellClassName;\n    var _selectedDate = vue.unref(selectedDate);\n    var shouldIncrement = setDateText(cell, {\n      count: count,\n      rowIndex: rowIndex,\n      columnIndex: columnIndex\n    });\n    var cellDate = cell.dayjs.toDate();\n    cell.selected = _selectedDate.find(function (d) {\n      return d.isSame(cell.dayjs, \"day\");\n    });\n    cell.isSelected = !!cell.selected;\n    cell.isCurrent = isCurrent(cell);\n    cell.disabled = disabledDate == null ? void 0 : disabledDate(cellDate);\n    cell.customClass = cellClassName == null ? void 0 : cellClassName(cellDate);\n    return shouldIncrement;\n  };\n  var setRowMetadata = function setRowMetadata(row) {\n    if (props.selectionMode === \"week\") {\n      var _ref3 = props.showWeekNumber ? [1, 7] : [0, 6],\n        _ref4 = _slicedToArray(_ref3, 2),\n        start = _ref4[0],\n        end = _ref4[1];\n      var isActive = isWeekActive(row[start + 1]);\n      row[start].inRange = isActive;\n      row[start].start = isActive;\n      row[end].inRange = isActive;\n      row[end].end = isActive;\n    }\n  };\n  var rows = vue.computed(function () {\n    var minDate = props.minDate,\n      maxDate = props.maxDate,\n      rangeState = props.rangeState,\n      showWeekNumber = props.showWeekNumber;\n    var offset = vue.unref(offsetDay);\n    var rows_ = vue.unref(tableRows);\n    var dateUnit = \"day\";\n    var count = 1;\n    if (showWeekNumber) {\n      for (var rowIndex = 0; rowIndex < 6; rowIndex++) {\n        if (!rows_[rowIndex][0]) {\n          rows_[rowIndex][0] = {\n            type: \"week\",\n            text: vue.unref(startDate).add(rowIndex * 7 + 1, dateUnit).week()\n          };\n        }\n      }\n    }\n    utils.buildPickerTable({\n      row: 6,\n      column: 7\n    }, rows_, {\n      startDate: minDate,\n      columnIndexOffset: showWeekNumber ? 1 : 0,\n      nextEndDate: rangeState.endDate || maxDate || rangeState.selecting && minDate || null,\n      now: dayjs__default[\"default\"]().locale(vue.unref(lang)).startOf(dateUnit),\n      unit: dateUnit,\n      relativeDateGetter: function relativeDateGetter(idx) {\n        return vue.unref(startDate).add(idx - offset, dateUnit);\n      },\n      setCellMetadata: function setCellMetadata() {\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n        if (_setCellMetadata.apply(void 0, args.concat([count]))) {\n          count += 1;\n        }\n      },\n      setRowMetadata: setRowMetadata\n    });\n    return rows_;\n  });\n  vue.watch(function () {\n    return props.date;\n  }, /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n    var _a;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          if (!((_a = vue.unref(tbodyRef)) == null ? void 0 : _a.contains(document.activeElement))) {\n            _context.next = 5;\n            break;\n          }\n          _context.next = 3;\n          return vue.nextTick();\n        case 3:\n          _context.next = 5;\n          return focus();\n        case 5:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  })));\n  var focus = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n      var _a;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            return _context2.abrupt(\"return\", (_a = vue.unref(currentCellRef)) == null ? void 0 : _a.focus());\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }, _callee2);\n    }));\n    return function focus() {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  var isCurrent = function isCurrent(cell) {\n    return props.selectionMode === \"date\" && isNormalDay(cell.type) && cellMatchesDate(cell, props.parsedValue);\n  };\n  var cellMatchesDate = function cellMatchesDate(cell, date) {\n    if (!date) return false;\n    return dayjs__default[\"default\"](date).locale(vue.unref(lang)).isSame(props.date.date(Number(cell.text)), \"day\");\n  };\n  var getDateOfCell = function getDateOfCell(row, column) {\n    var offsetFromStart = row * 7 + (column - (props.showWeekNumber ? 1 : 0)) - vue.unref(offsetDay);\n    return vue.unref(startDate).add(offsetFromStart, \"day\");\n  };\n  var handleMouseMove = function handleMouseMove(event) {\n    var _a;\n    if (!props.rangeState.selecting) return;\n    var target = event.target;\n    if (target.tagName === \"SPAN\") {\n      target = (_a = target.parentNode) == null ? void 0 : _a.parentNode;\n    }\n    if (target.tagName === \"DIV\") {\n      target = target.parentNode;\n    }\n    if (target.tagName !== \"TD\") return;\n    var row = target.parentNode.rowIndex - 1;\n    var column = target.cellIndex;\n    if (vue.unref(rows)[row][column].disabled) return;\n    if (row !== vue.unref(lastRow) || column !== vue.unref(lastColumn)) {\n      lastRow.value = row;\n      lastColumn.value = column;\n      emit(\"changerange\", {\n        selecting: true,\n        endDate: getDateOfCell(row, column)\n      });\n    }\n  };\n  var isSelectedCell = function isSelectedCell(cell) {\n    return !vue.unref(hasCurrent) && (cell == null ? void 0 : cell.text) === 1 && cell.type === \"normal\" || cell.isCurrent;\n  };\n  var handleFocus = function handleFocus(event) {\n    if (focusWithClick || vue.unref(hasCurrent) || props.selectionMode !== \"date\") return;\n    handlePickDate(event, true);\n  };\n  var handleMouseDown = function handleMouseDown(event) {\n    var target = event.target.closest(\"td\");\n    if (!target) return;\n    focusWithClick = true;\n  };\n  var handleMouseUp = function handleMouseUp(event) {\n    var target = event.target.closest(\"td\");\n    if (!target) return;\n    focusWithClick = false;\n  };\n  var handleRangePick = function handleRangePick(newDate) {\n    if (!props.rangeState.selecting || !props.minDate) {\n      emit(\"pick\", {\n        minDate: newDate,\n        maxDate: null\n      });\n      emit(\"select\", true);\n    } else {\n      if (newDate >= props.minDate) {\n        emit(\"pick\", {\n          minDate: props.minDate,\n          maxDate: newDate\n        });\n      } else {\n        emit(\"pick\", {\n          minDate: newDate,\n          maxDate: props.minDate\n        });\n      }\n      emit(\"select\", false);\n    }\n  };\n  var handleWeekPick = function handleWeekPick(newDate) {\n    var weekNumber = newDate.week();\n    var value = \"\".concat(newDate.year(), \"w\").concat(weekNumber);\n    emit(\"pick\", {\n      year: newDate.year(),\n      week: weekNumber,\n      value: value,\n      date: newDate.startOf(\"week\")\n    });\n  };\n  var handleDatesPick = function handleDatesPick(newDate, selected) {\n    var newValue = selected ? arrays.castArray(props.parsedValue).filter(function (d) {\n      return (d == null ? void 0 : d.valueOf()) !== newDate.valueOf();\n    }) : arrays.castArray(props.parsedValue).concat([newDate]);\n    emit(\"pick\", newValue);\n  };\n  var handlePickDate = function handlePickDate(event) {\n    var isKeyboardMovement = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    var target = event.target.closest(\"td\");\n    if (!target) return;\n    var row = target.parentNode.rowIndex - 1;\n    var column = target.cellIndex;\n    var cell = vue.unref(rows)[row][column];\n    if (cell.disabled || cell.type === \"week\") return;\n    var newDate = getDateOfCell(row, column);\n    switch (props.selectionMode) {\n      case \"range\":\n        {\n          handleRangePick(newDate);\n          break;\n        }\n      case \"date\":\n        {\n          emit(\"pick\", newDate, isKeyboardMovement);\n          break;\n        }\n      case \"week\":\n        {\n          handleWeekPick(newDate);\n          break;\n        }\n      case \"dates\":\n        {\n          handleDatesPick(newDate, !!cell.selected);\n          break;\n        }\n    }\n  };\n  var isWeekActive = function isWeekActive(cell) {\n    if (props.selectionMode !== \"week\") return false;\n    var newDate = props.date.startOf(\"day\");\n    if (cell.type === \"prev-month\") {\n      newDate = newDate.subtract(1, \"month\");\n    }\n    if (cell.type === \"next-month\") {\n      newDate = newDate.add(1, \"month\");\n    }\n    newDate = newDate.date(Number.parseInt(cell.text, 10));\n    if (props.parsedValue && !shared.isArray(props.parsedValue)) {\n      var dayOffset = (props.parsedValue.day() - firstDayOfWeek + 7) % 7 - 1;\n      var weekDate = props.parsedValue.subtract(dayOffset, \"day\");\n      return weekDate.isSame(newDate, \"day\");\n    }\n    return false;\n  };\n  return {\n    WEEKS: WEEKS,\n    rows: rows,\n    tbodyRef: tbodyRef,\n    currentCellRef: currentCellRef,\n    focus: focus,\n    isCurrent: isCurrent,\n    isWeekActive: isWeekActive,\n    isSelectedCell: isSelectedCell,\n    handlePickDate: handlePickDate,\n    handleMouseUp: handleMouseUp,\n    handleMouseDown: handleMouseDown,\n    handleMouseMove: handleMouseMove,\n    handleFocus: handleFocus\n  };\n};\nvar useBasicDateTableDOM = function useBasicDateTableDOM(props, _ref7) {\n  var isCurrent = _ref7.isCurrent,\n    isWeekActive = _ref7.isWeekActive;\n  var ns = index$1.useNamespace(\"date-table\");\n  var _index$useLocale2 = index.useLocale(),\n    t = _index$useLocale2.t;\n  var tableKls = vue.computed(function () {\n    return [ns.b(), {\n      \"is-week-mode\": props.selectionMode === \"week\"\n    }];\n  });\n  var tableLabel = vue.computed(function () {\n    return t(\"el.datepicker.dateTablePrompt\");\n  });\n  var weekLabel = vue.computed(function () {\n    return t(\"el.datepicker.week\");\n  });\n  var getCellClasses = function getCellClasses(cell) {\n    var classes = [];\n    if (isNormalDay(cell.type) && !cell.disabled) {\n      classes.push(\"available\");\n      if (cell.type === \"today\") {\n        classes.push(\"today\");\n      }\n    } else {\n      classes.push(cell.type);\n    }\n    if (isCurrent(cell)) {\n      classes.push(\"current\");\n    }\n    if (cell.inRange && (isNormalDay(cell.type) || props.selectionMode === \"week\")) {\n      classes.push(\"in-range\");\n      if (cell.start) {\n        classes.push(\"start-date\");\n      }\n      if (cell.end) {\n        classes.push(\"end-date\");\n      }\n    }\n    if (cell.disabled) {\n      classes.push(\"disabled\");\n    }\n    if (cell.selected) {\n      classes.push(\"selected\");\n    }\n    if (cell.customClass) {\n      classes.push(cell.customClass);\n    }\n    return classes.join(\" \");\n  };\n  var getRowKls = function getRowKls(cell) {\n    return [ns.e(\"row\"), {\n      current: isWeekActive(cell)\n    }];\n  };\n  return {\n    tableKls: tableKls,\n    tableLabel: tableLabel,\n    weekLabel: weekLabel,\n    getCellClasses: getCellClasses,\n    getRowKls: getRowKls,\n    t: t\n  };\n};\nexports.useBasicDateTable = useBasicDateTable;\nexports.useBasicDateTableDOM = useBasicDateTableDOM;","map":{"version":3,"names":["isNormalDay","type","arguments","length","undefined","includes","useBasicDateTable","props","emit","_index$useLocale","index","useLocale","lang","tbodyRef","vue","ref","currentCellRef","lastRow","lastColumn","tableRows","focusWithClick","firstDayOfWeek","date","$locale","weekStart","WEEKS_CONSTANT","locale","localeData","weekdaysShort","map","_","toLowerCase","offsetDay","computed","startDate","startDayOfMonth","startOf","subtract","day","WEEKS","concat","slice","hasCurrent","lodashUnified","flatten","unref","rows","some","row","isCurrent","days","startOfMonth","startOfMonthDay","dateCountOfMonth","daysInMonth","dateCountOfLastMonth","selectedDate","selectionMode","arrays","castArray","parsedValue","setDateText","cell","_ref","count","rowIndex","columnIndex","_vue$unref","offset","numberOfDaysFromPreviousMonth","text","setCellMetadata","_ref2","disabledDate","cellClassName","_selectedDate","shouldIncrement","cellDate","dayjs","toDate","selected","find","d","isSame","isSelected","disabled","customClass","setRowMetadata","_ref3","showWeekNumber","_ref4","_slicedToArray","start","end","isActive","isWeekActive","inRange","minDate","maxDate","rangeState","rows_","dateUnit","add","week","utils","buildPickerTable","column","columnIndexOffset","nextEndDate","endDate","selecting","now","dayjs__default","unit","relativeDateGetter","idx","_len","args","Array","_key","apply","watch","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_a","wrap","_callee$","_context","prev","next","contains","document","activeElement","nextTick","focus","stop","_ref6","_callee2","_callee2$","_context2","abrupt","cellMatchesDate","Number","getDateOfCell","offsetFromStart","handleMouseMove","event","target","tagName","parentNode","cellIndex","value","isSelectedCell","handleFocus","handlePickDate","handleMouseDown","closest","handleMouseUp","handleRangePick","newDate","handleWeekPick","weekNumber","year","handleDatesPick","newValue","filter","valueOf","isKeyboardMovement","parseInt","shared","isArray","dayOffset","weekDate","useBasicDateTableDOM","_ref7","ns","index$1","useNamespace","_index$useLocale2","t","tableKls","b","tableLabel","weekLabel","getCellClasses","classes","push","join","getRowKls","e","current"],"sources":["../../../../../../../packages/components/date-picker/src/composables/use-basic-date-table.ts"],"sourcesContent":["import { computed, nextTick, ref, unref, watch } from 'vue'\nimport dayjs from 'dayjs'\nimport { flatten } from 'lodash-unified'\nimport { useLocale, useNamespace } from '@element-plus/hooks'\nimport { castArray, isArray } from '@element-plus/utils'\nimport { buildPickerTable } from '../utils'\n\nimport type { SetupContext } from 'vue'\nimport type { Dayjs } from 'dayjs'\nimport type { DateCell } from '../date-picker.type'\nimport type {\n  BasicDateTableEmits,\n  BasicDateTableProps,\n} from '../props/basic-date-table'\n\nconst isNormalDay = (type = '') => {\n  return ['normal', 'today'].includes(type)\n}\n\nexport const useBasicDateTable = (\n  props: BasicDateTableProps,\n  emit: SetupContext<BasicDateTableEmits>['emit']\n) => {\n  const { lang } = useLocale()\n  const tbodyRef = ref<HTMLElement>()\n  const currentCellRef = ref<HTMLElement>()\n  // data\n  const lastRow = ref<number>()\n  const lastColumn = ref<number>()\n  const tableRows = ref<DateCell[][]>([[], [], [], [], [], []])\n\n  let focusWithClick = false\n\n  // todo better way to get Day.js locale object\n  const firstDayOfWeek = (props.date as any).$locale().weekStart || 7\n  const WEEKS_CONSTANT = props.date\n    .locale('en')\n    .localeData()\n    .weekdaysShort()\n    .map((_) => _.toLowerCase())\n\n  const offsetDay = computed(() => {\n    // Sunday 7(0), cal the left and right offset days, 3217654, such as Monday is -1, the is to adjust the position of the first two rows of dates\n    return firstDayOfWeek > 3 ? 7 - firstDayOfWeek : -firstDayOfWeek\n  })\n\n  const startDate = computed(() => {\n    const startDayOfMonth = props.date.startOf('month')\n    return startDayOfMonth.subtract(startDayOfMonth.day() || 7, 'day')\n  })\n\n  const WEEKS = computed(() => {\n    return WEEKS_CONSTANT.concat(WEEKS_CONSTANT).slice(\n      firstDayOfWeek,\n      firstDayOfWeek + 7\n    )\n  })\n\n  const hasCurrent = computed<boolean>(() => {\n    return flatten(unref(rows)).some((row) => {\n      return row.isCurrent\n    })\n  })\n\n  const days = computed(() => {\n    const startOfMonth = props.date.startOf('month')\n    const startOfMonthDay = startOfMonth.day() || 7 // day of first day\n    const dateCountOfMonth = startOfMonth.daysInMonth()\n\n    const dateCountOfLastMonth = startOfMonth.subtract(1, 'month').daysInMonth()\n\n    return {\n      startOfMonthDay,\n      dateCountOfMonth,\n      dateCountOfLastMonth,\n    }\n  })\n\n  const selectedDate = computed(() => {\n    return props.selectionMode === 'dates'\n      ? (castArray(props.parsedValue) as Dayjs[])\n      : ([] as Dayjs[])\n  })\n\n  // Return value indicates should the counter be incremented\n  type CellCoordinate = { columnIndex: number; rowIndex: number }\n  type CellMeta = CellCoordinate & {\n    count: number\n  }\n  const setDateText = (\n    cell: DateCell,\n    { count, rowIndex, columnIndex }: CellMeta\n  ): boolean => {\n    const { startOfMonthDay, dateCountOfMonth, dateCountOfLastMonth } =\n      unref(days)\n    const offset = unref(offsetDay)\n    if (rowIndex >= 0 && rowIndex <= 1) {\n      const numberOfDaysFromPreviousMonth =\n        startOfMonthDay + offset < 0\n          ? 7 + startOfMonthDay + offset\n          : startOfMonthDay + offset\n\n      if (columnIndex + rowIndex * 7 >= numberOfDaysFromPreviousMonth) {\n        cell.text = count\n        return true\n      } else {\n        cell.text =\n          dateCountOfLastMonth -\n          (numberOfDaysFromPreviousMonth - (columnIndex % 7)) +\n          1 +\n          rowIndex * 7\n        cell.type = 'prev-month'\n      }\n    } else {\n      if (count <= dateCountOfMonth) {\n        cell.text = count\n      } else {\n        cell.text = count - dateCountOfMonth\n        cell.type = 'next-month'\n      }\n      return true\n    }\n    return false\n  }\n\n  const setCellMetadata = (\n    cell: DateCell,\n    { columnIndex, rowIndex }: CellCoordinate,\n    count: number\n  ) => {\n    const { disabledDate, cellClassName } = props\n    const _selectedDate = unref(selectedDate)\n    const shouldIncrement = setDateText(cell, { count, rowIndex, columnIndex })\n\n    const cellDate = cell.dayjs!.toDate()\n    cell.selected = _selectedDate.find((d) => d.isSame(cell.dayjs, 'day'))\n    cell.isSelected = !!cell.selected\n    cell.isCurrent = isCurrent(cell)\n    cell.disabled = disabledDate?.(cellDate)\n    cell.customClass = cellClassName?.(cellDate)\n    return shouldIncrement\n  }\n\n  const setRowMetadata = (row: DateCell[]) => {\n    if (props.selectionMode === 'week') {\n      const [start, end] = props.showWeekNumber ? [1, 7] : [0, 6]\n      const isActive = isWeekActive(row[start + 1])\n      row[start].inRange = isActive\n      row[start].start = isActive\n      row[end].inRange = isActive\n      row[end].end = isActive\n    }\n  }\n\n  const rows = computed(() => {\n    const { minDate, maxDate, rangeState, showWeekNumber } = props\n\n    const offset = unref(offsetDay)\n    const rows_ = unref(tableRows)\n    const dateUnit = 'day'\n    let count = 1\n\n    if (showWeekNumber) {\n      for (let rowIndex = 0; rowIndex < 6; rowIndex++) {\n        if (!rows_[rowIndex][0]) {\n          rows_[rowIndex][0] = {\n            type: 'week',\n            text: unref(startDate)\n              .add(rowIndex * 7 + 1, dateUnit)\n              .week(),\n          }\n        }\n      }\n    }\n\n    buildPickerTable({ row: 6, column: 7 }, rows_, {\n      startDate: minDate,\n      columnIndexOffset: showWeekNumber ? 1 : 0,\n      nextEndDate:\n        rangeState.endDate ||\n        maxDate ||\n        (rangeState.selecting && minDate) ||\n        null,\n      now: dayjs().locale(unref(lang)).startOf(dateUnit),\n      unit: dateUnit,\n      relativeDateGetter: (idx: number) =>\n        unref(startDate).add(idx - offset, dateUnit),\n      setCellMetadata: (...args) => {\n        if (setCellMetadata(...args, count)) {\n          count += 1\n        }\n      },\n\n      setRowMetadata,\n    })\n\n    return rows_\n  })\n\n  watch(\n    () => props.date,\n    async () => {\n      if (unref(tbodyRef)?.contains(document.activeElement)) {\n        await nextTick()\n        await focus()\n        // currentCellRef.value?.focus()\n      }\n    }\n  )\n\n  const focus = async () => unref(currentCellRef)?.focus()\n\n  const isCurrent = (cell: DateCell): boolean => {\n    return (\n      props.selectionMode === 'date' &&\n      isNormalDay(cell.type) &&\n      cellMatchesDate(cell, props.parsedValue as Dayjs)\n    )\n  }\n\n  const cellMatchesDate = (cell: DateCell, date: Dayjs) => {\n    if (!date) return false\n    return dayjs(date)\n      .locale(unref(lang))\n      .isSame(props.date.date(Number(cell.text)), 'day')\n  }\n\n  const getDateOfCell = (row: number, column: number) => {\n    const offsetFromStart =\n      row * 7 + (column - (props.showWeekNumber ? 1 : 0)) - unref(offsetDay)\n    return unref(startDate).add(offsetFromStart, 'day')\n  }\n\n  const handleMouseMove = (event: MouseEvent) => {\n    if (!props.rangeState.selecting) return\n\n    let target = event.target as HTMLElement\n    if (target.tagName === 'SPAN') {\n      target = target.parentNode?.parentNode as HTMLElement\n    }\n    if (target.tagName === 'DIV') {\n      target = target.parentNode as HTMLElement\n    }\n    if (target.tagName !== 'TD') return\n\n    const row = (target.parentNode as HTMLTableRowElement).rowIndex - 1\n    const column = (target as HTMLTableCellElement).cellIndex\n\n    // can not select disabled date\n    if (unref(rows)[row][column].disabled) return\n\n    // only update rangeState when mouse moves to a new cell\n    // this avoids frequent Date object creation and improves performance\n    if (row !== unref(lastRow) || column !== unref(lastColumn)) {\n      lastRow.value = row\n      lastColumn.value = column\n      emit('changerange', {\n        selecting: true,\n        endDate: getDateOfCell(row, column),\n      })\n    }\n  }\n\n  const isSelectedCell = (cell: DateCell) => {\n    return (\n      (!unref(hasCurrent) && cell?.text === 1 && cell.type === 'normal') ||\n      cell.isCurrent\n    )\n  }\n\n  const handleFocus = (event: FocusEvent) => {\n    if (focusWithClick || unref(hasCurrent) || props.selectionMode !== 'date')\n      return\n    handlePickDate(event, true)\n  }\n\n  const handleMouseDown = (event: MouseEvent) => {\n    const target = (event.target as HTMLElement).closest('td')\n    if (!target) return\n    focusWithClick = true\n  }\n\n  const handleMouseUp = (event: MouseEvent) => {\n    const target = (event.target as HTMLElement).closest('td')\n    if (!target) return\n    focusWithClick = false\n  }\n\n  const handleRangePick = (newDate: Dayjs) => {\n    if (!props.rangeState.selecting || !props.minDate) {\n      emit('pick', { minDate: newDate, maxDate: null })\n      emit('select', true)\n    } else {\n      if (newDate >= props.minDate) {\n        emit('pick', { minDate: props.minDate, maxDate: newDate })\n      } else {\n        emit('pick', { minDate: newDate, maxDate: props.minDate })\n      }\n      emit('select', false)\n    }\n  }\n\n  const handleWeekPick = (newDate: Dayjs) => {\n    const weekNumber = newDate.week()\n    const value = `${newDate.year()}w${weekNumber}`\n    emit('pick', {\n      year: newDate.year(),\n      week: weekNumber,\n      value,\n      date: newDate.startOf('week'),\n    })\n  }\n\n  const handleDatesPick = (newDate: Dayjs, selected: boolean) => {\n    const newValue = selected\n      ? castArray(props.parsedValue).filter(\n          (d) => d?.valueOf() !== newDate.valueOf()\n        )\n      : castArray(props.parsedValue).concat([newDate])\n    emit('pick', newValue)\n  }\n\n  const handlePickDate = (\n    event: FocusEvent | MouseEvent,\n    isKeyboardMovement = false\n  ) => {\n    const target = (event.target as HTMLElement).closest('td')\n\n    if (!target) return\n\n    const row = (target.parentNode as HTMLTableRowElement).rowIndex - 1\n    const column = (target as HTMLTableCellElement).cellIndex\n    const cell = unref(rows)[row][column]\n\n    if (cell.disabled || cell.type === 'week') return\n\n    const newDate = getDateOfCell(row, column)\n\n    switch (props.selectionMode) {\n      case 'range': {\n        handleRangePick(newDate)\n        break\n      }\n      case 'date': {\n        emit('pick', newDate, isKeyboardMovement)\n        break\n      }\n      case 'week': {\n        handleWeekPick(newDate)\n        break\n      }\n      case 'dates': {\n        handleDatesPick(newDate, !!cell.selected)\n        break\n      }\n      default: {\n        break\n      }\n    }\n  }\n\n  const isWeekActive = (cell: DateCell) => {\n    if (props.selectionMode !== 'week') return false\n    let newDate = props.date.startOf('day')\n\n    if (cell.type === 'prev-month') {\n      newDate = newDate.subtract(1, 'month')\n    }\n\n    if (cell.type === 'next-month') {\n      newDate = newDate.add(1, 'month')\n    }\n\n    newDate = newDate.date(Number.parseInt(cell.text as any, 10))\n\n    if (props.parsedValue && !isArray(props.parsedValue)) {\n      const dayOffset = ((props.parsedValue.day() - firstDayOfWeek + 7) % 7) - 1\n      const weekDate = props.parsedValue.subtract(dayOffset, 'day')\n      return weekDate.isSame(newDate, 'day')\n    }\n    return false\n  }\n\n  return {\n    WEEKS,\n    rows,\n    tbodyRef,\n    currentCellRef,\n\n    // cellMatchesDate,\n    // getDateOfCell,\n    focus,\n    isCurrent,\n    isWeekActive,\n    isSelectedCell,\n\n    handlePickDate,\n    handleMouseUp,\n    handleMouseDown,\n    handleMouseMove,\n    handleFocus,\n  }\n}\n\nexport const useBasicDateTableDOM = (\n  props: BasicDateTableProps,\n  {\n    isCurrent,\n    isWeekActive,\n  }: Pick<ReturnType<typeof useBasicDateTable>, 'isCurrent' | 'isWeekActive'>\n) => {\n  const ns = useNamespace('date-table')\n  const { t } = useLocale()\n\n  const tableKls = computed(() => [\n    ns.b(),\n    { 'is-week-mode': props.selectionMode === 'week' },\n  ])\n\n  const tableLabel = computed(() => t('el.datepicker.dateTablePrompt'))\n  const weekLabel = computed(() => t('el.datepicker.week'))\n\n  const getCellClasses = (cell: DateCell) => {\n    const classes: string[] = []\n    if (isNormalDay(cell.type) && !cell.disabled) {\n      classes.push('available')\n      if (cell.type === 'today') {\n        classes.push('today')\n      }\n    } else {\n      classes.push(cell.type!)\n    }\n\n    if (isCurrent(cell)) {\n      classes.push('current')\n    }\n\n    if (\n      cell.inRange &&\n      (isNormalDay(cell.type) || props.selectionMode === 'week')\n    ) {\n      classes.push('in-range')\n\n      if (cell.start) {\n        classes.push('start-date')\n      }\n\n      if (cell.end) {\n        classes.push('end-date')\n      }\n    }\n\n    if (cell.disabled) {\n      classes.push('disabled')\n    }\n\n    if (cell.selected) {\n      classes.push('selected')\n    }\n\n    if (cell.customClass) {\n      classes.push(cell.customClass)\n    }\n\n    return classes.join(' ')\n  }\n\n  const getRowKls = (cell: DateCell) => [\n    ns.e('row'),\n    { current: isWeekActive(cell) },\n  ]\n\n  return {\n    tableKls,\n    tableLabel,\n    weekLabel,\n\n    getCellClasses,\n    getRowKls,\n    t,\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}