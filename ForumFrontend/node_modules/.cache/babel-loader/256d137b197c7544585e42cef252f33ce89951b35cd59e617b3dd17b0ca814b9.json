{"ast":null,"code":"'use strict';\n\nrequire(\"core-js/modules/es.array.concat.js\");\nrequire(\"core-js/modules/es.array.filter.js\");\nrequire(\"core-js/modules/es.array.for-each.js\");\nrequire(\"core-js/modules/es.array.from.js\");\nrequire(\"core-js/modules/es.array.push.js\");\nrequire(\"core-js/modules/es.array.reduce.js\");\nrequire(\"core-js/modules/es.iterator.constructor.js\");\nrequire(\"core-js/modules/es.iterator.filter.js\");\nrequire(\"core-js/modules/es.iterator.for-each.js\");\nrequire(\"core-js/modules/es.iterator.reduce.js\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/es.string.iterator.js\");\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar layoutObserver = require('../layout-observer.js');\nvar util = require('../util.js');\nvar tokens = require('../tokens.js');\nvar renderHelper = require('./render-helper.js');\nvar defaults = require('./defaults.js');\nvar index = require('../../../../hooks/use-namespace/index.js');\nvar style = require('../../../../utils/dom/style.js');\nvar core = require('@vueuse/core');\nvar raf = require('../../../../utils/raf.js');\nvar TableBody = vue.defineComponent({\n  name: \"ElTableBody\",\n  props: defaults[\"default\"],\n  setup: function setup(props) {\n    var instance = vue.getCurrentInstance();\n    var parent = vue.inject(tokens.TABLE_INJECTION_KEY);\n    var ns = index.useNamespace(\"table\");\n    var _renderHelper$default = renderHelper[\"default\"](props),\n      wrappedRowRender = _renderHelper$default.wrappedRowRender,\n      tooltipContent = _renderHelper$default.tooltipContent,\n      tooltipTrigger = _renderHelper$default.tooltipTrigger;\n    var _layoutObserver$defau = layoutObserver[\"default\"](parent),\n      onColumnsChange = _layoutObserver$defau.onColumnsChange,\n      onScrollableChange = _layoutObserver$defau.onScrollableChange;\n    var hoveredCellList = [];\n    vue.watch(props.store.states.hoverRow, function (newVal, oldVal) {\n      var _a;\n      var el = instance == null ? void 0 : instance.vnode.el;\n      var rows = Array.from((el == null ? void 0 : el.children) || []).filter(function (e) {\n        return e == null ? void 0 : e.classList.contains(\"\".concat(ns.e(\"row\")));\n      });\n      var rowNum = newVal;\n      var childNodes = (_a = rows[rowNum]) == null ? void 0 : _a.childNodes;\n      if (childNodes == null ? void 0 : childNodes.length) {\n        var control = 0;\n        var indexes = Array.from(childNodes).reduce(function (acc, item, index) {\n          var _a2, _b;\n          if (((_a2 = childNodes[index]) == null ? void 0 : _a2.colSpan) > 1) {\n            control = (_b = childNodes[index]) == null ? void 0 : _b.colSpan;\n          }\n          if (item.nodeName !== \"TD\" && control === 0) {\n            acc.push(index);\n          }\n          control > 0 && control--;\n          return acc;\n        }, []);\n        indexes.forEach(function (rowIndex) {\n          var _a2;\n          rowNum = newVal;\n          while (rowNum > 0) {\n            var preChildNodes = (_a2 = rows[rowNum - 1]) == null ? void 0 : _a2.childNodes;\n            if (preChildNodes[rowIndex] && preChildNodes[rowIndex].nodeName === \"TD\" && preChildNodes[rowIndex].rowSpan > 1) {\n              style.addClass(preChildNodes[rowIndex], \"hover-cell\");\n              hoveredCellList.push(preChildNodes[rowIndex]);\n              break;\n            }\n            rowNum--;\n          }\n        });\n      } else {\n        hoveredCellList.forEach(function (item) {\n          return style.removeClass(item, \"hover-cell\");\n        });\n        hoveredCellList.length = 0;\n      }\n      if (!props.store.states.isComplex.value || !core.isClient) return;\n      raf.rAF(function () {\n        var oldRow = rows[oldVal];\n        var newRow = rows[newVal];\n        if (oldRow && !oldRow.classList.contains(\"hover-fixed-row\")) {\n          style.removeClass(oldRow, \"hover-row\");\n        }\n        if (newRow) {\n          style.addClass(newRow, \"hover-row\");\n        }\n      });\n    });\n    vue.onUnmounted(function () {\n      var _a;\n      (_a = util.removePopper) == null ? void 0 : _a();\n    });\n    return {\n      ns: ns,\n      onColumnsChange: onColumnsChange,\n      onScrollableChange: onScrollableChange,\n      wrappedRowRender: wrappedRowRender,\n      tooltipContent: tooltipContent,\n      tooltipTrigger: tooltipTrigger\n    };\n  },\n  render: function render() {\n    var wrappedRowRender = this.wrappedRowRender,\n      store = this.store;\n    var data = store.states.data.value || [];\n    return vue.h(\"tbody\", {\n      tabIndex: -1\n    }, [data.reduce(function (acc, row) {\n      return acc.concat(wrappedRowRender(row, acc.length));\n    }, [])]);\n  }\n});\nexports[\"default\"] = TableBody;","map":{"version":3,"names":["TableBody","vue","defineComponent","name","props","defaults","setup","instance","getCurrentInstance","parent","inject","tokens","TABLE_INJECTION_KEY","ns","index","useNamespace","_renderHelper$default","renderHelper","wrappedRowRender","tooltipContent","tooltipTrigger","_layoutObserver$defau","layoutObserver","onColumnsChange","onScrollableChange","hoveredCellList","watch","store","states","hoverRow","newVal","oldVal","_a","el","vnode","rows","Array","from","children","filter","e","classList","contains","concat","rowNum","childNodes","length","control","indexes","reduce","acc","item","_a2","_b","colSpan","nodeName","push","forEach","rowIndex","preChildNodes","rowSpan","style","addClass","removeClass","isComplex","value","core","isClient","raf","rAF","oldRow","newRow","onUnmounted","util","removePopper","render","data","h","tabIndex","row"],"sources":["../../../../../../../packages/components/table/src/table-body/index.ts"],"sourcesContent":["// @ts-nocheck\nimport {\n  defineComponent,\n  getCurrentInstance,\n  h,\n  inject,\n  onUnmounted,\n  watch,\n} from 'vue'\nimport { addClass, isClient, rAF, removeClass } from '@element-plus/utils'\nimport { useNamespace } from '@element-plus/hooks'\nimport useLayoutObserver from '../layout-observer'\nimport { removePopper } from '../util'\nimport { TABLE_INJECTION_KEY } from '../tokens'\nimport useRender from './render-helper'\nimport defaultProps from './defaults'\n\nimport type { VNode } from 'vue'\n\nexport default defineComponent({\n  name: 'ElTableBody',\n  props: defaultProps,\n  setup(props) {\n    const instance = getCurrentInstance()\n    const parent = inject(TABLE_INJECTION_KEY)\n    const ns = useNamespace('table')\n    const { wrappedRowRender, tooltipContent, tooltipTrigger } =\n      useRender(props)\n    const { onColumnsChange, onScrollableChange } = useLayoutObserver(parent!)\n\n    const hoveredCellList = []\n    watch(props.store.states.hoverRow, (newVal: any, oldVal: any) => {\n      const el = instance?.vnode.el as HTMLElement\n      const rows = Array.from(el?.children || []).filter((e) =>\n        e?.classList.contains(`${ns.e('row')}`)\n      )\n\n      // hover rowSpan > 1 choose the whole row\n      let rowNum = newVal\n      const childNodes = rows[rowNum]?.childNodes\n      if (childNodes?.length) {\n        let control = 0\n        const indexes = Array.from(childNodes).reduce((acc, item, index) => {\n          // drop colsSpan\n          if (childNodes[index]?.colSpan > 1) {\n            control = childNodes[index]?.colSpan\n          }\n          if (item.nodeName !== 'TD' && control === 0) {\n            acc.push(index)\n          }\n          control > 0 && control--\n          return acc\n        }, [])\n\n        indexes.forEach((rowIndex) => {\n          rowNum = newVal\n          while (rowNum > 0) {\n            // find from previous\n            const preChildNodes = rows[rowNum - 1]?.childNodes\n            if (\n              preChildNodes[rowIndex] &&\n              preChildNodes[rowIndex].nodeName === 'TD' &&\n              preChildNodes[rowIndex].rowSpan > 1\n            ) {\n              addClass(preChildNodes[rowIndex], 'hover-cell')\n              hoveredCellList.push(preChildNodes[rowIndex])\n              break\n            }\n            rowNum--\n          }\n        })\n      } else {\n        hoveredCellList.forEach((item) => removeClass(item, 'hover-cell'))\n        hoveredCellList.length = 0\n      }\n      if (!props.store.states.isComplex.value || !isClient) return\n\n      rAF(() => {\n        // just get first level children; fix #9723\n        const oldRow = rows[oldVal]\n        const newRow = rows[newVal]\n        // when there is fixed row, hover on rowSpan > 1 should not clear the class\n        if (oldRow && !oldRow.classList.contains('hover-fixed-row')) {\n          removeClass(oldRow, 'hover-row')\n        }\n        if (newRow) {\n          addClass(newRow, 'hover-row')\n        }\n      })\n    })\n\n    onUnmounted(() => {\n      removePopper?.()\n    })\n\n    return {\n      ns,\n      onColumnsChange,\n      onScrollableChange,\n      wrappedRowRender,\n      tooltipContent,\n      tooltipTrigger,\n    }\n  },\n  render() {\n    const { wrappedRowRender, store } = this\n    const data = store.states.data.value || []\n    // Why do we need tabIndex: -1 ?\n    // If you set the tabindex attribute on an element ,\n    // then its child content cannot be scrolled with the arrow keys,\n    // unless you set tabindex on the content too\n    // See https://github.com/facebook/react/issues/25462#issuecomment-1274775248 or https://developer.mozilla.org/zh-CN/docs/Web/HTML/Global_attributes/tabindex\n    return h('tbody', { tabIndex: -1 }, [\n      data.reduce((acc: VNode[], row) => {\n        return acc.concat(wrappedRowRender(row, acc.length))\n      }, []),\n    ])\n  },\n})\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}