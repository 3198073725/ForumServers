{"ast":null,"code":"'use strict';\n\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/web.timers.js\");\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar index = require('../use-namespace/index.js');\nvar error = require('../../utils/error.js');\nvar core = require('@vueuse/core');\nvar style = require('../../utils/dom/style.js');\nvar scroll = require('../../utils/dom/scroll.js');\nvar useLockscreen = function useLockscreen(trigger) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  if (!vue.isRef(trigger)) {\n    error.throwError(\"[useLockscreen]\", \"You need to pass a ref param to this function\");\n  }\n  var ns = options.ns || index.useNamespace(\"popup\");\n  var hiddenCls = vue.computed(function () {\n    return ns.bm(\"parent\", \"hidden\");\n  });\n  if (!core.isClient || style.hasClass(document.body, hiddenCls.value)) {\n    return;\n  }\n  var scrollBarWidth = 0;\n  var withoutHiddenClass = false;\n  var bodyWidth = \"0\";\n  var cleanup = function cleanup() {\n    setTimeout(function () {\n      if (typeof document === \"undefined\") return;\n      if (withoutHiddenClass && document) {\n        document.body.style.width = bodyWidth;\n        style.removeClass(document.body, hiddenCls.value);\n      }\n    }, 200);\n  };\n  vue.watch(trigger, function (val) {\n    if (!val) {\n      cleanup();\n      return;\n    }\n    withoutHiddenClass = !style.hasClass(document.body, hiddenCls.value);\n    if (withoutHiddenClass) {\n      bodyWidth = document.body.style.width;\n      style.addClass(document.body, hiddenCls.value);\n    }\n    scrollBarWidth = scroll.getScrollBarWidth(ns.namespace.value);\n    var bodyHasOverflow = document.documentElement.clientHeight < document.body.scrollHeight;\n    var bodyOverflowY = style.getStyle(document.body, \"overflowY\");\n    if (scrollBarWidth > 0 && (bodyHasOverflow || bodyOverflowY === \"scroll\") && withoutHiddenClass) {\n      document.body.style.width = \"calc(100% - \".concat(scrollBarWidth, \"px)\");\n    }\n  });\n  vue.onScopeDispose(function () {\n    return cleanup();\n  });\n};\nexports.useLockscreen = useLockscreen;","map":{"version":3,"names":["useLockscreen","trigger","options","arguments","length","undefined","vue","isRef","error","throwError","ns","index","useNamespace","hiddenCls","computed","bm","core","isClient","style","hasClass","document","body","value","scrollBarWidth","withoutHiddenClass","bodyWidth","cleanup","setTimeout","width","removeClass","watch","val","addClass","scroll","getScrollBarWidth","namespace","bodyHasOverflow","documentElement","clientHeight","scrollHeight","bodyOverflowY","getStyle","concat","onScopeDispose"],"sources":["../../../../../packages/hooks/use-lockscreen/index.ts"],"sourcesContent":["import { computed, isRef, onScopeDispose, watch } from 'vue'\nimport {\n  addClass,\n  getScrollBarWidth,\n  getStyle,\n  hasClass,\n  isClient,\n  removeClass,\n  throwError,\n} from '@element-plus/utils'\nimport { useNamespace } from '../use-namespace'\n\nimport type { Ref } from 'vue'\nimport type { UseNamespaceReturn } from '../use-namespace'\n\nexport type UseLockScreenOptions = {\n  ns?: UseNamespaceReturn\n  // shouldLock?: MaybeRef<boolean>\n}\n\n/**\n * Hook that monitoring the ref value to lock or unlock the screen.\n * When the trigger became true, it assumes modal is now opened and vice versa.\n * @param trigger {Ref<boolean>}\n */\nexport const useLockscreen = (\n  trigger: Ref<boolean>,\n  options: UseLockScreenOptions = {}\n) => {\n  if (!isRef(trigger)) {\n    throwError(\n      '[useLockscreen]',\n      'You need to pass a ref param to this function'\n    )\n  }\n\n  const ns = options.ns || useNamespace('popup')\n\n  const hiddenCls = computed(() => ns.bm('parent', 'hidden'))\n\n  if (!isClient || hasClass(document.body, hiddenCls.value)) {\n    return\n  }\n\n  let scrollBarWidth = 0\n  let withoutHiddenClass = false\n  let bodyWidth = '0'\n\n  const cleanup = () => {\n    setTimeout(() => {\n      // When the test case is running, the context environment simulated by jsdom may have been destroyed,\n      // and the document does not exist at this time.\n      if (typeof document === 'undefined') return\n      if (withoutHiddenClass && document) {\n        document.body.style.width = bodyWidth\n        removeClass(document.body, hiddenCls.value)\n      }\n    }, 200)\n  }\n  watch(trigger, (val) => {\n    if (!val) {\n      cleanup()\n      return\n    }\n\n    withoutHiddenClass = !hasClass(document.body, hiddenCls.value)\n    if (withoutHiddenClass) {\n      bodyWidth = document.body.style.width\n      addClass(document.body, hiddenCls.value)\n    }\n    scrollBarWidth = getScrollBarWidth(ns.namespace.value)\n    const bodyHasOverflow =\n      document.documentElement.clientHeight < document.body.scrollHeight\n    const bodyOverflowY = getStyle(document.body, 'overflowY')\n    if (\n      scrollBarWidth > 0 &&\n      (bodyHasOverflow || bodyOverflowY === 'scroll') &&\n      withoutHiddenClass\n    ) {\n      document.body.style.width = `calc(100% - ${scrollBarWidth}px)`\n    }\n  })\n  onScopeDispose(() => cleanup())\n}\n"],"mappings":";;;;;;;;;;;;;AAWY,IAACA,aAAa,GAAG,SAAhBA,aAAaA,CAAIC,OAAO,EAAmB;EAAA,IAAjBC,OAAO,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,EAAE;EACjD,IAAI,CAACG,GAAA,CAAAC,KAAK,CAACN,OAAO,CAAC,EAAE;IACnBO,KAAA,CAAAC,UAAU,CAAC,iBAAiB,EAAE,+CAA+C,CAAC;EAClF;EACE,IAAMC,EAAE,GAAGR,OAAO,CAACQ,EAAE,IAAIC,KAAA,CAAAC,YAAY,CAAC,OAAO,CAAC;EAC9C,IAAMC,SAAS,GAAGP,GAAA,CAAAQ,QAAQ,CAAC;IAAA,OAAMJ,EAAE,CAACK,EAAE,CAAC,QAAQ,EAAE,QAAQ,CAAC;EAAA,EAAC;EAC3D,IAAI,CAACC,IAAA,CAAAC,QAAQ,IAAIC,KAAA,CAAAC,QAAQ,CAACC,QAAQ,CAACC,IAAI,EAAER,SAAS,CAACS,KAAK,CAAC,EAAE;IACzD;EACJ;EACE,IAAIC,cAAc,GAAG,CAAC;EACtB,IAAIC,kBAAkB,GAAG,KAAK;EAC9B,IAAIC,SAAS,GAAG,GAAG;EACnB,IAAMC,OAAO,GAAG,SAAVA,OAAOA,CAAA,EAAS;IACpBC,UAAU,CAAC,YAAM;MACf,IAAI,OAAOP,QAAQ,KAAK,WAAW,EACjC;MACF,IAAII,kBAAkB,IAAIJ,QAAQ,EAAE;QAClCA,QAAQ,CAACC,IAAI,CAACH,KAAK,CAACU,KAAK,GAAGH,SAAS;QACrCP,KAAA,CAAAW,WAAW,CAACT,QAAQ,CAACC,IAAI,EAAER,SAAS,CAACS,KAAK,CAAC;MACnD;IACA,CAAK,EAAE,GAAG,CAAC;EACX,CAAG;EACDhB,GAAA,CAAAwB,KAAK,CAAC7B,OAAO,EAAE,UAAC8B,GAAG,EAAK;IACtB,IAAI,CAACA,GAAG,EAAE;MACRL,OAAO,EAAE;MACT;IACN;IACIF,kBAAkB,GAAG,CAACN,KAAA,CAAAC,QAAQ,CAACC,QAAQ,CAACC,IAAI,EAAER,SAAS,CAACS,KAAK,CAAC;IAC9D,IAAIE,kBAAkB,EAAE;MACtBC,SAAS,GAAGL,QAAQ,CAACC,IAAI,CAACH,KAAK,CAACU,KAAK;MACrCV,KAAA,CAAAc,QAAQ,CAACZ,QAAQ,CAACC,IAAI,EAAER,SAAS,CAACS,KAAK,CAAC;IAC9C;IACIC,cAAc,GAAGU,MAAA,CAAAC,iBAAiB,CAACxB,EAAE,CAACyB,SAAS,CAACb,KAAK,CAAC;IACtD,IAAMc,eAAe,GAAGhB,QAAQ,CAACiB,eAAe,CAACC,YAAY,GAAGlB,QAAQ,CAACC,IAAI,CAACkB,YAAY;IAC1F,IAAMC,aAAa,GAAGtB,KAAA,CAAAuB,QAAQ,CAACrB,QAAQ,CAACC,IAAI,EAAE,WAAW,CAAC;IAC1D,IAAIE,cAAc,GAAG,CAAC,KAAKa,eAAe,IAAII,aAAa,KAAK,QAAQ,CAAC,IAAIhB,kBAAkB,EAAE;MAC/FJ,QAAQ,CAACC,IAAI,CAACH,KAAK,CAACU,KAAK,kBAAAc,MAAA,CAAkBnB,cAAc,QAAK;IACpE;EACA,CAAG,CAAC;EACFjB,GAAA,CAAAqC,cAAc,CAAC;IAAA,OAAMjB,OAAO,EAAE;EAAA,EAAC;AACjC","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}