{"ast":null,"code":"import _objectSpread from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport { ref, watch, onMounted } from 'vue';\nimport { QuillEditor } from '@vueup/vue-quill';\nimport '@vueup/vue-quill/dist/vue-quill.snow.css';\nimport { defaultQuillOptions } from '@/utils/quill-config';\n\n// 是否启用调试日志\nvar DEBUG = false;\n\n// 自定义日志函数，可以通过DEBUG开关控制\nvar log = function log() {\n  if (DEBUG) {\n    var _console;\n    (_console = console).log.apply(_console, arguments);\n  }\n};\nexport default {\n  name: 'RichTextEditor',\n  components: {\n    QuillEditor: QuillEditor\n  },\n  props: {\n    modelValue: {\n      type: String,\n      \"default\": ''\n    },\n    disabled: {\n      type: Boolean,\n      \"default\": false\n    }\n  },\n  emits: ['update:modelValue', 'change'],\n  setup: function setup(props, _ref) {\n    var emit = _ref.emit;\n    var content = ref(props.modelValue || '');\n    var quillEditor = ref(null);\n    var handleContentUpdate = function handleContentUpdate(newContent) {\n      log('RichTextEditor - handleContentUpdate:', newContent);\n      if (quillEditor.value && quillEditor.value.getQuill) {\n        var quill = quillEditor.value.getQuill();\n        var text = quill.getText().trim();\n        var html = quill.root.innerHTML;\n        log('RichTextEditor - 内容更新:', {\n          html: html,\n          text: text,\n          isEmpty: !text\n        });\n        if (!text || text === '\\n') {\n          content.value = '';\n          emit('update:modelValue', '');\n          emit('change', '');\n        } else {\n          content.value = html;\n          emit('update:modelValue', html);\n          emit('change', html);\n        }\n      }\n    };\n    var handleBlur = function handleBlur() {\n      if (quillEditor.value && quillEditor.value.getQuill) {\n        var quill = quillEditor.value.getQuill();\n        var text = quill.getText().trim();\n        var html = quill.root.innerHTML;\n        log('RichTextEditor - 失去焦点:', {\n          html: html,\n          text: text,\n          isEmpty: !text\n        });\n        if (!text || text === '\\n') {\n          content.value = '';\n          emit('update:modelValue', '');\n          emit('change', '');\n        } else if (html !== content.value) {\n          content.value = html;\n          emit('update:modelValue', html);\n          emit('change', html);\n        }\n      }\n    };\n\n    // 监听 modelValue 变化\n    watch(function () {\n      return props.modelValue;\n    }, function (newValue, oldValue) {\n      log('RichTextEditor - modelValue变化:', {\n        newValue: newValue,\n        oldValue: oldValue,\n        contentValue: content.value\n      });\n      if (newValue !== content.value) {\n        content.value = newValue || '';\n\n        // 如果编辑器已经初始化，手动更新内容\n        if (quillEditor.value && quillEditor.value.getQuill) {\n          log('手动更新Quill编辑器内容');\n          var quill = quillEditor.value.getQuill();\n          if (quill) {\n            // 清空当前内容\n            quill.setText('');\n            // 设置新内容（如果是HTML格式）\n            if (newValue && newValue.trim()) {\n              quill.clipboard.dangerouslyPasteHTML(0, newValue);\n            }\n          }\n        }\n      }\n    }, {\n      immediate: true\n    });\n    onMounted(function () {\n      log('RichTextEditor - 组件挂载，初始值:', props.modelValue);\n\n      // 初始化时设置内容\n      if (quillEditor.value) {\n        log('RichTextEditor - 设置初始内容');\n        try {\n          var quill = quillEditor.value.getQuill();\n          if (quill) {\n            // 确保使用现代 API\n            Object.assign(quill.options, {\n              experimental: {\n                useModernScrollingApi: true,\n                useMutationObserver: true\n              }\n            });\n\n            // 清空当前内容\n            quill.setText('');\n            // 设置新内容（如果是HTML格式）\n            if (props.modelValue && props.modelValue.trim()) {\n              quill.clipboard.dangerouslyPasteHTML(0, props.modelValue);\n              content.value = props.modelValue;\n              log('RichTextEditor - 初始内容设置成功');\n            }\n          }\n        } catch (error) {\n          console.error('RichTextEditor - 设置初始内容失败:', error);\n        }\n      }\n    });\n    return {\n      content: content,\n      editorOption: _objectSpread(_objectSpread({}, defaultQuillOptions), {}, {\n        readOnly: props.disabled\n      }),\n      handleContentUpdate: handleContentUpdate,\n      handleBlur: handleBlur,\n      quillEditor: quillEditor\n    };\n  }\n};","map":{"version":3,"names":["ref","watch","onMounted","QuillEditor","defaultQuillOptions","DEBUG","log","_console","console","apply","arguments","name","components","props","modelValue","type","String","disabled","Boolean","emits","setup","_ref","emit","content","quillEditor","handleContentUpdate","newContent","value","getQuill","quill","text","getText","trim","html","root","innerHTML","isEmpty","handleBlur","newValue","oldValue","contentValue","setText","clipboard","dangerouslyPasteHTML","immediate","Object","assign","options","experimental","useModernScrollingApi","useMutationObserver","error","editorOption","_objectSpread","readOnly"],"sources":["H:\\ForumServers\\ForumFrontend\\src\\components\\RichTextEditor.vue"],"sourcesContent":["<template>\n  <div class=\"rich-text-editor\">\n    <quill-editor\n      v-model=\"content\"\n      :options=\"editorOption\"\n      @update:content=\"handleContentUpdate\"\n      @blur=\"handleBlur\"\n      :disabled=\"disabled\"\n      ref=\"quillEditor\"\n    />\n  </div>\n</template>\n\n<script>\nimport { ref, watch, onMounted } from 'vue'\nimport { QuillEditor } from '@vueup/vue-quill'\nimport '@vueup/vue-quill/dist/vue-quill.snow.css'\nimport { defaultQuillOptions } from '@/utils/quill-config'\n\n// 是否启用调试日志\nconst DEBUG = false;\n\n// 自定义日志函数，可以通过DEBUG开关控制\nconst log = (...args) => {\n  if (DEBUG) {\n    console.log(...args);\n  }\n};\n\nexport default {\n  name: 'RichTextEditor',\n  components: {\n    QuillEditor\n  },\n  props: {\n    modelValue: {\n      type: String,\n      default: ''\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: ['update:modelValue', 'change'],\n  setup(props, { emit }) {\n    const content = ref(props.modelValue || '')\n    const quillEditor = ref(null)\n\n    const handleContentUpdate = (newContent) => {\n      log('RichTextEditor - handleContentUpdate:', newContent);\n      \n      if (quillEditor.value && quillEditor.value.getQuill) {\n        const quill = quillEditor.value.getQuill();\n        const text = quill.getText().trim();\n        const html = quill.root.innerHTML;\n        \n        log('RichTextEditor - 内容更新:', {\n          html: html,\n          text: text,\n          isEmpty: !text\n        });\n\n        if (!text || text === '\\n') {\n          content.value = '';\n          emit('update:modelValue', '');\n          emit('change', '');\n        } else {\n          content.value = html;\n          emit('update:modelValue', html);\n          emit('change', html);\n        }\n      }\n    }\n\n    const handleBlur = () => {\n      if (quillEditor.value && quillEditor.value.getQuill) {\n        const quill = quillEditor.value.getQuill();\n        const text = quill.getText().trim();\n        const html = quill.root.innerHTML;\n        \n        log('RichTextEditor - 失去焦点:', {\n          html: html,\n          text: text,\n          isEmpty: !text\n        });\n\n        if (!text || text === '\\n') {\n          content.value = '';\n          emit('update:modelValue', '');\n          emit('change', '');\n        } else if (html !== content.value) {\n          content.value = html;\n          emit('update:modelValue', html);\n          emit('change', html);\n        }\n      }\n    }\n\n    // 监听 modelValue 变化\n    watch(() => props.modelValue, (newValue, oldValue) => {\n      log('RichTextEditor - modelValue变化:', { \n        newValue, \n        oldValue, \n        contentValue: content.value \n      });\n      \n      if (newValue !== content.value) {\n        content.value = newValue || '';\n        \n        // 如果编辑器已经初始化，手动更新内容\n        if (quillEditor.value && quillEditor.value.getQuill) {\n          log('手动更新Quill编辑器内容');\n          const quill = quillEditor.value.getQuill();\n          if (quill) {\n            // 清空当前内容\n            quill.setText('');\n            // 设置新内容（如果是HTML格式）\n            if (newValue && newValue.trim()) {\n              quill.clipboard.dangerouslyPasteHTML(0, newValue);\n            }\n          }\n        }\n      }\n    }, { immediate: true })\n\n    onMounted(() => {\n      log('RichTextEditor - 组件挂载，初始值:', props.modelValue);\n      \n      // 初始化时设置内容\n      if (quillEditor.value) {\n        log('RichTextEditor - 设置初始内容');\n        \n        try {\n          const quill = quillEditor.value.getQuill();\n          if (quill) {\n            // 确保使用现代 API\n            Object.assign(quill.options, {\n              experimental: {\n                useModernScrollingApi: true,\n                useMutationObserver: true\n              }\n            });\n\n            // 清空当前内容\n            quill.setText('');\n            // 设置新内容（如果是HTML格式）\n            if (props.modelValue && props.modelValue.trim()) {\n              quill.clipboard.dangerouslyPasteHTML(0, props.modelValue);\n              content.value = props.modelValue;\n              log('RichTextEditor - 初始内容设置成功');\n            }\n          }\n        } catch (error) {\n          console.error('RichTextEditor - 设置初始内容失败:', error);\n        }\n      }\n    })\n\n    return {\n      content,\n      editorOption: {\n        ...defaultQuillOptions,\n        readOnly: props.disabled\n      },\n      handleContentUpdate,\n      handleBlur,\n      quillEditor\n    }\n  }\n}\n</script>\n\n<style scoped>\n.rich-text-editor {\n  width: 100%;\n}\n\n:deep(.ql-container) {\n  min-height: 300px;\n  font-size: 16px;\n  line-height: 1.5;\n}\n\n:deep(.ql-editor) {\n  min-height: 300px;\n  padding: 12px 15px;\n}\n\n:deep(.ql-toolbar) {\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  background-color: #f8f9fa;\n}\n\n:deep(.ql-container) {\n  border-bottom-left-radius: 4px;\n  border-bottom-right-radius: 4px;\n}\n\n:deep(.ql-editor p) {\n  margin-bottom: 1em;\n}\n\n:deep(.ql-editor img) {\n  max-width: 100%;\n  height: auto;\n}\n\n:deep(.ql-editor blockquote) {\n  border-left: 4px solid #ccc;\n  margin: 0;\n  padding-left: 16px;\n}\n\n:deep(.ql-editor pre.ql-syntax) {\n  background-color: #f8f9fa;\n  border-radius: 4px;\n  padding: 12px;\n  margin: 8px 0;\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}