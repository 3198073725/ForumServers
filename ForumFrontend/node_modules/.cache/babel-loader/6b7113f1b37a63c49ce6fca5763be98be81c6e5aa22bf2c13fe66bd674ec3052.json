{"ast":null,"code":"import _classCallCheck from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.date.to-json.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.object.values.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport ReconnectingWebSocket from 'reconnecting-websocket';\nimport store from '@/store';\nimport { ElMessage } from 'element-plus';\n\n// WebSocket基础URL\nvar WS_BASE_URL = process.env.NODE_ENV === 'production' ? 'wss://yourserver.com/ws' : 'ws://localhost:8001/ws';\n\n/**\n * WebSocket管理类\n */\nvar WebSocketManager = /*#__PURE__*/function () {\n  function WebSocketManager() {\n    _classCallCheck(this, WebSocketManager);\n    this.notificationSocket = null;\n    this.chatSockets = {}; // 存储与不同用户的聊天WebSocket连接\n    this.token = null;\n  }\n\n  /**\n   * 初始化WebSocket连接\n   * @param {string} token - JWT令牌\n   */\n  return _createClass(WebSocketManager, [{\n    key: \"init\",\n    value: function init(token) {\n      var _this = this;\n      this.token = token;\n      if (!token) {\n        console.log('没有令牌，尝试从localStorage获取');\n        this.token = localStorage.getItem('token');\n        if (!this.token) {\n          console.log('无法获取令牌，不建立WebSocket连接');\n          return;\n        }\n      }\n\n      // 检查后端是否支持通知功能\n      fetch('http://localhost:8001/api/v1/notifications/', {\n        headers: {\n          'Authorization': \"Bearer \".concat(this.token)\n        }\n      }).then(function (response) {\n        // 如果通知接口存在，则连接WebSocket\n        if (response.status !== 404) {\n          _this.connectNotification(_this.token);\n        } else {\n          console.log('通知接口不可用，不建立WebSocket连接');\n        }\n      })[\"catch\"](function (error) {\n        console.error('检查通知接口可用性失败:', error);\n      });\n    }\n\n    /**\n     * 连接到通知WebSocket\n     * @param {string} token - JWT令牌\n     */\n  }, {\n    key: \"connectNotification\",\n    value: function connectNotification(token) {\n      if (this.notificationSocket) {\n        this.notificationSocket.close();\n        this.notificationSocket = null;\n      }\n\n      // 如果已经禁用了WebSocket功能，则不再尝试连接\n      if (window.webSocketEnabled === false) {\n        console.log('WebSocket功能已被禁用，不再尝试连接');\n        return;\n      }\n      try {\n        // 从Bearer token中提取实际的token\n        var rawToken = token.replace('Bearer ', '');\n\n        // 创建通知WebSocket连接\n        this.notificationSocket = new ReconnectingWebSocket(\"\".concat(WS_BASE_URL, \"/notifications/?token=\").concat(encodeURIComponent(rawToken)), [], {\n          connectionTimeout: 5000,\n          maxRetries: 10,\n          maxReconnectionDelay: 5000,\n          minReconnectionDelay: 1000,\n          debug: true,\n          // 添加WebSocket选项\n          wsOptions: {\n            origin: window.location.origin\n          }\n        });\n\n        // 连接打开时的处理\n        this.notificationSocket.onopen = function () {\n          console.log('通知WebSocket连接已建立');\n        };\n\n        // 接收消息的处理\n        this.notificationSocket.onmessage = function (event) {\n          try {\n            var data = JSON.parse(event.data);\n            switch (data.type) {\n              case 'connection_established':\n                console.log(data.message);\n                break;\n              case 'unread_count':\n                // 更新未读通知数量\n                store.commit('notifications/setUnreadCount', data.count);\n                break;\n              case 'notification':\n                // 处理新通知\n                store.commit('notifications/addNotification', data);\n                store.commit('notifications/incrementUnreadCount');\n\n                // 显示通知提示\n                ElMessage({\n                  message: data.title,\n                  type: 'info',\n                  duration: 3000\n                });\n                break;\n              case 'mark_read_response':\n              case 'mark_all_read_response':\n                // 标记通知已读的响应处理\n                break;\n              default:\n                console.log('未知的通知类型:', data.type);\n            }\n          } catch (error) {\n            console.error('解析通知消息失败:', error);\n          }\n        };\n\n        // 连接关闭时的处理\n        this.notificationSocket.onclose = function () {\n          console.log('通知WebSocket连接已关闭');\n        };\n\n        // 连接错误时的处理\n        this.notificationSocket.onerror = function (error) {\n          console.error('通知WebSocket连接错误:', error);\n          // 连接错误时，设置全局标志，避免反复尝试连接\n          window.webSocketEnabled = false;\n        };\n      } catch (error) {\n        console.error('创建通知WebSocket连接失败:', error);\n      }\n    }\n\n    /**\n     * 连接到聊天WebSocket\n     * @param {number} userId - 对方用户ID\n     */\n  }, {\n    key: \"connectChat\",\n    value: function connectChat(userId) {\n      var _this2 = this;\n      if (!this.token) {\n        console.error('未登录，无法建立聊天连接');\n        return;\n      }\n\n      // 如果已存在与该用户的连接，则返回\n      if (this.chatSockets[userId]) {\n        return;\n      }\n\n      // 从Bearer token中提取实际的token\n      var rawToken = this.token.replace('Bearer ', '');\n\n      // 创建聊天WebSocket连接，使用URL参数传递token\n      var chatSocket = new ReconnectingWebSocket(\"\".concat(WS_BASE_URL, \"/chat/\").concat(userId, \"?token=\").concat(encodeURIComponent(rawToken)), [], {\n        connectionTimeout: 5000,\n        maxRetries: 10,\n        maxReconnectionDelay: 5000,\n        minReconnectionDelay: 1000,\n        debug: true,\n        // 添加WebSocket选项\n        wsOptions: {\n          origin: window.location.origin\n        }\n      });\n\n      // 连接打开时的处理\n      chatSocket.onopen = function () {\n        console.log(\"\\u4E0E\\u7528\\u6237\".concat(userId, \"\\u7684\\u804A\\u5929WebSocket\\u8FDE\\u63A5\\u5DF2\\u5EFA\\u7ACB\"));\n      };\n\n      // 接收消息的处理\n      chatSocket.onmessage = function (event) {\n        try {\n          var data = JSON.parse(event.data);\n          switch (data.type) {\n            case 'connection_established':\n              console.log(data.message);\n              break;\n            case 'chat_message':\n              // 处理聊天消息，添加去重逻辑\n              if (!store.getters['chat/hasMessage'](data.id)) {\n                store.commit('chat/addMessage', {\n                  userId: data.sender_id === store.state.user.currentUser.id ? data.receiver_id : data.sender_id,\n                  message: {\n                    id: data.id,\n                    senderId: data.sender_id,\n                    receiverId: data.receiver_id,\n                    content: data.content,\n                    timestamp: data.timestamp,\n                    isRead: data.is_read\n                  }\n                });\n              }\n              break;\n            case 'history_messages':\n              // 处理历史消息\n              store.commit('chat/setMessages', {\n                userId: userId,\n                messages: data.messages.map(function (msg) {\n                  return {\n                    id: msg.id,\n                    senderId: msg.sender_id,\n                    receiverId: msg.receiver_id,\n                    content: msg.content,\n                    timestamp: msg.timestamp,\n                    isRead: msg.is_read\n                  };\n                }),\n                hasMore: data.has_more,\n                page: data.page\n              });\n              break;\n            default:\n              console.log('未知的聊天消息类型:', data.type);\n          }\n        } catch (error) {\n          console.error('解析聊天消息失败:', error);\n        }\n      };\n\n      // 连接关闭时的处理\n      chatSocket.onclose = function (event) {\n        console.log(\"\\u4E0E\\u7528\\u6237\".concat(userId, \"\\u7684\\u804A\\u5929WebSocket\\u8FDE\\u63A5\\u5DF2\\u5173\\u95ED\"));\n        delete _this2.chatSockets[userId];\n\n        // 处理特定的关闭代码\n        switch (event.code) {\n          case 4001:\n            console.error('WebSocket连接失败：未提供token');\n            break;\n          case 4002:\n            console.error('WebSocket连接失败：用户不存在');\n            break;\n          case 4003:\n            console.error('WebSocket连接失败：token无效');\n            // 可能需要触发重新登录\n            store.dispatch('auth/logout');\n            break;\n          default:\n            if (event.code !== 1000) {\n              // 1000是正常关闭\n              console.error(\"WebSocket\\u8FDE\\u63A5\\u5F02\\u5E38\\u5173\\u95ED\\uFF0C\\u4EE3\\u7801\\uFF1A\".concat(event.code));\n            }\n        }\n      };\n\n      // 连接错误时的处理\n      chatSocket.onerror = function (error) {\n        console.error(\"\\u4E0E\\u7528\\u6237\".concat(userId, \"\\u7684\\u804A\\u5929WebSocket\\u8FDE\\u63A5\\u9519\\u8BEF:\"), error);\n      };\n\n      // 保存连接\n      this.chatSockets[userId] = chatSocket;\n    }\n\n    /**\n     * 断开与用户的聊天连接\n     * @param {number} userId - 用户ID\n     */\n  }, {\n    key: \"disconnectChat\",\n    value: function disconnectChat(userId) {\n      if (this.chatSockets[userId]) {\n        this.chatSockets[userId].close();\n        delete this.chatSockets[userId];\n      }\n    }\n\n    /**\n     * 发送聊天消息\n     * @param {number} userId - 接收者ID\n     * @param {string} content - 消息内容\n     */\n  }, {\n    key: \"sendChatMessage\",\n    value: function sendChatMessage(userId, content) {\n      if (!this.chatSockets[userId]) {\n        this.connectChat(userId);\n      }\n      this.chatSockets[userId].send(JSON.stringify({\n        type: 'chat_message',\n        content: content\n      }));\n    }\n\n    /**\n     * 加载历史消息\n     * @param {number} userId - 用户ID\n     * @param {number} page - 页码\n     * @param {number} pageSize - 每页大小\n     */\n  }, {\n    key: \"loadChatHistory\",\n    value: function loadChatHistory(userId) {\n      var page = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n      var pageSize = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 20;\n      if (!this.chatSockets[userId]) {\n        this.connectChat(userId);\n      }\n      this.chatSockets[userId].send(JSON.stringify({\n        type: 'load_history',\n        page: page,\n        page_size: pageSize\n      }));\n    }\n\n    /**\n     * 标记通知为已读\n     * @param {number} notificationId - 通知ID\n     */\n  }, {\n    key: \"markNotificationRead\",\n    value: function markNotificationRead(notificationId) {\n      if (this.notificationSocket && this.notificationSocket.readyState === WebSocket.OPEN) {\n        this.notificationSocket.send(JSON.stringify({\n          type: 'mark_read',\n          id: notificationId\n        }));\n      }\n    }\n\n    /**\n     * 标记所有通知为已读\n     */\n  }, {\n    key: \"markAllNotificationsRead\",\n    value: function markAllNotificationsRead() {\n      if (this.notificationSocket && this.notificationSocket.readyState === WebSocket.OPEN) {\n        this.notificationSocket.send(JSON.stringify({\n          type: 'mark_all_read'\n        }));\n      }\n    }\n\n    /**\n     * 关闭所有WebSocket连接\n     */\n  }, {\n    key: \"closeAll\",\n    value: function closeAll() {\n      if (this.notificationSocket) {\n        this.notificationSocket.close();\n        this.notificationSocket = null;\n      }\n      Object.values(this.chatSockets).forEach(function (socket) {\n        socket.close();\n      });\n      this.chatSockets = {};\n      this.token = null;\n    }\n  }]);\n}(); // 创建单例\nvar wsManager = new WebSocketManager();\nexport default wsManager;","map":{"version":3,"names":["ReconnectingWebSocket","store","ElMessage","WS_BASE_URL","process","env","NODE_ENV","WebSocketManager","_classCallCheck","notificationSocket","chatSockets","token","_createClass","key","value","init","_this","console","log","localStorage","getItem","fetch","headers","concat","then","response","status","connectNotification","error","close","window","webSocketEnabled","rawToken","replace","encodeURIComponent","connectionTimeout","maxRetries","maxReconnectionDelay","minReconnectionDelay","debug","wsOptions","origin","location","onopen","onmessage","event","data","JSON","parse","type","message","commit","count","title","duration","onclose","onerror","connectChat","userId","_this2","chatSocket","getters","id","sender_id","state","user","currentUser","receiver_id","senderId","receiverId","content","timestamp","isRead","is_read","messages","map","msg","hasMore","has_more","page","code","dispatch","disconnectChat","sendChatMessage","send","stringify","loadChatHistory","arguments","length","undefined","pageSize","page_size","markNotificationRead","notificationId","readyState","WebSocket","OPEN","markAllNotificationsRead","closeAll","Object","values","forEach","socket","wsManager"],"sources":["H:/ForumServers/ForumFrontend/src/utils/websocket.js"],"sourcesContent":["import ReconnectingWebSocket from 'reconnecting-websocket';\nimport store from '@/store';\nimport { ElMessage } from 'element-plus';\n\n// WebSocket基础URL\nconst WS_BASE_URL = process.env.NODE_ENV === 'production' \n  ? 'wss://yourserver.com/ws' \n  : 'ws://localhost:8001/ws';\n\n/**\n * WebSocket管理类\n */\nclass WebSocketManager {\n  constructor() {\n    this.notificationSocket = null;\n    this.chatSockets = {}; // 存储与不同用户的聊天WebSocket连接\n    this.token = null;\n  }\n\n  /**\n   * 初始化WebSocket连接\n   * @param {string} token - JWT令牌\n   */\n  init(token) {\n    this.token = token;\n    if (!token) {\n      console.log('没有令牌，尝试从localStorage获取');\n      this.token = localStorage.getItem('token');\n      if (!this.token) {\n        console.log('无法获取令牌，不建立WebSocket连接');\n        return;\n      }\n    }\n    \n    // 检查后端是否支持通知功能\n    fetch('http://localhost:8001/api/v1/notifications/', {\n      headers: {\n        'Authorization': `Bearer ${this.token}`\n      }\n    })\n      .then(response => {\n        // 如果通知接口存在，则连接WebSocket\n        if (response.status !== 404) {\n          this.connectNotification(this.token);\n        } else {\n          console.log('通知接口不可用，不建立WebSocket连接');\n        }\n      })\n      .catch(error => {\n        console.error('检查通知接口可用性失败:', error);\n      });\n  }\n\n  /**\n   * 连接到通知WebSocket\n   * @param {string} token - JWT令牌\n   */\n  connectNotification(token) {\n    if (this.notificationSocket) {\n      this.notificationSocket.close();\n      this.notificationSocket = null;\n    }\n\n    // 如果已经禁用了WebSocket功能，则不再尝试连接\n    if (window.webSocketEnabled === false) {\n      console.log('WebSocket功能已被禁用，不再尝试连接');\n      return;\n    }\n\n    try {\n      // 从Bearer token中提取实际的token\n      const rawToken = token.replace('Bearer ', '');\n\n      // 创建通知WebSocket连接\n      this.notificationSocket = new ReconnectingWebSocket(\n        `${WS_BASE_URL}/notifications/?token=${encodeURIComponent(rawToken)}`,\n        [],\n        {\n          connectionTimeout: 5000,\n          maxRetries: 10,\n          maxReconnectionDelay: 5000,\n          minReconnectionDelay: 1000,\n          debug: true,\n          // 添加WebSocket选项\n          wsOptions: {\n            origin: window.location.origin\n          }\n        }\n      );\n\n    // 连接打开时的处理\n    this.notificationSocket.onopen = () => {\n      console.log('通知WebSocket连接已建立');\n    };\n\n    // 接收消息的处理\n    this.notificationSocket.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        \n        switch (data.type) {\n          case 'connection_established':\n            console.log(data.message);\n            break;\n          \n          case 'unread_count':\n            // 更新未读通知数量\n            store.commit('notifications/setUnreadCount', data.count);\n            break;\n          \n          case 'notification':\n            // 处理新通知\n            store.commit('notifications/addNotification', data);\n            store.commit('notifications/incrementUnreadCount');\n            \n            // 显示通知提示\n            ElMessage({\n              message: data.title,\n              type: 'info',\n              duration: 3000\n            });\n            break;\n          \n          case 'mark_read_response':\n          case 'mark_all_read_response':\n            // 标记通知已读的响应处理\n            break;\n          \n          default:\n            console.log('未知的通知类型:', data.type);\n        }\n      } catch (error) {\n        console.error('解析通知消息失败:', error);\n      }\n    };\n\n    // 连接关闭时的处理\n    this.notificationSocket.onclose = () => {\n      console.log('通知WebSocket连接已关闭');\n    };\n\n    // 连接错误时的处理\n    this.notificationSocket.onerror = (error) => {\n      console.error('通知WebSocket连接错误:', error);\n        // 连接错误时，设置全局标志，避免反复尝试连接\n        window.webSocketEnabled = false;\n    };\n    } catch (error) {\n      console.error('创建通知WebSocket连接失败:', error);\n    }\n  }\n\n  /**\n   * 连接到聊天WebSocket\n   * @param {number} userId - 对方用户ID\n   */\n  connectChat(userId) {\n    if (!this.token) {\n      console.error('未登录，无法建立聊天连接');\n      return;\n    }\n\n    // 如果已存在与该用户的连接，则返回\n    if (this.chatSockets[userId]) {\n      return;\n    }\n\n    // 从Bearer token中提取实际的token\n    const rawToken = this.token.replace('Bearer ', '');\n\n    // 创建聊天WebSocket连接，使用URL参数传递token\n    const chatSocket = new ReconnectingWebSocket(\n      `${WS_BASE_URL}/chat/${userId}?token=${encodeURIComponent(rawToken)}`,\n      [],\n      {\n        connectionTimeout: 5000,\n        maxRetries: 10,\n        maxReconnectionDelay: 5000,\n        minReconnectionDelay: 1000,\n        debug: true,\n        // 添加WebSocket选项\n        wsOptions: {\n          origin: window.location.origin\n        }\n      }\n    );\n\n    // 连接打开时的处理\n    chatSocket.onopen = () => {\n      console.log(`与用户${userId}的聊天WebSocket连接已建立`);\n    };\n\n    // 接收消息的处理\n    chatSocket.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        \n        switch (data.type) {\n          case 'connection_established':\n            console.log(data.message);\n            break;\n          \n          case 'chat_message':\n            // 处理聊天消息，添加去重逻辑\n            if (!store.getters['chat/hasMessage'](data.id)) {\n              store.commit('chat/addMessage', {\n                userId: data.sender_id === store.state.user.currentUser.id ? data.receiver_id : data.sender_id,\n                message: {\n                  id: data.id,\n                  senderId: data.sender_id,\n                  receiverId: data.receiver_id,\n                  content: data.content,\n                  timestamp: data.timestamp,\n                  isRead: data.is_read\n                }\n              });\n            }\n            break;\n          \n          case 'history_messages':\n            // 处理历史消息\n            store.commit('chat/setMessages', {\n              userId: userId,\n              messages: data.messages.map(msg => ({\n                id: msg.id,\n                senderId: msg.sender_id,\n                receiverId: msg.receiver_id,\n                content: msg.content,\n                timestamp: msg.timestamp,\n                isRead: msg.is_read\n              })),\n              hasMore: data.has_more,\n              page: data.page\n            });\n            break;\n          \n          default:\n            console.log('未知的聊天消息类型:', data.type);\n        }\n      } catch (error) {\n        console.error('解析聊天消息失败:', error);\n      }\n    };\n\n    // 连接关闭时的处理\n    chatSocket.onclose = (event) => {\n      console.log(`与用户${userId}的聊天WebSocket连接已关闭`);\n      delete this.chatSockets[userId];\n\n      // 处理特定的关闭代码\n      switch (event.code) {\n        case 4001:\n          console.error('WebSocket连接失败：未提供token');\n          break;\n        case 4002:\n          console.error('WebSocket连接失败：用户不存在');\n          break;\n        case 4003:\n          console.error('WebSocket连接失败：token无效');\n          // 可能需要触发重新登录\n          store.dispatch('auth/logout');\n          break;\n        default:\n          if (event.code !== 1000) {  // 1000是正常关闭\n            console.error(`WebSocket连接异常关闭，代码：${event.code}`);\n          }\n      }\n    };\n\n    // 连接错误时的处理\n    chatSocket.onerror = (error) => {\n      console.error(`与用户${userId}的聊天WebSocket连接错误:`, error);\n    };\n\n    // 保存连接\n    this.chatSockets[userId] = chatSocket;\n  }\n\n  /**\n   * 断开与用户的聊天连接\n   * @param {number} userId - 用户ID\n   */\n  disconnectChat(userId) {\n    if (this.chatSockets[userId]) {\n      this.chatSockets[userId].close();\n      delete this.chatSockets[userId];\n    }\n  }\n\n  /**\n   * 发送聊天消息\n   * @param {number} userId - 接收者ID\n   * @param {string} content - 消息内容\n   */\n  sendChatMessage(userId, content) {\n    if (!this.chatSockets[userId]) {\n      this.connectChat(userId);\n    }\n\n    this.chatSockets[userId].send(JSON.stringify({\n      type: 'chat_message',\n      content: content\n    }));\n  }\n\n  /**\n   * 加载历史消息\n   * @param {number} userId - 用户ID\n   * @param {number} page - 页码\n   * @param {number} pageSize - 每页大小\n   */\n  loadChatHistory(userId, page = 1, pageSize = 20) {\n    if (!this.chatSockets[userId]) {\n      this.connectChat(userId);\n    }\n\n    this.chatSockets[userId].send(JSON.stringify({\n      type: 'load_history',\n      page: page,\n      page_size: pageSize\n    }));\n  }\n\n  /**\n   * 标记通知为已读\n   * @param {number} notificationId - 通知ID\n   */\n  markNotificationRead(notificationId) {\n    if (this.notificationSocket && this.notificationSocket.readyState === WebSocket.OPEN) {\n      this.notificationSocket.send(JSON.stringify({\n        type: 'mark_read',\n        id: notificationId\n      }));\n    }\n  }\n\n  /**\n   * 标记所有通知为已读\n   */\n  markAllNotificationsRead() {\n    if (this.notificationSocket && this.notificationSocket.readyState === WebSocket.OPEN) {\n      this.notificationSocket.send(JSON.stringify({\n        type: 'mark_all_read'\n      }));\n    }\n  }\n\n  /**\n   * 关闭所有WebSocket连接\n   */\n  closeAll() {\n    if (this.notificationSocket) {\n      this.notificationSocket.close();\n      this.notificationSocket = null;\n    }\n\n    Object.values(this.chatSockets).forEach(socket => {\n      socket.close();\n    });\n    this.chatSockets = {};\n    this.token = null;\n  }\n}\n\n// 创建单例\nconst wsManager = new WebSocketManager();\n\nexport default wsManager; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}