{"ast":null,"code":"import _regeneratorRuntime from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.map.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport { getUserProfile } from '@/api/users';\nimport { DEFAULT_AVATAR } from '@/constants/default-avatar';\nvar state = {\n  userCache: new Map() // 用户信息缓存\n};\nvar getters = {\n  getUserById: function getUserById(state) {\n    return function (userId) {\n      return state.userCache.get(userId);\n    };\n  }\n};\nvar mutations = {\n  setUserInfo: function setUserInfo(state, _ref) {\n    var userId = _ref.userId,\n      userInfo = _ref.userInfo;\n    state.userCache.set(userId, userInfo);\n  }\n};\nvar actions = {\n  fetchUserInfo: function fetchUserInfo(_ref2, userId) {\n    return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var commit, state, response, userInfo, defaultUserInfo;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            commit = _ref2.commit, state = _ref2.state;\n            if (!state.userCache.has(userId)) {\n              _context.next = 3;\n              break;\n            }\n            return _context.abrupt(\"return\", state.userCache.get(userId));\n          case 3:\n            _context.prev = 3;\n            _context.next = 6;\n            return getUserProfile(userId);\n          case 6:\n            response = _context.sent;\n            // 确保response有正确的数据结构\n            userInfo = response.data || response; // 设置默认头像\n            if (!userInfo.avatar_url) {\n              userInfo.avatar_url = DEFAULT_AVATAR;\n            }\n\n            // 设置默认昵称\n            if (!userInfo.nickname) {\n              userInfo.nickname = userInfo.username;\n            }\n            commit('setUserInfo', {\n              userId: userId,\n              userInfo: userInfo\n            });\n            return _context.abrupt(\"return\", userInfo);\n          case 14:\n            _context.prev = 14;\n            _context.t0 = _context[\"catch\"](3);\n            console.error('获取用户信息失败:', _context.t0);\n            // 返回一个默认的用户信息对象\n            defaultUserInfo = {\n              id: userId,\n              username: \"\\u7528\\u6237\".concat(userId),\n              nickname: \"\\u7528\\u6237\".concat(userId),\n              avatar_url: DEFAULT_AVATAR,\n              email: ''\n            };\n            commit('setUserInfo', {\n              userId: userId,\n              userInfo: defaultUserInfo\n            });\n            return _context.abrupt(\"return\", defaultUserInfo);\n          case 20:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[3, 14]]);\n    }))();\n  }\n};\nexport default {\n  namespaced: true,\n  state: state,\n  getters: getters,\n  mutations: mutations,\n  actions: actions\n};","map":{"version":3,"names":["getUserProfile","DEFAULT_AVATAR","state","userCache","Map","getters","getUserById","userId","get","mutations","setUserInfo","_ref","userInfo","set","actions","fetchUserInfo","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","commit","response","defaultUserInfo","wrap","_callee$","_context","prev","next","has","abrupt","sent","data","avatar_url","nickname","username","t0","console","error","id","concat","email","stop","namespaced"],"sources":["H:/ForumServers/ForumFrontend/src/store/modules/users.js"],"sourcesContent":["import { getUserProfile } from '@/api/users';\r\nimport { DEFAULT_AVATAR } from '@/constants/default-avatar';\r\n\r\nconst state = {\r\n  userCache: new Map() // 用户信息缓存\r\n};\r\n\r\nconst getters = {\r\n  getUserById: (state) => (userId) => {\r\n    return state.userCache.get(userId);\r\n  }\r\n};\r\n\r\nconst mutations = {\r\n  setUserInfo(state, { userId, userInfo }) {\r\n    state.userCache.set(userId, userInfo);\r\n  }\r\n};\r\n\r\nconst actions = {\r\n  async fetchUserInfo({ commit, state }, userId) {\r\n    // 如果缓存中已有用户信息，直接返回\r\n    if (state.userCache.has(userId)) {\r\n      return state.userCache.get(userId);\r\n    }\r\n\r\n    try {\r\n      const response = await getUserProfile(userId);\r\n      // 确保response有正确的数据结构\r\n      const userInfo = response.data || response;\r\n      \r\n      // 设置默认头像\r\n      if (!userInfo.avatar_url) {\r\n        userInfo.avatar_url = DEFAULT_AVATAR;\r\n      }\r\n      \r\n      // 设置默认昵称\r\n      if (!userInfo.nickname) {\r\n        userInfo.nickname = userInfo.username;\r\n      }\r\n      \r\n      commit('setUserInfo', { userId, userInfo });\r\n      return userInfo;\r\n    } catch (error) {\r\n      console.error('获取用户信息失败:', error);\r\n      // 返回一个默认的用户信息对象\r\n      const defaultUserInfo = {\r\n        id: userId,\r\n        username: `用户${userId}`,\r\n        nickname: `用户${userId}`,\r\n        avatar_url: DEFAULT_AVATAR,\r\n        email: ''\r\n      };\r\n      commit('setUserInfo', { userId, userInfo: defaultUserInfo });\r\n      return defaultUserInfo;\r\n    }\r\n  }\r\n};\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  getters,\r\n  mutations,\r\n  actions\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}