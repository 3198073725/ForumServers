{"ast":null,"code":"'use strict';\n\nrequire(\"core-js/modules/es.array.includes.js\");\nrequire(\"core-js/modules/es.array.index-of.js\");\nrequire(\"core-js/modules/es.array.some.js\");\nrequire(\"core-js/modules/es.iterator.constructor.js\");\nrequire(\"core-js/modules/es.iterator.some.js\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/es.regexp.constructor.js\");\nrequire(\"core-js/modules/es.regexp.dot-all.js\");\nrequire(\"core-js/modules/es.regexp.exec.js\");\nrequire(\"core-js/modules/es.regexp.sticky.js\");\nrequire(\"core-js/modules/es.regexp.test.js\");\nrequire(\"core-js/modules/es.regexp.to-string.js\");\nrequire(\"core-js/modules/es.string.includes.js\");\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar lodashUnified = require('lodash-unified');\nvar token = require('./token.js');\nvar option = require('./option.js');\nvar strings = require('../../../utils/strings.js');\nvar error = require('../../../utils/error.js');\nvar shared = require('@vue/shared');\nfunction useOption(props, states) {\n  var select = vue.inject(token.selectKey);\n  if (!select) {\n    error.throwError(option.COMPONENT_NAME, \"usage: <el-select><el-option /></el-select/>\");\n  }\n  var selectGroup = vue.inject(token.selectGroupKey, {\n    disabled: false\n  });\n  var itemSelected = vue.computed(function () {\n    return contains(lodashUnified.castArray(select.props.modelValue), props.value);\n  });\n  var limitReached = vue.computed(function () {\n    var _a;\n    if (select.props.multiple) {\n      var modelValue = lodashUnified.castArray((_a = select.props.modelValue) != null ? _a : []);\n      return !itemSelected.value && modelValue.length >= select.props.multipleLimit && select.props.multipleLimit > 0;\n    } else {\n      return false;\n    }\n  });\n  var currentLabel = vue.computed(function () {\n    return props.label || (shared.isObject(props.value) ? \"\" : props.value);\n  });\n  var currentValue = vue.computed(function () {\n    return props.value || props.label || \"\";\n  });\n  var isDisabled = vue.computed(function () {\n    return props.disabled || states.groupDisabled || limitReached.value;\n  });\n  var instance = vue.getCurrentInstance();\n  var contains = function contains() {\n    var arr = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var target = arguments.length > 1 ? arguments[1] : undefined;\n    if (!shared.isObject(props.value)) {\n      return arr && arr.includes(target);\n    } else {\n      var valueKey = select.props.valueKey;\n      return arr && arr.some(function (item) {\n        return vue.toRaw(lodashUnified.get(item, valueKey)) === lodashUnified.get(target, valueKey);\n      });\n    }\n  };\n  var hoverItem = function hoverItem() {\n    if (!props.disabled && !selectGroup.disabled) {\n      select.states.hoveringIndex = select.optionsArray.indexOf(instance.proxy);\n    }\n  };\n  var updateOption = function updateOption(query) {\n    var regexp = new RegExp(strings.escapeStringRegexp(query), \"i\");\n    states.visible = regexp.test(String(currentLabel.value)) || props.created;\n  };\n  vue.watch(function () {\n    return currentLabel.value;\n  }, function () {\n    if (!props.created && !select.props.remote) select.setSelected();\n  });\n  vue.watch(function () {\n    return props.value;\n  }, function (val, oldVal) {\n    var _select$props = select.props,\n      remote = _select$props.remote,\n      valueKey = _select$props.valueKey;\n    var shouldUpdate = remote ? val !== oldVal : !lodashUnified.isEqual(val, oldVal);\n    if (shouldUpdate) {\n      select.onOptionDestroy(oldVal, instance.proxy);\n      select.onOptionCreate(instance.proxy);\n    }\n    if (!props.created && !remote) {\n      if (valueKey && shared.isObject(val) && shared.isObject(oldVal) && val[valueKey] === oldVal[valueKey]) {\n        return;\n      }\n      select.setSelected();\n    }\n  });\n  vue.watch(function () {\n    return selectGroup.disabled;\n  }, function () {\n    states.groupDisabled = selectGroup.disabled;\n  }, {\n    immediate: true\n  });\n  return {\n    select: select,\n    currentLabel: currentLabel,\n    currentValue: currentValue,\n    itemSelected: itemSelected,\n    isDisabled: isDisabled,\n    hoverItem: hoverItem,\n    updateOption: updateOption\n  };\n}\nexports.useOption = useOption;","map":{"version":3,"names":["useOption","props","states","select","vue","inject","token","selectKey","error","throwError","option","COMPONENT_NAME","selectGroup","selectGroupKey","disabled","itemSelected","computed","contains","lodashUnified","castArray","modelValue","value","limitReached","_a","multiple","length","multipleLimit","currentLabel","label","shared","isObject","currentValue","isDisabled","groupDisabled","instance","getCurrentInstance","arr","arguments","undefined","target","includes","valueKey","some","item","toRaw","get","hoverItem","hoveringIndex","optionsArray","indexOf","proxy","updateOption","query","regexp","RegExp","strings","escapeStringRegexp","visible","test","String","created","watch","remote","setSelected","val","oldVal","_select$props","shouldUpdate","isEqual","onOptionDestroy","onOptionCreate","immediate"],"sources":["../../../../../../packages/components/select/src/useOption.ts"],"sourcesContent":["import { computed, getCurrentInstance, inject, toRaw, watch } from 'vue'\nimport { get, isEqual } from 'lodash-unified'\nimport {\n  ensureArray,\n  escapeStringRegexp,\n  isObject,\n  throwError,\n} from '@element-plus/utils'\nimport { selectGroupKey, selectKey } from './token'\nimport { COMPONENT_NAME } from './option'\n\nimport type { OptionInternalInstance, OptionProps, OptionStates } from './type'\n\nexport function useOption(props: OptionProps, states: OptionStates) {\n  // inject\n  const select = inject(selectKey)\n  if (!select) {\n    throwError(COMPONENT_NAME, 'usage: <el-select><el-option /></el-select/>')\n  }\n  const selectGroup = inject(selectGroupKey, { disabled: false })\n\n  // computed\n  const itemSelected = computed(() => {\n    return contains(ensureArray(select.props.modelValue), props.value)\n  })\n\n  const limitReached = computed(() => {\n    if (select.props.multiple) {\n      const modelValue = ensureArray(select.props.modelValue ?? [])\n      return (\n        !itemSelected.value &&\n        modelValue.length >= select.props.multipleLimit &&\n        select.props.multipleLimit > 0\n      )\n    } else {\n      return false\n    }\n  })\n\n  const currentLabel = computed(() => {\n    return props.label || (isObject(props.value) ? '' : props.value)\n  })\n\n  const currentValue = computed(() => {\n    return props.value || props.label || ''\n  })\n\n  const isDisabled = computed(() => {\n    return props.disabled || states.groupDisabled || limitReached.value\n  })\n\n  const instance = getCurrentInstance()! as OptionInternalInstance\n  const contains = <T>(arr: T[] = [], target: T) => {\n    if (!isObject(props.value)) {\n      return arr && arr.includes(target)\n    } else {\n      const valueKey = select.props.valueKey\n      return (\n        arr &&\n        arr.some((item) => {\n          return toRaw(get(item, valueKey)) === get(target, valueKey)\n        })\n      )\n    }\n  }\n\n  const hoverItem = () => {\n    if (!props.disabled && !selectGroup.disabled) {\n      select.states.hoveringIndex = select.optionsArray.indexOf(instance.proxy)\n    }\n  }\n\n  const updateOption = (query: string) => {\n    const regexp = new RegExp(escapeStringRegexp(query), 'i')\n    states.visible = regexp.test(String(currentLabel.value)) || props.created\n  }\n\n  watch(\n    () => currentLabel.value,\n    () => {\n      if (!props.created && !select.props.remote) select.setSelected()\n    }\n  )\n\n  watch(\n    () => props.value,\n    (val, oldVal) => {\n      const { remote, valueKey } = select.props\n      const shouldUpdate = remote ? val !== oldVal : !isEqual(val, oldVal)\n      if (shouldUpdate) {\n        select.onOptionDestroy(oldVal, instance.proxy)\n        select.onOptionCreate(instance.proxy)\n      }\n\n      if (!props.created && !remote) {\n        if (\n          valueKey &&\n          isObject(val) &&\n          isObject(oldVal) &&\n          val[valueKey] === oldVal[valueKey]\n        ) {\n          return\n        }\n        select.setSelected()\n      }\n    }\n  )\n\n  watch(\n    () => selectGroup.disabled,\n    () => {\n      states.groupDisabled = selectGroup.disabled\n    },\n    { immediate: true }\n  )\n\n  return {\n    select,\n    currentLabel,\n    currentValue,\n    itemSelected,\n    isDisabled,\n    hoverItem,\n    updateOption,\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}