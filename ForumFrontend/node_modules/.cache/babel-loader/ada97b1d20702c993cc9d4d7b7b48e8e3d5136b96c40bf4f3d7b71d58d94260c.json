{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.array.concat.js\");\nrequire(\"core-js/modules/es.array.slice.js\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.string.substr.js\");\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar Op_1 = __importDefault(require(\"./Op\"));\nvar Iterator = /** @class */function () {\n  function Iterator(ops) {\n    this.ops = ops;\n    this.index = 0;\n    this.offset = 0;\n  }\n  Iterator.prototype.hasNext = function () {\n    return this.peekLength() < Infinity;\n  };\n  Iterator.prototype.next = function (length) {\n    if (!length) {\n      length = Infinity;\n    }\n    var nextOp = this.ops[this.index];\n    if (nextOp) {\n      var offset = this.offset;\n      var opLength = Op_1[\"default\"].length(nextOp);\n      if (length >= opLength - offset) {\n        length = opLength - offset;\n        this.index += 1;\n        this.offset = 0;\n      } else {\n        this.offset += length;\n      }\n      if (typeof nextOp[\"delete\"] === 'number') {\n        return {\n          \"delete\": length\n        };\n      } else {\n        var retOp = {};\n        if (nextOp.attributes) {\n          retOp.attributes = nextOp.attributes;\n        }\n        if (typeof nextOp.retain === 'number') {\n          retOp.retain = length;\n        } else if (typeof nextOp.insert === 'string') {\n          retOp.insert = nextOp.insert.substr(offset, length);\n        } else {\n          // offset should === 0, length should === 1\n          retOp.insert = nextOp.insert;\n        }\n        return retOp;\n      }\n    } else {\n      return {\n        retain: Infinity\n      };\n    }\n  };\n  Iterator.prototype.peek = function () {\n    return this.ops[this.index];\n  };\n  Iterator.prototype.peekLength = function () {\n    if (this.ops[this.index]) {\n      // Should never return 0 if our index is being managed correctly\n      return Op_1[\"default\"].length(this.ops[this.index]) - this.offset;\n    } else {\n      return Infinity;\n    }\n  };\n  Iterator.prototype.peekType = function () {\n    if (this.ops[this.index]) {\n      if (typeof this.ops[this.index][\"delete\"] === 'number') {\n        return 'delete';\n      } else if (typeof this.ops[this.index].retain === 'number') {\n        return 'retain';\n      } else {\n        return 'insert';\n      }\n    }\n    return 'retain';\n  };\n  Iterator.prototype.rest = function () {\n    if (!this.hasNext()) {\n      return [];\n    } else if (this.offset === 0) {\n      return this.ops.slice(this.index);\n    } else {\n      var offset = this.offset;\n      var index = this.index;\n      var next = this.next();\n      var rest = this.ops.slice(this.index);\n      this.offset = offset;\n      this.index = index;\n      return [next].concat(rest);\n    }\n  };\n  return Iterator;\n}();\nexports[\"default\"] = Iterator;","map":{"version":3,"names":["Op_1","__importDefault","require","Iterator","ops","index","offset","prototype","hasNext","peekLength","Infinity","next","length","nextOp","opLength","retOp","attributes","retain","insert","substr","peek","peekType","rest","slice","concat"],"sources":["../src/Iterator.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}