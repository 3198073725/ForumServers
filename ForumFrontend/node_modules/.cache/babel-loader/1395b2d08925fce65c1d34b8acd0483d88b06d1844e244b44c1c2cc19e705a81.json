{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport axios from 'axios';\nimport router from '../router';\nimport { ElMessage } from 'element-plus';\n// 创建axios实例\nvar service = axios.create({\n  baseURL: 'http://localhost:8000',\n  timeout: 10000\n});\n\n// 请求拦截器\nservice.interceptors.request.use(function (config) {\n  var token = localStorage.getItem('token');\n\n  // 设置Authorization头\n  if (token) {\n    config.headers.Authorization = \"Bearer \".concat(token);\n  }\n\n  // 设置Content-Type头（如果没有设置）\n  if (config.method === 'post' || config.method === 'put' || config.method === 'patch') {\n    if (!config.headers['Content-Type'] && !(config.data instanceof FormData)) {\n      config.headers['Content-Type'] = 'application/json';\n    }\n  }\n  return config;\n}, function (error) {\n  console.error('请求错误:', error);\n  return Promise.reject(error);\n});\n\n// 响应拦截器\nservice.interceptors.response.use(function (response) {\n  var res = response.data;\n\n  // 检查是否有明确的错误状态\n  if (res.status && res.status !== 0 && res.status !== 200) {\n    console.error('API错误响应:', res);\n    ElMessage({\n      message: res.msg || '请求失败',\n      type: 'error',\n      duration: 5 * 1000\n    });\n\n    // 401: 未登录或token过期\n    if (res.status === 401) {\n      // 清除本地token和用户信息\n      localStorage.removeItem('token');\n      localStorage.removeItem('userInfo');\n\n      // 跳转到登录页\n      router.push('/login');\n    }\n    return Promise.reject(new Error(res.msg || '请求失败'));\n  } else {\n    // 如果是\"操作成功\"消息，且不在特定页面，才显示成功消息\n    if (res.msg && res.msg !== '操作成功' && !shouldSuppressMessage() && !isCommentDeleteOperation(response.config)) {\n      ElMessage({\n        message: res.msg,\n        type: 'success',\n        duration: 3000\n      });\n    }\n\n    // 兼容不同的响应格式\n    if (res.code === undefined && res.status === undefined) {\n      // 如果响应中既没有code也没有status字段，可能是直接返回的数据\n      return {\n        code: 0,\n        status: 0,\n        msg: '',\n        data: res\n      };\n    }\n    return res;\n  }\n}, function (error) {\n  console.error('响应错误:', error);\n\n  // 处理HTTP错误状态码\n  if (error.response) {\n    var status = error.response.status;\n    if (status === 401) {\n      ElMessage({\n        message: '登录已过期，请重新登录',\n        type: 'error',\n        duration: 5 * 1000\n      });\n\n      // 清除本地token和用户信息\n      localStorage.removeItem('token');\n      localStorage.removeItem('userInfo');\n\n      // 跳转到登录页\n      router.push('/login');\n    } else if (status === 404) {\n      ElMessage({\n        message: '请求的资源不存在',\n        type: 'error',\n        duration: 5 * 1000\n      });\n    } else if (status === 500) {\n      ElMessage({\n        message: '服务器内部错误',\n        type: 'error',\n        duration: 5 * 1000\n      });\n    } else {\n      // 尝试从响应中获取错误信息\n      var errorMsg = '请求失败';\n      try {\n        if (error.response.data) {\n          if (error.response.data.msg) {\n            errorMsg = error.response.data.msg;\n          } else if (error.response.data.detail) {\n            errorMsg = error.response.data.detail;\n          } else if (typeof error.response.data === 'string') {\n            errorMsg = error.response.data;\n          }\n        }\n      } catch (e) {\n        console.error('解析错误信息失败:', e);\n      }\n      ElMessage({\n        message: errorMsg,\n        type: 'error',\n        duration: 5 * 1000\n      });\n    }\n  } else if (error.request) {\n    // 请求已发送但没有收到响应\n    ElMessage({\n      message: '服务器无响应，请检查网络连接',\n      type: 'error',\n      duration: 5 * 1000\n    });\n  } else {\n    // 请求配置有误\n    ElMessage({\n      message: '网络错误，请检查网络连接',\n      type: 'error',\n      duration: 5 * 1000\n    });\n  }\n  return Promise.reject(error);\n});\n\n// 辅助函数：判断当前页面是否应该抑制消息显示\nfunction shouldSuppressMessage() {\n  var currentPath = window.location.pathname;\n  return currentPath.includes('/post/create') || currentPath.includes('/post/edit') || currentPath.includes('/post/') && !currentPath.includes('/create') && !currentPath.includes('/edit');\n}\n\n// 辅助函数：判断是否为评论删除操作\nfunction isCommentDeleteOperation(config) {\n  if (!config || !config.url || !config.method) {\n    console.log('无法判断是否为评论删除操作，配置不完整:', config);\n    return false;\n  }\n  var isDeleteMethod = config.method.toLowerCase() === 'delete';\n  var isCommentUrl = config.url.includes('/api/v1/comments/');\n  console.log('请求拦截器检测:', {\n    url: config.url,\n    method: config.method,\n    isDeleteMethod: isDeleteMethod,\n    isCommentUrl: isCommentUrl,\n    isCommentDelete: isDeleteMethod && isCommentUrl\n  });\n  return isCommentUrl && isDeleteMethod;\n}\nexport default service;","map":{"version":3,"names":["axios","router","ElMessage","service","create","baseURL","timeout","interceptors","request","use","config","token","localStorage","getItem","headers","Authorization","concat","method","data","FormData","error","console","Promise","reject","response","res","status","message","msg","type","duration","removeItem","push","Error","shouldSuppressMessage","isCommentDeleteOperation","code","undefined","errorMsg","detail","e","currentPath","window","location","pathname","includes","url","log","isDeleteMethod","toLowerCase","isCommentUrl","isCommentDelete"],"sources":["H:/ForumServers/ForumFrontend/src/utils/request.js"],"sourcesContent":["import axios from 'axios'\nimport router from '../router'\nimport { ElMessage } from 'element-plus'\n// 创建axios实例\nconst service = axios.create({\n  baseURL: 'http://localhost:8000',\n  timeout: 10000\n})\n\n// 请求拦截器\nservice.interceptors.request.use(\n  config => {\n    const token = localStorage.getItem('token')\n    \n    // 设置Authorization头\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`\n    }\n\n    // 设置Content-Type头（如果没有设置）\n    if (config.method === 'post' || config.method === 'put' || config.method === 'patch') {\n      if (!config.headers['Content-Type'] && !(config.data instanceof FormData)) {\n        config.headers['Content-Type'] = 'application/json'\n      }\n    }\n\n    return config\n  },\n  error => {\n    console.error('请求错误:', error)\n    return Promise.reject(error)\n  }\n)\n\n// 响应拦截器\nservice.interceptors.response.use(\n  response => {\n    const res = response.data\n    \n    // 检查是否有明确的错误状态\n    if (res.status && res.status !== 0 && res.status !== 200) {\n      console.error('API错误响应:', res)\n      ElMessage({\n        message: res.msg || '请求失败',\n        type: 'error',\n        duration: 5 * 1000\n      })\n\n      // 401: 未登录或token过期\n      if (res.status === 401) {\n        // 清除本地token和用户信息\n        localStorage.removeItem('token')\n        localStorage.removeItem('userInfo')\n\n        // 跳转到登录页\n        router.push('/login')\n      }\n\n      return Promise.reject(new Error(res.msg || '请求失败'))\n    } else {\n      // 如果是\"操作成功\"消息，且不在特定页面，才显示成功消息\n      if (res.msg && res.msg !== '操作成功' && !shouldSuppressMessage() && !isCommentDeleteOperation(response.config)) {\n        ElMessage({\n          message: res.msg,\n          type: 'success',\n          duration: 3000\n        })\n      }\n      \n      // 兼容不同的响应格式\n      if (res.code === undefined && res.status === undefined) {\n        // 如果响应中既没有code也没有status字段，可能是直接返回的数据\n        return {\n          code: 0,\n          status: 0,\n          msg: '',\n          data: res\n        }\n      }\n\n      return res\n    }\n  },\n  error => {\n    console.error('响应错误:', error)\n\n    // 处理HTTP错误状态码\n    if (error.response) {\n      const status = error.response.status\n      \n      if (status === 401) {\n        ElMessage({\n          message: '登录已过期，请重新登录',\n          type: 'error',\n          duration: 5 * 1000\n        })\n\n        // 清除本地token和用户信息\n        localStorage.removeItem('token')\n        localStorage.removeItem('userInfo')\n\n        // 跳转到登录页\n        router.push('/login')\n      } else if (status === 404) {\n        ElMessage({\n          message: '请求的资源不存在',\n          type: 'error',\n          duration: 5 * 1000\n        })\n      } else if (status === 500) {\n        ElMessage({\n          message: '服务器内部错误',\n          type: 'error',\n          duration: 5 * 1000\n        })\n      } else {\n        // 尝试从响应中获取错误信息\n        let errorMsg = '请求失败'\n        try {\n          if (error.response.data) {\n            if (error.response.data.msg) {\n              errorMsg = error.response.data.msg\n            } else if (error.response.data.detail) {\n              errorMsg = error.response.data.detail\n            } else if (typeof error.response.data === 'string') {\n              errorMsg = error.response.data\n            }\n          }\n        } catch (e) {\n          console.error('解析错误信息失败:', e)\n        }\n\n        ElMessage({\n          message: errorMsg,\n          type: 'error',\n          duration: 5 * 1000\n        })\n      }\n    } else if (error.request) {\n      // 请求已发送但没有收到响应\n      ElMessage({\n        message: '服务器无响应，请检查网络连接',\n        type: 'error',\n        duration: 5 * 1000\n      })\n    } else {\n      // 请求配置有误\n      ElMessage({\n        message: '网络错误，请检查网络连接',\n        type: 'error',\n        duration: 5 * 1000\n      })\n    }\n\n    return Promise.reject(error)\n  }\n)\n\n// 辅助函数：判断当前页面是否应该抑制消息显示\nfunction shouldSuppressMessage() {\n  const currentPath = window.location.pathname\n  return currentPath.includes('/post/create') || \n         currentPath.includes('/post/edit') || \n         (currentPath.includes('/post/') && !currentPath.includes('/create') && !currentPath.includes('/edit'))\n}\n\n// 辅助函数：判断是否为评论删除操作\nfunction isCommentDeleteOperation(config) {\n  if (!config || !config.url || !config.method) {\n    console.log('无法判断是否为评论删除操作，配置不完整:', config)\n    return false\n  }\n  \n  const isDeleteMethod = config.method.toLowerCase() === 'delete'\n  const isCommentUrl = config.url.includes('/api/v1/comments/')\n  \n  console.log('请求拦截器检测:', {\n    url: config.url,\n    method: config.method,\n    isDeleteMethod,\n    isCommentUrl,\n    isCommentDelete: isDeleteMethod && isCommentUrl\n  })\n  \n  return isCommentUrl && isDeleteMethod\n}\n\nexport default service\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}