{"ast":null,"code":"'use strict';\n\nvar _defineProperty = require(\"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/defineProperty.js\")[\"default\"];\nvar _regeneratorRuntime = require(\"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\")[\"default\"];\nvar _asyncToGenerator = require(\"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/asyncToGenerator.js\")[\"default\"];\nvar _objectSpread = require(\"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/objectSpread2.js\")[\"default\"];\nrequire(\"core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar core = require('@vueuse/core');\nvar affix = require('./affix.js');\nvar pluginVue_exportHelper = require('../../../_virtual/plugin-vue_export-helper.js');\nvar index = require('../../../hooks/use-namespace/index.js');\nvar scroll = require('../../../utils/dom/scroll.js');\nvar style = require('../../../utils/dom/style.js');\nvar event = require('../../../constants/event.js');\nvar error = require('../../../utils/error.js');\nvar COMPONENT_NAME = \"ElAffix\";\nvar __default__ = vue.defineComponent({\n  name: COMPONENT_NAME\n});\nvar _sfc_main = /* @__PURE__ */vue.defineComponent(_objectSpread(_objectSpread({}, __default__), {}, {\n  props: affix.affixProps,\n  emits: affix.affixEmits,\n  setup: function setup(__props, _ref) {\n    var expose = _ref.expose,\n      emit = _ref.emit;\n    var props = __props;\n    var ns = index.useNamespace(\"affix\");\n    var target = vue.shallowRef();\n    var root = vue.shallowRef();\n    var scrollContainer = vue.shallowRef();\n    var _core$useWindowSize = core.useWindowSize(),\n      windowHeight = _core$useWindowSize.height;\n    var _core$useElementBound = core.useElementBounding(root, {\n        windowScroll: false\n      }),\n      rootHeight = _core$useElementBound.height,\n      rootWidth = _core$useElementBound.width,\n      rootTop = _core$useElementBound.top,\n      rootBottom = _core$useElementBound.bottom,\n      updateRoot = _core$useElementBound.update;\n    var targetRect = core.useElementBounding(target);\n    var fixed = vue.ref(false);\n    var scrollTop = vue.ref(0);\n    var transform = vue.ref(0);\n    var rootStyle = vue.computed(function () {\n      return {\n        height: fixed.value ? \"\".concat(rootHeight.value, \"px\") : \"\",\n        width: fixed.value ? \"\".concat(rootWidth.value, \"px\") : \"\"\n      };\n    });\n    var affixStyle = vue.computed(function () {\n      if (!fixed.value) return {};\n      var offset = props.offset ? style.addUnit(props.offset) : 0;\n      return {\n        height: \"\".concat(rootHeight.value, \"px\"),\n        width: \"\".concat(rootWidth.value, \"px\"),\n        top: props.position === \"top\" ? offset : \"\",\n        bottom: props.position === \"bottom\" ? offset : \"\",\n        transform: transform.value ? \"translateY(\".concat(transform.value, \"px)\") : \"\",\n        zIndex: props.zIndex\n      };\n    });\n    var update = function update() {\n      if (!scrollContainer.value) return;\n      scrollTop.value = scrollContainer.value instanceof Window ? document.documentElement.scrollTop : scrollContainer.value.scrollTop || 0;\n      var position = props.position,\n        target2 = props.target,\n        offset = props.offset;\n      var rootHeightOffset = offset + rootHeight.value;\n      if (position === \"top\") {\n        if (target2) {\n          var difference = targetRect.bottom.value - rootHeightOffset;\n          fixed.value = offset > rootTop.value && targetRect.bottom.value > 0;\n          transform.value = difference < 0 ? difference : 0;\n        } else {\n          fixed.value = offset > rootTop.value;\n        }\n      } else if (target2) {\n        var _difference = windowHeight.value - targetRect.top.value - rootHeightOffset;\n        fixed.value = windowHeight.value - offset < rootBottom.value && windowHeight.value > targetRect.top.value;\n        transform.value = _difference < 0 ? -_difference : 0;\n      } else {\n        fixed.value = windowHeight.value - offset < rootBottom.value;\n      }\n    };\n    var handleScroll = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              updateRoot();\n              _context.next = 3;\n              return vue.nextTick();\n            case 3:\n              emit(\"scroll\", {\n                scrollTop: scrollTop.value,\n                fixed: fixed.value\n              });\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function handleScroll() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    vue.watch(fixed, function (val) {\n      return emit(event.CHANGE_EVENT, val);\n    });\n    vue.onMounted(function () {\n      var _a;\n      if (props.target) {\n        target.value = (_a = document.querySelector(props.target)) != null ? _a : void 0;\n        if (!target.value) error.throwError(COMPONENT_NAME, \"Target does not exist: \".concat(props.target));\n      } else {\n        target.value = document.documentElement;\n      }\n      scrollContainer.value = scroll.getScrollContainer(root.value, true);\n      updateRoot();\n    });\n    core.useEventListener(scrollContainer, \"scroll\", handleScroll);\n    vue.watchEffect(update);\n    expose({\n      update: update,\n      updateRoot: updateRoot\n    });\n    return function (_ctx, _cache) {\n      return vue.openBlock(), vue.createElementBlock(\"div\", {\n        ref_key: \"root\",\n        ref: root,\n        \"class\": vue.normalizeClass(vue.unref(ns).b()),\n        style: vue.normalizeStyle(vue.unref(rootStyle))\n      }, [vue.createElementVNode(\"div\", {\n        \"class\": vue.normalizeClass(_defineProperty({}, vue.unref(ns).m(\"fixed\"), fixed.value)),\n        style: vue.normalizeStyle(vue.unref(affixStyle))\n      }, [vue.renderSlot(_ctx.$slots, \"default\")], 6)], 6);\n    };\n  }\n}));\nvar Affix = /* @__PURE__ */pluginVue_exportHelper[\"default\"](_sfc_main, [[\"__file\", \"affix.vue\"]]);\nexports[\"default\"] = Affix;","map":{"version":3,"names":["name","COMPONENT_NAME","ns","index","useNamespace","target","vue","shallowRef","root","scrollContainer","_core$useWindowSize","core","useWindowSize","windowHeight","height","_core$useElementBound","useElementBounding","windowScroll","rootHeight","rootWidth","width","rootTop","top","rootBottom","bottom","updateRoot","update","targetRect","fixed","ref","scrollTop","transform","rootStyle","computed","value","concat","affixStyle","offset","props","style","addUnit","position","zIndex","Window","document","documentElement","target2","rootHeightOffset","difference","handleScroll","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","nextTick","emit","stop","apply","arguments","watch","val","event","CHANGE_EVENT","onMounted","_a","querySelector","error","throwError","scroll","getScrollContainer","useEventListener","watchEffect","expose"],"sources":["../../../../../../packages/components/affix/src/affix.vue"],"sourcesContent":["<template>\n  <div ref=\"root\" :class=\"ns.b()\" :style=\"rootStyle\">\n    <div :class=\"{ [ns.m('fixed')]: fixed }\" :style=\"affixStyle\">\n      <slot />\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport {\n  computed,\n  nextTick,\n  onMounted,\n  ref,\n  shallowRef,\n  watch,\n  watchEffect,\n} from 'vue'\nimport {\n  useElementBounding,\n  useEventListener,\n  useWindowSize,\n} from '@vueuse/core'\nimport { addUnit, getScrollContainer, throwError } from '@element-plus/utils'\nimport { useNamespace } from '@element-plus/hooks'\nimport { CHANGE_EVENT } from '@element-plus/constants'\nimport { affixEmits, affixProps } from './affix'\nimport type { CSSProperties } from 'vue'\n\nconst COMPONENT_NAME = 'ElAffix'\ndefineOptions({\n  name: COMPONENT_NAME,\n})\nconst props = defineProps(affixProps)\nconst emit = defineEmits(affixEmits)\n\nconst ns = useNamespace('affix')\n\nconst target = shallowRef<HTMLElement>()\nconst root = shallowRef<HTMLDivElement>()\nconst scrollContainer = shallowRef<HTMLElement | Window>()\nconst { height: windowHeight } = useWindowSize()\nconst {\n  height: rootHeight,\n  width: rootWidth,\n  top: rootTop,\n  bottom: rootBottom,\n  update: updateRoot,\n} = useElementBounding(root, { windowScroll: false })\nconst targetRect = useElementBounding(target)\n\nconst fixed = ref(false)\nconst scrollTop = ref(0)\nconst transform = ref(0)\n\nconst rootStyle = computed<CSSProperties>(() => {\n  return {\n    height: fixed.value ? `${rootHeight.value}px` : '',\n    width: fixed.value ? `${rootWidth.value}px` : '',\n  }\n})\n\nconst affixStyle = computed<CSSProperties>(() => {\n  if (!fixed.value) return {}\n\n  const offset = props.offset ? addUnit(props.offset) : 0\n  return {\n    height: `${rootHeight.value}px`,\n    width: `${rootWidth.value}px`,\n    top: props.position === 'top' ? offset : '',\n    bottom: props.position === 'bottom' ? offset : '',\n    transform: transform.value ? `translateY(${transform.value}px)` : '',\n    zIndex: props.zIndex,\n  }\n})\n\nconst update = () => {\n  if (!scrollContainer.value) return\n\n  scrollTop.value =\n    scrollContainer.value instanceof Window\n      ? document.documentElement.scrollTop\n      : scrollContainer.value.scrollTop || 0\n\n  const { position, target, offset } = props\n  const rootHeightOffset = offset + rootHeight.value\n\n  if (position === 'top') {\n    if (target) {\n      const difference = targetRect.bottom.value - rootHeightOffset\n      fixed.value = offset > rootTop.value && targetRect.bottom.value > 0\n      transform.value = difference < 0 ? difference : 0\n    } else {\n      fixed.value = offset > rootTop.value\n    }\n  } else if (target) {\n    const difference =\n      windowHeight.value - targetRect.top.value - rootHeightOffset\n    fixed.value =\n      windowHeight.value - offset < rootBottom.value &&\n      windowHeight.value > targetRect.top.value\n    transform.value = difference < 0 ? -difference : 0\n  } else {\n    fixed.value = windowHeight.value - offset < rootBottom.value\n  }\n}\n\nconst handleScroll = async () => {\n  updateRoot()\n  await nextTick()\n  emit('scroll', {\n    scrollTop: scrollTop.value,\n    fixed: fixed.value,\n  })\n}\n\nwatch(fixed, (val) => emit(CHANGE_EVENT, val))\n\nonMounted(() => {\n  if (props.target) {\n    target.value =\n      document.querySelector<HTMLElement>(props.target) ?? undefined\n    if (!target.value)\n      throwError(COMPONENT_NAME, `Target does not exist: ${props.target}`)\n  } else {\n    target.value = document.documentElement\n  }\n  scrollContainer.value = getScrollContainer(root.value!, true)\n  updateRoot()\n})\n\nuseEventListener(scrollContainer, 'scroll', handleScroll)\nwatchEffect(update)\n\ndefineExpose({\n  /** @description update affix status */\n  update,\n  /** @description update rootRect info */\n  updateRoot,\n})\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}