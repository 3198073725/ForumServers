{"ast":null,"code":"import _regeneratorRuntime from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _toConsumableArray from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.string.pad-start.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport { ref, computed, watch, nextTick, onMounted, onUnmounted } from 'vue';\nimport { useStore } from 'vuex';\nimport { ElMessage } from 'element-plus';\nimport { Close, Minus, ArrowUp, Position, Loading } from '@element-plus/icons-vue';\nimport wsManager from '@/utils/websocket';\nimport { sendMessage as sendMessageApi } from '@/api/messages';\nimport { DEFAULT_AVATAR } from '@/constants/default-avatar';\nexport default {\n  name: 'ChatWindow',\n  components: {\n    Loading: Loading\n  },\n  props: {\n    userId: {\n      type: [Number, String],\n      required: true\n    }\n  },\n  emits: ['close'],\n  setup: function setup(props, _ref) {\n    var emit = _ref.emit;\n    var store = useStore();\n    var messageContainer = ref(null);\n    var messageText = ref('');\n    var minimized = ref(false);\n    var loading = ref(true);\n    var loadingMore = ref(false);\n\n    // 计算属性\n    var currentUser = computed(function () {\n      return store.state.user;\n    });\n    var currentUserId = computed(function () {\n      return store.getters.userId;\n    });\n    var messages = computed(function () {\n      return store.getters['chat/messagesByUserId'](props.userId) || [];\n    });\n    var hasMoreMessages = computed(function () {\n      return store.getters['chat/hasMoreMessages'](props.userId);\n    });\n    var chatUser = computed(function () {\n      // 从store中获取用户信息\n      var userInfo = store.getters['users/getUserById'](props.userId);\n      if (!userInfo) {\n        // 如果没有用户信息，触发获取\n        store.dispatch('users/fetchUserInfo', props.userId);\n      }\n      return {\n        id: props.userId,\n        username: (userInfo === null || userInfo === void 0 ? void 0 : userInfo.username) || \"\\u7528\\u6237\".concat(props.userId),\n        nickname: (userInfo === null || userInfo === void 0 ? void 0 : userInfo.nickname) || (userInfo === null || userInfo === void 0 ? void 0 : userInfo.username) || \"\\u7528\\u6237\".concat(props.userId),\n        avatar_url: (userInfo === null || userInfo === void 0 ? void 0 : userInfo.avatar_url) || DEFAULT_AVATAR\n      };\n    });\n\n    // 按时间排序的消息列表\n    var sortedMessages = computed(function () {\n      return _toConsumableArray(messages.value).sort(function (a, b) {\n        return new Date(a.timestamp) - new Date(b.timestamp);\n      });\n    });\n\n    // 监听消息列表变化，自动滚动到底部\n    watch(sortedMessages, function () {\n      nextTick(function () {\n        scrollToBottom();\n      });\n    });\n\n    // 初始化\n    onMounted(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return store.dispatch('users/fetchUserInfo', props.userId);\n          case 2:\n            // 连接WebSocket\n            wsManager.connectChat(props.userId);\n\n            // 加载消息历史\n            _context.next = 5;\n            return loadMessages();\n          case 5:\n            // 标记消息为已读\n            store.dispatch('chat/markMessagesAsRead', props.userId);\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    })));\n\n    // 组件销毁时断开WebSocket连接\n    onUnmounted(function () {\n      wsManager.disconnectChat(props.userId);\n    });\n\n    // 加载消息\n    var loadMessages = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              loading.value = true;\n              _context2.prev = 1;\n              _context2.next = 4;\n              return store.dispatch('chat/fetchMessagesWithUser', {\n                userId: props.userId,\n                page: 1\n              });\n            case 4:\n              // 滚动到底部\n              nextTick(function () {\n                scrollToBottom();\n              });\n              _context2.next = 11;\n              break;\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](1);\n              console.error('加载消息失败:', _context2.t0);\n              ElMessage.error('加载消息失败');\n            case 11:\n              _context2.prev = 11;\n              loading.value = false;\n              return _context2.finish(11);\n            case 14:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[1, 7, 11, 14]]);\n      }));\n      return function loadMessages() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    // 加载更多消息\n    var loadMoreMessages = /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!(loadingMore.value || !hasMoreMessages.value)) {\n                _context3.next = 2;\n                break;\n              }\n              return _context3.abrupt(\"return\");\n            case 2:\n              loadingMore.value = true;\n              _context3.prev = 3;\n              _context3.next = 6;\n              return store.dispatch('chat/loadMoreMessages', props.userId);\n            case 6:\n              _context3.next = 12;\n              break;\n            case 8:\n              _context3.prev = 8;\n              _context3.t0 = _context3[\"catch\"](3);\n              console.error('加载更多消息失败:', _context3.t0);\n              ElMessage.error('加载更多消息失败');\n            case 12:\n              _context3.prev = 12;\n              loadingMore.value = false;\n              return _context3.finish(12);\n            case 15:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, null, [[3, 8, 12, 15]]);\n      }));\n      return function loadMoreMessages() {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n\n    // 发送消息\n    var sendMessage = /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var content;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              content = messageText.value.trim();\n              if (content) {\n                _context4.next = 3;\n                break;\n              }\n              return _context4.abrupt(\"return\");\n            case 3:\n              _context4.prev = 3;\n              // 通过WebSocket发送消息\n              wsManager.sendChatMessage(props.userId, content);\n\n              // 备用方案：通过API发送消息\n              _context4.next = 7;\n              return sendMessageApi(props.userId, content);\n            case 7:\n              // 清空输入框\n              messageText.value = '';\n              _context4.next = 14;\n              break;\n            case 10:\n              _context4.prev = 10;\n              _context4.t0 = _context4[\"catch\"](3);\n              console.error('发送消息失败:', _context4.t0);\n              ElMessage.error('发送消息失败');\n            case 14:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, null, [[3, 10]]);\n      }));\n      return function sendMessage() {\n        return _ref5.apply(this, arguments);\n      };\n    }();\n\n    // 滚动到底部\n    var scrollToBottom = function scrollToBottom() {\n      if (messageContainer.value) {\n        messageContainer.value.scrollTop = messageContainer.value.scrollHeight;\n      }\n    };\n\n    // 最小化聊天窗口\n    var minimize = function minimize() {\n      minimized.value = true;\n    };\n\n    // 最大化聊天窗口\n    var maximize = function maximize() {\n      minimized.value = false;\n      // 恢复窗口后滚动到底部\n      nextTick(function () {\n        scrollToBottom();\n      });\n    };\n\n    // 切换最小化/最大化\n    var toggleMinimize = function toggleMinimize() {\n      minimized.value = !minimized.value;\n      if (!minimized.value) {\n        nextTick(function () {\n          scrollToBottom();\n        });\n      }\n    };\n\n    // 关闭聊天窗口\n    var closeChat = function closeChat() {\n      emit('close', props.userId);\n    };\n\n    // 格式化时间\n    var formatTime = function formatTime(timestamp) {\n      if (!timestamp) return '';\n\n      // 确保timestamp是有效的日期\n      var date = new Date(timestamp);\n      if (isNaN(date.getTime())) {\n        console.error('Invalid timestamp:', timestamp);\n        return '';\n      }\n      var now = new Date();\n      var isToday = date.toDateString() === now.toDateString();\n      var isYesterday = new Date(now - 86400000).toDateString() === date.toDateString();\n\n      // 格式化时间部分\n      var hours = date.getHours().toString().padStart(2, '0');\n      var minutes = date.getMinutes().toString().padStart(2, '0');\n      var timeStr = \"\".concat(hours, \":\").concat(minutes);\n\n      // 今天的消息只显示时间\n      if (isToday) {\n        return timeStr;\n      }\n\n      // 昨天的消息显示\"昨天 HH:MM\"\n      if (isYesterday) {\n        return \"\\u6628\\u5929 \".concat(timeStr);\n      }\n\n      // 今年的消息显示\"MM-DD HH:MM\"\n      if (date.getFullYear() === now.getFullYear()) {\n        var month = (date.getMonth() + 1).toString().padStart(2, '0');\n        var day = date.getDate().toString().padStart(2, '0');\n        return \"\".concat(month, \"-\").concat(day, \" \").concat(timeStr);\n      }\n\n      // 其他情况显示完整日期\"YYYY-MM-DD HH:MM\"\n      return \"\".concat(date.getFullYear(), \"-\").concat((date.getMonth() + 1).toString().padStart(2, '0'), \"-\").concat(date.getDate().toString().padStart(2, '0'), \" \").concat(timeStr);\n    };\n\n    // 头像加载失败处理\n    var handleAvatarError = function handleAvatarError(e) {\n      var img = e.target;\n      img.src = DEFAULT_AVATAR;\n    };\n    return {\n      messageContainer: messageContainer,\n      messageText: messageText,\n      minimized: minimized,\n      loading: loading,\n      loadingMore: loadingMore,\n      currentUser: currentUser,\n      currentUserId: currentUserId,\n      messages: messages,\n      sortedMessages: sortedMessages,\n      hasMoreMessages: hasMoreMessages,\n      chatUser: chatUser,\n      loadMessages: loadMessages,\n      loadMoreMessages: loadMoreMessages,\n      sendMessage: sendMessage,\n      minimize: minimize,\n      maximize: maximize,\n      toggleMinimize: toggleMinimize,\n      closeChat: closeChat,\n      formatTime: formatTime,\n      // 图标\n      Close: Close,\n      Minus: Minus,\n      ArrowUp: ArrowUp,\n      Position: Position,\n      Loading: Loading,\n      handleAvatarError: handleAvatarError,\n      DEFAULT_AVATAR: DEFAULT_AVATAR\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","watch","nextTick","onMounted","onUnmounted","useStore","ElMessage","Close","Minus","ArrowUp","Position","Loading","wsManager","sendMessage","sendMessageApi","DEFAULT_AVATAR","name","components","props","userId","type","Number","String","required","emits","setup","_ref","emit","store","messageContainer","messageText","minimized","loading","loadingMore","currentUser","state","user","currentUserId","getters","messages","hasMoreMessages","chatUser","userInfo","dispatch","id","username","concat","nickname","avatar_url","sortedMessages","_toConsumableArray","value","sort","a","b","Date","timestamp","scrollToBottom","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","connectChat","loadMessages","stop","disconnectChat","_ref3","_callee2","_callee2$","_context2","page","t0","console","error","finish","apply","arguments","loadMoreMessages","_ref4","_callee3","_callee3$","_context3","abrupt","_ref5","_callee4","content","_callee4$","_context4","trim","sendChatMessage","scrollTop","scrollHeight","minimize","maximize","toggleMinimize","closeChat","formatTime","date","isNaN","getTime","now","isToday","toDateString","isYesterday","hours","getHours","toString","padStart","minutes","getMinutes","timeStr","getFullYear","month","getMonth","day","getDate","handleAvatarError","e","img","target","src"],"sources":["H:\\ForumServers\\ForumFrontend\\src\\components\\ChatWindow.vue"],"sourcesContent":["<template>\n  <div class=\"chat-window\" :class=\"{ 'is-minimized': minimized }\">\n    <!-- 聊天窗口标题栏 -->\n    <div class=\"chat-header\" @click=\"toggleMinimize\">\n      <div class=\"user-info\">\n        <el-avatar \n          :size=\"24\" \n          :src=\"chatUser.avatar_url || DEFAULT_AVATAR\"\n          @error=\"handleAvatarError\"\n        />\n        <span class=\"username\">{{ chatUser.nickname || chatUser.username }}</span>\n      </div>\n      <div class=\"header-actions\">\n        <el-button v-if=\"!minimized\" class=\"action-button\" :icon=\"Minus\" circle @click.stop=\"minimize\" />\n        <el-button v-else class=\"action-button\" :icon=\"ArrowUp\" circle @click.stop=\"maximize\" />\n        <el-button class=\"action-button\" :icon=\"Close\" circle @click.stop=\"closeChat\" />\n      </div>\n    </div>\n    \n    <!-- 聊天消息区域 -->\n    <div v-if=\"!minimized\" class=\"chat-body\">\n      <div class=\"message-container\" ref=\"messageContainer\">\n        <div v-if=\"loading\" class=\"loading-messages\">\n          <el-icon class=\"is-loading\"><Loading /></el-icon>\n          <span>加载中...</span>\n        </div>\n        \n        <div v-else-if=\"messages.length === 0\" class=\"no-messages\">\n          <p>暂无消息记录，发送一条消息开始聊天吧！</p>\n        </div>\n        \n        <template v-else>\n          <div v-if=\"hasMoreMessages\" class=\"load-more\">\n            <el-button type=\"text\" @click=\"loadMoreMessages\" :loading=\"loadingMore\">\n              加载更多消息\n            </el-button>\n          </div>\n          \n          <div \n            v-for=\"message in sortedMessages\" \n            :key=\"message.id\" \n            class=\"message\" \n            :class=\"{ 'outgoing': message.senderId === currentUserId }\"\n          >\n            <el-avatar \n              v-if=\"message.senderId !== currentUserId\" \n              :size=\"32\" \n              :src=\"chatUser.avatar_url || DEFAULT_AVATAR\"\n              @error=\"handleAvatarError\"\n            />\n            \n            <div class=\"message-content\">\n              <div class=\"message-text\">{{ message.content }}</div>\n              <div class=\"message-time\">{{ formatTime(message.timestamp) }}</div>\n            </div>\n            \n            <el-avatar \n              v-if=\"message.senderId === currentUserId\" \n              :size=\"32\" \n              :src=\"currentUser.avatar_url || DEFAULT_AVATAR\"\n              @error=\"handleAvatarError\"\n            />\n          </div>\n        </template>\n      </div>\n      \n      <!-- 消息输入区域 -->\n      <div class=\"message-input\">\n        <el-input\n          v-model=\"messageText\"\n          type=\"textarea\"\n          :rows=\"2\"\n          placeholder=\"输入消息...\"\n          resize=\"none\"\n          @keydown.enter.prevent=\"sendMessage\"\n        />\n        <el-button type=\"primary\" :icon=\"Position\" @click=\"sendMessage\" :disabled=\"!messageText.trim()\">\n          发送\n        </el-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, watch, nextTick, onMounted, onUnmounted } from 'vue';\nimport { useStore } from 'vuex';\nimport { ElMessage } from 'element-plus';\nimport { Close, Minus, ArrowUp, Position, Loading } from '@element-plus/icons-vue';\nimport wsManager from '@/utils/websocket';\nimport { sendMessage as sendMessageApi } from '@/api/messages';\nimport { DEFAULT_AVATAR } from '@/constants/default-avatar';\n\nexport default {\n  name: 'ChatWindow',\n  components: {\n    Loading\n  },\n  props: {\n    userId: {\n      type: [Number, String],\n      required: true\n    }\n  },\n  emits: ['close'],\n  setup(props, { emit }) {\n    const store = useStore();\n    const messageContainer = ref(null);\n    const messageText = ref('');\n    const minimized = ref(false);\n    const loading = ref(true);\n    const loadingMore = ref(false);\n    \n    // 计算属性\n    const currentUser = computed(() => store.state.user);\n    const currentUserId = computed(() => store.getters.userId);\n    const messages = computed(() => store.getters['chat/messagesByUserId'](props.userId) || []);\n    const hasMoreMessages = computed(() => store.getters['chat/hasMoreMessages'](props.userId));\n    const chatUser = computed(() => {\n      // 从store中获取用户信息\n      const userInfo = store.getters['users/getUserById'](props.userId);\n      if (!userInfo) {\n        // 如果没有用户信息，触发获取\n        store.dispatch('users/fetchUserInfo', props.userId);\n      }\n      return {\n        id: props.userId,\n        username: userInfo?.username || `用户${props.userId}`,\n        nickname: userInfo?.nickname || userInfo?.username || `用户${props.userId}`,\n        avatar_url: userInfo?.avatar_url || DEFAULT_AVATAR\n      };\n    });\n    \n    // 按时间排序的消息列表\n    const sortedMessages = computed(() => {\n      return [...messages.value].sort((a, b) => {\n        return new Date(a.timestamp) - new Date(b.timestamp);\n      });\n    });\n    \n    // 监听消息列表变化，自动滚动到底部\n    watch(sortedMessages, () => {\n      nextTick(() => {\n        scrollToBottom();\n      });\n    });\n    \n    // 初始化\n    onMounted(async () => {\n      // 获取用户信息\n      await store.dispatch('users/fetchUserInfo', props.userId);\n      \n      // 连接WebSocket\n      wsManager.connectChat(props.userId);\n      \n      // 加载消息历史\n      await loadMessages();\n      \n      // 标记消息为已读\n      store.dispatch('chat/markMessagesAsRead', props.userId);\n    });\n    \n    // 组件销毁时断开WebSocket连接\n    onUnmounted(() => {\n      wsManager.disconnectChat(props.userId);\n    });\n    \n    // 加载消息\n    const loadMessages = async () => {\n      loading.value = true;\n      try {\n        await store.dispatch('chat/fetchMessagesWithUser', {\n          userId: props.userId,\n          page: 1\n        });\n        \n        // 滚动到底部\n        nextTick(() => {\n          scrollToBottom();\n        });\n      } catch (error) {\n        console.error('加载消息失败:', error);\n        ElMessage.error('加载消息失败');\n      } finally {\n        loading.value = false;\n      }\n    };\n    \n    // 加载更多消息\n    const loadMoreMessages = async () => {\n      if (loadingMore.value || !hasMoreMessages.value) return;\n      \n      loadingMore.value = true;\n      try {\n        await store.dispatch('chat/loadMoreMessages', props.userId);\n      } catch (error) {\n        console.error('加载更多消息失败:', error);\n        ElMessage.error('加载更多消息失败');\n      } finally {\n        loadingMore.value = false;\n      }\n    };\n    \n    // 发送消息\n    const sendMessage = async () => {\n      const content = messageText.value.trim();\n      if (!content) return;\n      \n      try {\n        // 通过WebSocket发送消息\n        wsManager.sendChatMessage(props.userId, content);\n        \n        // 备用方案：通过API发送消息\n        await sendMessageApi(props.userId, content);\n        \n        // 清空输入框\n        messageText.value = '';\n      } catch (error) {\n        console.error('发送消息失败:', error);\n        ElMessage.error('发送消息失败');\n      }\n    };\n    \n    // 滚动到底部\n    const scrollToBottom = () => {\n      if (messageContainer.value) {\n        messageContainer.value.scrollTop = messageContainer.value.scrollHeight;\n      }\n    };\n    \n    // 最小化聊天窗口\n    const minimize = () => {\n      minimized.value = true;\n    };\n    \n    // 最大化聊天窗口\n    const maximize = () => {\n      minimized.value = false;\n      // 恢复窗口后滚动到底部\n      nextTick(() => {\n        scrollToBottom();\n      });\n    };\n    \n    // 切换最小化/最大化\n    const toggleMinimize = () => {\n      minimized.value = !minimized.value;\n      if (!minimized.value) {\n        nextTick(() => {\n          scrollToBottom();\n        });\n      }\n    };\n    \n    // 关闭聊天窗口\n    const closeChat = () => {\n      emit('close', props.userId);\n    };\n    \n    // 格式化时间\n    const formatTime = (timestamp) => {\n      if (!timestamp) return '';\n      \n      // 确保timestamp是有效的日期\n      const date = new Date(timestamp);\n      if (isNaN(date.getTime())) {\n        console.error('Invalid timestamp:', timestamp);\n        return '';\n      }\n      \n      const now = new Date();\n      const isToday = date.toDateString() === now.toDateString();\n      const isYesterday = new Date(now - 86400000).toDateString() === date.toDateString();\n      \n      // 格式化时间部分\n      const hours = date.getHours().toString().padStart(2, '0');\n      const minutes = date.getMinutes().toString().padStart(2, '0');\n      const timeStr = `${hours}:${minutes}`;\n      \n      // 今天的消息只显示时间\n      if (isToday) {\n        return timeStr;\n      }\n      \n      // 昨天的消息显示\"昨天 HH:MM\"\n      if (isYesterday) {\n        return `昨天 ${timeStr}`;\n      }\n      \n      // 今年的消息显示\"MM-DD HH:MM\"\n      if (date.getFullYear() === now.getFullYear()) {\n        const month = (date.getMonth() + 1).toString().padStart(2, '0');\n        const day = date.getDate().toString().padStart(2, '0');\n        return `${month}-${day} ${timeStr}`;\n      }\n      \n      // 其他情况显示完整日期\"YYYY-MM-DD HH:MM\"\n      return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${timeStr}`;\n    };\n    \n    // 头像加载失败处理\n    const handleAvatarError = (e) => {\n      const img = e.target;\n      img.src = DEFAULT_AVATAR;\n    };\n    \n    return {\n      messageContainer,\n      messageText,\n      minimized,\n      loading,\n      loadingMore,\n      currentUser,\n      currentUserId,\n      messages,\n      sortedMessages,\n      hasMoreMessages,\n      chatUser,\n      loadMessages,\n      loadMoreMessages,\n      sendMessage,\n      minimize,\n      maximize,\n      toggleMinimize,\n      closeChat,\n      formatTime,\n      // 图标\n      Close,\n      Minus,\n      ArrowUp,\n      Position,\n      Loading,\n      handleAvatarError,\n      DEFAULT_AVATAR\n    };\n  }\n};\n</script>\n\n<style scoped>\n.chat-window {\n  width: 320px;\n  height: 400px;\n  border: 1px solid #dcdfe6;\n  border-radius: 4px;\n  background-color: #fff;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  bottom: 0;\n  right: 20px;\n  z-index: 1000;\n  transition: height 0.3s;\n}\n\n.chat-window.is-minimized {\n  height: 40px;\n}\n\n.chat-header {\n  height: 40px;\n  padding: 0 10px;\n  background-color: #409eff;\n  color: white;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  cursor: pointer;\n  user-select: none;\n}\n\n.user-info {\n  display: flex;\n  align-items: center;\n}\n\n.username {\n  margin-left: 8px;\n  font-weight: bold;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.header-actions {\n  display: flex;\n  gap: 5px;\n}\n\n.action-button {\n  padding: 2px;\n  color: white;\n  background: transparent;\n  border: none;\n}\n\n.action-button:hover {\n  background-color: rgba(255, 255, 255, 0.2);\n}\n\n.chat-body {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n.message-container {\n  flex: 1;\n  padding: 10px;\n  overflow-y: auto;\n  display: flex;\n  flex-direction: column;\n}\n\n.loading-messages {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  color: #909399;\n}\n\n.no-messages {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  color: #909399;\n  text-align: center;\n}\n\n.load-more {\n  text-align: center;\n  margin-bottom: 10px;\n}\n\n.message {\n  display: flex;\n  margin-bottom: 10px;\n  align-items: flex-start;\n}\n\n.message.outgoing {\n  flex-direction: row-reverse;\n}\n\n.message-content {\n  max-width: 70%;\n  margin: 0 8px;\n}\n\n.message-text {\n  padding: 8px 12px;\n  border-radius: 4px;\n  background-color: #f4f4f5;\n  word-break: break-word;\n  line-height: 1.4;\n}\n\n.message.outgoing .message-text {\n  background-color: #ecf5ff;\n  color: #409eff;\n}\n\n.message-time {\n  font-size: 12px;\n  color: #909399;\n  margin-top: 4px;\n  text-align: right;\n}\n\n.message.outgoing .message-time {\n  text-align: left;\n}\n\n.message-input {\n  padding: 10px;\n  border-top: 1px solid #ebeef5;\n  display: flex;\n  align-items: flex-end;\n}\n\n.message-input .el-input {\n  margin-right: 10px;\n}\n\n.message-input .el-button {\n  height: 40px;\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}