{"ast":null,"code":"import _regeneratorRuntime from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.map.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport { getUserProfile } from '@/api/users';\nvar state = {\n  userCache: new Map() // 用户信息缓存\n};\nvar getters = {\n  getUserById: function getUserById(state) {\n    return function (userId) {\n      return state.userCache.get(userId);\n    };\n  }\n};\nvar mutations = {\n  setUserInfo: function setUserInfo(state, _ref) {\n    var userId = _ref.userId,\n      userInfo = _ref.userInfo;\n    state.userCache.set(userId, userInfo);\n  }\n};\nvar actions = {\n  fetchUserInfo: function fetchUserInfo(_ref2, userId) {\n    return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var commit, state, response, userInfo;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            commit = _ref2.commit, state = _ref2.state;\n            if (!state.userCache.has(userId)) {\n              _context.next = 3;\n              break;\n            }\n            return _context.abrupt(\"return\", state.userCache.get(userId));\n          case 3:\n            _context.prev = 3;\n            _context.next = 6;\n            return getUserProfile(userId);\n          case 6:\n            response = _context.sent;\n            userInfo = response.data; // 设置默认头像\n            if (!userInfo.avatar_url) {\n              userInfo.avatar_url = '/assets/default-avatar.png';\n            }\n\n            // 设置默认昵称\n            if (!userInfo.nickname) {\n              userInfo.nickname = userInfo.username;\n            }\n            commit('setUserInfo', {\n              userId: userId,\n              userInfo: userInfo\n            });\n            return _context.abrupt(\"return\", userInfo);\n          case 14:\n            _context.prev = 14;\n            _context.t0 = _context[\"catch\"](3);\n            console.error('获取用户信息失败:', _context.t0);\n            return _context.abrupt(\"return\", null);\n          case 18:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[3, 14]]);\n    }))();\n  }\n};\nexport default {\n  namespaced: true,\n  state: state,\n  getters: getters,\n  mutations: mutations,\n  actions: actions\n};","map":{"version":3,"names":["getUserProfile","state","userCache","Map","getters","getUserById","userId","get","mutations","setUserInfo","_ref","userInfo","set","actions","fetchUserInfo","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","commit","response","wrap","_callee$","_context","prev","next","has","abrupt","sent","data","avatar_url","nickname","username","t0","console","error","stop","namespaced"],"sources":["H:/ForumServers/ForumFrontend/src/store/modules/users.js"],"sourcesContent":["import { getUserProfile } from '@/api/users';\r\n\r\nconst state = {\r\n  userCache: new Map() // 用户信息缓存\r\n};\r\n\r\nconst getters = {\r\n  getUserById: (state) => (userId) => {\r\n    return state.userCache.get(userId);\r\n  }\r\n};\r\n\r\nconst mutations = {\r\n  setUserInfo(state, { userId, userInfo }) {\r\n    state.userCache.set(userId, userInfo);\r\n  }\r\n};\r\n\r\nconst actions = {\r\n  async fetchUserInfo({ commit, state }, userId) {\r\n    // 如果缓存中已有用户信息，直接返回\r\n    if (state.userCache.has(userId)) {\r\n      return state.userCache.get(userId);\r\n    }\r\n\r\n    try {\r\n      const response = await getUserProfile(userId);\r\n      const userInfo = response.data;\r\n      \r\n      // 设置默认头像\r\n      if (!userInfo.avatar_url) {\r\n        userInfo.avatar_url = '/assets/default-avatar.png';\r\n      }\r\n      \r\n      // 设置默认昵称\r\n      if (!userInfo.nickname) {\r\n        userInfo.nickname = userInfo.username;\r\n      }\r\n      \r\n      commit('setUserInfo', { userId, userInfo });\r\n      return userInfo;\r\n    } catch (error) {\r\n      console.error('获取用户信息失败:', error);\r\n      return null;\r\n    }\r\n  }\r\n};\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  getters,\r\n  mutations,\r\n  actions\r\n}; "],"mappings":";;;;;;AAAA,SAASA,cAAc,QAAQ,aAAa;AAE5C,IAAMC,KAAK,GAAG;EACZC,SAAS,EAAE,IAAIC,GAAG,CAAC,CAAC,CAAC;AACvB,CAAC;AAED,IAAMC,OAAO,GAAG;EACdC,WAAW,EAAE,SAAbA,WAAWA,CAAGJ,KAAK;IAAA,OAAK,UAACK,MAAM,EAAK;MAClC,OAAOL,KAAK,CAACC,SAAS,CAACK,GAAG,CAACD,MAAM,CAAC;IACpC,CAAC;EAAA;AACH,CAAC;AAED,IAAME,SAAS,GAAG;EAChBC,WAAW,WAAXA,WAAWA,CAACR,KAAK,EAAAS,IAAA,EAAwB;IAAA,IAApBJ,MAAM,GAAAI,IAAA,CAANJ,MAAM;MAAEK,QAAQ,GAAAD,IAAA,CAARC,QAAQ;IACnCV,KAAK,CAACC,SAAS,CAACU,GAAG,CAACN,MAAM,EAAEK,QAAQ,CAAC;EACvC;AACF,CAAC;AAED,IAAME,OAAO,GAAG;EACRC,aAAa,WAAbA,aAAaA,CAAAC,KAAA,EAAoBT,MAAM,EAAE;IAAA,OAAAU,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,UAAAC,QAAA;MAAA,IAAAC,MAAA,EAAAnB,KAAA,EAAAoB,QAAA,EAAAV,QAAA;MAAA,OAAAM,mBAAA,GAAAK,IAAA,UAAAC,SAAAC,QAAA;QAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;UAAA;YAAzBN,MAAM,GAAAL,KAAA,CAANK,MAAM,EAAEnB,KAAK,GAAAc,KAAA,CAALd,KAAK;YAAA,KAE7BA,KAAK,CAACC,SAAS,CAACyB,GAAG,CAACrB,MAAM,CAAC;cAAAkB,QAAA,CAAAE,IAAA;cAAA;YAAA;YAAA,OAAAF,QAAA,CAAAI,MAAA,WACtB3B,KAAK,CAACC,SAAS,CAACK,GAAG,CAACD,MAAM,CAAC;UAAA;YAAAkB,QAAA,CAAAC,IAAA;YAAAD,QAAA,CAAAE,IAAA;YAAA,OAIX1B,cAAc,CAACM,MAAM,CAAC;UAAA;YAAvCe,QAAQ,GAAAG,QAAA,CAAAK,IAAA;YACRlB,QAAQ,GAAGU,QAAQ,CAACS,IAAI,EAE9B;YACA,IAAI,CAACnB,QAAQ,CAACoB,UAAU,EAAE;cACxBpB,QAAQ,CAACoB,UAAU,GAAG,4BAA4B;YACpD;;YAEA;YACA,IAAI,CAACpB,QAAQ,CAACqB,QAAQ,EAAE;cACtBrB,QAAQ,CAACqB,QAAQ,GAAGrB,QAAQ,CAACsB,QAAQ;YACvC;YAEAb,MAAM,CAAC,aAAa,EAAE;cAAEd,MAAM,EAANA,MAAM;cAAEK,QAAQ,EAARA;YAAS,CAAC,CAAC;YAAC,OAAAa,QAAA,CAAAI,MAAA,WACrCjB,QAAQ;UAAA;YAAAa,QAAA,CAAAC,IAAA;YAAAD,QAAA,CAAAU,EAAA,GAAAV,QAAA;YAEfW,OAAO,CAACC,KAAK,CAAC,WAAW,EAAAZ,QAAA,CAAAU,EAAO,CAAC;YAAC,OAAAV,QAAA,CAAAI,MAAA,WAC3B,IAAI;UAAA;UAAA;YAAA,OAAAJ,QAAA,CAAAa,IAAA;QAAA;MAAA,GAAAlB,OAAA;IAAA;EAEf;AACF,CAAC;AAED,eAAe;EACbmB,UAAU,EAAE,IAAI;EAChBrC,KAAK,EAALA,KAAK;EACLG,OAAO,EAAPA,OAAO;EACPI,SAAS,EAATA,SAAS;EACTK,OAAO,EAAPA;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}