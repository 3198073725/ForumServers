{"ast":null,"code":"import _regeneratorRuntime from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"H:/ForumServers/ForumFrontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport Editor from '@tinymce/tinymce-vue';\nimport { ref, watch } from 'vue';\nexport default {\n  name: 'RichTextEditor',\n  components: {\n    Editor: Editor\n  },\n  props: {\n    modelValue: {\n      type: String,\n      \"default\": ''\n    },\n    disabled: {\n      type: Boolean,\n      \"default\": false\n    }\n  },\n  emits: ['update:modelValue', 'change'],\n  setup: function setup(props, _ref) {\n    var emit = _ref.emit;\n    var content = ref(props.modelValue);\n    watch(function () {\n      return props.modelValue;\n    }, function (newValue) {\n      content.value = newValue;\n    });\n    var handleChange = function handleChange(e) {\n      emit('update:modelValue', e.target.getContent());\n      emit('change', e.target.getContent());\n    };\n    var init = {\n      height: 500,\n      menubar: true,\n      plugins: ['advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview', 'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen', 'insertdatetime', 'media', 'table', 'help', 'wordcount'],\n      toolbar: 'undo redo | blocks | ' + 'bold italic backcolor | alignleft aligncenter ' + 'alignright alignjustify | bullist numlist outdent indent | ' + 'removeformat | help',\n      content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }',\n      images_upload_handler: function () {\n        var _images_upload_handler = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(blobInfo, progress) {\n          var formData, response, data;\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                // 这里需要实现图片上传到后端的逻辑\n                formData = new FormData();\n                formData.append('image', blobInfo.blob(), blobInfo.filename());\n\n                // 调用后端上传接口\n                _context.next = 5;\n                return fetch('/api/posts/upload-image/', {\n                  method: 'POST',\n                  body: formData\n                });\n              case 5:\n                response = _context.sent;\n                if (response.ok) {\n                  _context.next = 8;\n                  break;\n                }\n                throw new Error('图片上传失败');\n              case 8:\n                _context.next = 10;\n                return response.json();\n              case 10:\n                data = _context.sent;\n                return _context.abrupt(\"return\", data.url);\n              case 14:\n                _context.prev = 14;\n                _context.t0 = _context[\"catch\"](0);\n                console.error('图片上传失败:', _context.t0);\n                throw _context.t0;\n              case 18:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee, null, [[0, 14]]);\n        }));\n        function images_upload_handler(_x, _x2) {\n          return _images_upload_handler.apply(this, arguments);\n        }\n        return images_upload_handler;\n      }()\n    };\n    return {\n      content: content,\n      init: init,\n      handleChange: handleChange\n    };\n  }\n};","map":{"version":3,"names":["Editor","ref","watch","name","components","props","modelValue","type","String","disabled","Boolean","emits","setup","_ref","emit","content","newValue","value","handleChange","e","target","getContent","init","height","menubar","plugins","toolbar","content_style","images_upload_handler","_images_upload_handler","_asyncToGenerator","_regeneratorRuntime","mark","_callee","blobInfo","progress","formData","response","data","wrap","_callee$","_context","prev","next","FormData","append","blob","filename","fetch","method","body","sent","ok","Error","json","abrupt","url","t0","console","error","stop","_x","_x2","apply","arguments"],"sources":["H:\\ForumServers\\ForumFrontend\\src\\components\\RichTextEditor.vue"],"sourcesContent":["<template>\r\n  <div class=\"rich-text-editor\">\r\n    <Editor\r\n      v-model=\"content\"\r\n      :init=\"init\"\r\n      :disabled=\"disabled\"\r\n      @onChange=\"handleChange\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Editor from '@tinymce/tinymce-vue'\r\nimport { ref, watch } from 'vue'\r\n\r\nexport default {\r\n  name: 'RichTextEditor',\r\n  components: {\r\n    Editor\r\n  },\r\n  props: {\r\n    modelValue: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    disabled: {\r\n      type: Boolean,\r\n      default: false\r\n    }\r\n  },\r\n  emits: ['update:modelValue', 'change'],\r\n  setup(props, { emit }) {\r\n    const content = ref(props.modelValue)\r\n\r\n    watch(() => props.modelValue, (newValue) => {\r\n      content.value = newValue\r\n    })\r\n\r\n    const handleChange = (e) => {\r\n      emit('update:modelValue', e.target.getContent())\r\n      emit('change', e.target.getContent())\r\n    }\r\n\r\n    const init = {\r\n      height: 500,\r\n      menubar: true,\r\n      plugins: [\r\n        'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',\r\n        'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',\r\n        'insertdatetime', 'media', 'table', 'help', 'wordcount'\r\n      ],\r\n      toolbar: 'undo redo | blocks | ' +\r\n        'bold italic backcolor | alignleft aligncenter ' +\r\n        'alignright alignjustify | bullist numlist outdent indent | ' +\r\n        'removeformat | help',\r\n      content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }',\r\n      images_upload_handler: async (blobInfo, progress) => {\r\n        try {\r\n          // 这里需要实现图片上传到后端的逻辑\r\n          const formData = new FormData()\r\n          formData.append('image', blobInfo.blob(), blobInfo.filename())\r\n          \r\n          // 调用后端上传接口\r\n          const response = await fetch('/api/posts/upload-image/', {\r\n            method: 'POST',\r\n            body: formData\r\n          })\r\n          \r\n          if (!response.ok) {\r\n            throw new Error('图片上传失败')\r\n          }\r\n          \r\n          const data = await response.json()\r\n          return data.url // 返回图片URL\r\n        } catch (error) {\r\n          console.error('图片上传失败:', error)\r\n          throw error\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      content,\r\n      init,\r\n      handleChange\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.rich-text-editor {\r\n  width: 100%;\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}