{"ast":null,"code":"'use strict';\n\nrequire(\"core-js/modules/es.array.find.js\");\nrequire(\"core-js/modules/es.array.includes.js\");\nrequire(\"core-js/modules/es.iterator.constructor.js\");\nrequire(\"core-js/modules/es.iterator.find.js\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/es.string.includes.js\");\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar vue = require('vue');\nvar lodashUnified = require('lodash-unified');\nvar util = require('../util.js');\nfunction useCurrent(watcherData) {\n  var instance = vue.getCurrentInstance();\n  var _currentRowKey = vue.ref(null);\n  var currentRow = vue.ref(null);\n  var setCurrentRowKey = function setCurrentRowKey(key) {\n    instance.store.assertRowKey();\n    _currentRowKey.value = key;\n    setCurrentRowByKey(key);\n  };\n  var restoreCurrentRowKey = function restoreCurrentRowKey() {\n    _currentRowKey.value = null;\n  };\n  var setCurrentRowByKey = function setCurrentRowByKey(key) {\n    var data = watcherData.data,\n      rowKey = watcherData.rowKey;\n    var _currentRow = null;\n    if (rowKey.value) {\n      _currentRow = (vue.unref(data) || []).find(function (item) {\n        return util.getRowIdentity(item, rowKey.value) === key;\n      });\n    }\n    currentRow.value = _currentRow;\n    instance.emit(\"current-change\", currentRow.value, null);\n  };\n  var updateCurrentRow = function updateCurrentRow(_currentRow) {\n    var oldCurrentRow = currentRow.value;\n    if (_currentRow && _currentRow !== oldCurrentRow) {\n      currentRow.value = _currentRow;\n      instance.emit(\"current-change\", currentRow.value, oldCurrentRow);\n      return;\n    }\n    if (!_currentRow && oldCurrentRow) {\n      currentRow.value = null;\n      instance.emit(\"current-change\", null, oldCurrentRow);\n    }\n  };\n  var updateCurrentRowData = function updateCurrentRowData() {\n    var rowKey = watcherData.rowKey.value;\n    var data = watcherData.data.value || [];\n    var oldCurrentRow = currentRow.value;\n    if (!data.includes(oldCurrentRow) && oldCurrentRow) {\n      if (rowKey) {\n        var currentRowKey = util.getRowIdentity(oldCurrentRow, rowKey);\n        setCurrentRowByKey(currentRowKey);\n      } else {\n        currentRow.value = null;\n      }\n      if (lodashUnified.isNull(currentRow.value)) {\n        instance.emit(\"current-change\", null, oldCurrentRow);\n      }\n    } else if (_currentRowKey.value) {\n      setCurrentRowByKey(_currentRowKey.value);\n      restoreCurrentRowKey();\n    }\n  };\n  return {\n    setCurrentRowKey: setCurrentRowKey,\n    restoreCurrentRowKey: restoreCurrentRowKey,\n    setCurrentRowByKey: setCurrentRowByKey,\n    updateCurrentRow: updateCurrentRow,\n    updateCurrentRowData: updateCurrentRowData,\n    states: {\n      _currentRowKey: _currentRowKey,\n      currentRow: currentRow\n    }\n  };\n}\nexports[\"default\"] = useCurrent;","map":{"version":3,"names":["useCurrent","watcherData","instance","vue","getCurrentInstance","_currentRowKey","ref","currentRow","setCurrentRowKey","key","store","assertRowKey","value","setCurrentRowByKey","restoreCurrentRowKey","data","rowKey","_currentRow","unref","find","item","util","getRowIdentity","emit","updateCurrentRow","oldCurrentRow","updateCurrentRowData","includes","currentRowKey","lodashUnified","isNull","states"],"sources":["../../../../../../../packages/components/table/src/store/current.ts"],"sourcesContent":["// @ts-nocheck\nimport { getCurrentInstance, ref, unref } from 'vue'\nimport { isNull } from 'lodash-unified'\nimport { getRowIdentity } from '../util'\n\nimport type { Ref } from 'vue'\nimport type { Table } from '../table/defaults'\nimport type { WatcherPropsData } from '.'\n\nfunction useCurrent<T>(watcherData: WatcherPropsData<T>) {\n  const instance = getCurrentInstance() as Table<T>\n  const _currentRowKey = ref<string>(null)\n  const currentRow: Ref<T> = ref(null)\n\n  const setCurrentRowKey = (key: string) => {\n    instance.store.assertRowKey()\n    _currentRowKey.value = key\n    setCurrentRowByKey(key)\n  }\n\n  const restoreCurrentRowKey = () => {\n    _currentRowKey.value = null\n  }\n\n  const setCurrentRowByKey = (key: string) => {\n    const { data, rowKey } = watcherData\n    let _currentRow = null\n    if (rowKey.value) {\n      _currentRow = (unref(data) || []).find(\n        (item) => getRowIdentity(item, rowKey.value) === key\n      )\n    }\n    currentRow.value = _currentRow\n    instance.emit('current-change', currentRow.value, null)\n  }\n\n  const updateCurrentRow = (_currentRow: T) => {\n    const oldCurrentRow = currentRow.value\n    if (_currentRow && _currentRow !== oldCurrentRow) {\n      currentRow.value = _currentRow\n      instance.emit('current-change', currentRow.value, oldCurrentRow)\n      return\n    }\n    if (!_currentRow && oldCurrentRow) {\n      currentRow.value = null\n      instance.emit('current-change', null, oldCurrentRow)\n    }\n  }\n\n  const updateCurrentRowData = () => {\n    const rowKey = watcherData.rowKey.value\n    // data 为 null 时，解构时的默认值会被忽略\n    const data = watcherData.data.value || []\n    const oldCurrentRow = currentRow.value\n    // 当 currentRow 不在 data 中时尝试更新数据\n    if (!data.includes(oldCurrentRow) && oldCurrentRow) {\n      if (rowKey) {\n        const currentRowKey = getRowIdentity(oldCurrentRow, rowKey)\n        setCurrentRowByKey(currentRowKey)\n      } else {\n        currentRow.value = null\n      }\n      if (isNull(currentRow.value)) {\n        instance.emit('current-change', null, oldCurrentRow)\n      }\n    } else if (_currentRowKey.value) {\n      // 把初始时下设置的 rowKey 转化成 rowData\n      setCurrentRowByKey(_currentRowKey.value)\n      restoreCurrentRowKey()\n    }\n  }\n\n  return {\n    setCurrentRowKey,\n    restoreCurrentRowKey,\n    setCurrentRowByKey,\n    updateCurrentRow,\n    updateCurrentRowData,\n    states: {\n      _currentRowKey,\n      currentRow,\n    },\n  }\n}\n\nexport default useCurrent\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}